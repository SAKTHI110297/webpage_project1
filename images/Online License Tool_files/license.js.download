//$Id$
var camSet =  null;
var agt = navigator.userAgent.toLowerCase();
var is_ie = ((agt.indexOf("msie") != -1) && (agt.indexOf("opera") == -1));
var http = getHTTPObject();
var currentSelected = 0;
var in_url = "http://licensing.manageengine.com/";
var deleteId = 0;
function checkFileAttr(imgId){
	$(imgId).show();
}

function displayDiv(arg)
{
        if(arg=="update")
        {
                document.getElementById("updatePaymentDiv").style.display="block";
                document.getElementById("displayPaymentDiv").style.display="none";
        }
        else if(arg =="display")
        {
                document.getElementById("updatePaymentDiv").style.display="none";
                document.getElementById("displayPaymentDiv").style.display="block";
        }
}

function getHTTPObject()
{
	var xmlhttp;
	if(window.XMLHttpRequest)
	{
		xmlhttp = new XMLHttpRequest();
	}
	else if(window.ActiveXObject)
	{
		try
		{
			xmlhttp = new ActiveXObject("Msxml2.XMLHTTP");
		}
		catch (e)
		{
			xmlhttp = new ActiveXObject("Microsoft.XMLHTTP");
		}
	}
	return xmlhttp;
}
function ajaxSendRequest(url,show,id,from)
{
	var urlStr = fixForCachingInIe(url);
	var myFields = getURLArgs(urlStr);
	http = getHTTPObject();
	if(http)
	{
		http.open("POST", myFields.url , true);
		http.setRequestHeader("Content-Type","application/x-www-form-urlencoded;charset=UTF-8");
		http.onreadystatechange = function () {
			if (http.readyState == 4){
				if(show == "yes" && from == "sendLicense"){
					if(http.responseText=="1" || http.responseText=="4") {
						var onlyId = url.replace("/license/sendlicense.do?orderid=","");
						document.getElementById(id).style.display="none";
						document.getElementById("maintable"+onlyId).style.display="none";
					}
					else{
						alert(http.responseText);
					}
					document.getElementById("progrees").style.display="none";
				}
				if(from=="addRequester")
				{
					addRowToTable(id);
					hideDiv('editContainer','disableDiv');
				}
				if(from === "deleteCreditSaleOrder")
				{
					if(http.responseText !== "success")
					{
						alert(http.responseText);
					}
					else
					{
						document.location.href="/license/jsp/PendingCredits.jsp";
					}
				}	
				if(from == "expandDIV")
				{
					document.getElementById(id).innerHTML=http.responseText;
					document.getElementById(id).style.display = (document.getElementById(id).style.display == "block" ) ? "none" : "block";
					
				}
				if(from == "saveDisplayName")
				{
					document.getElementById(show).innerHTML=http.responseText;
					showHideDual(id,show);	
				}
				if(from == "checkBoxUpdateColumn")
				{
					if(http.responseText!=1)
					{
						if(show == 1)
						{
							document.getElementById(id).checked = false
						}
						else
						{
							document.getElementById(id).checked = true;
						}
					}

				}
				if(from == "addOrRemoveProduct")
				{
					if(http.responseText == 1)
					{
						if(show == "yes"){
							processAddorRemove(id);
						}
					}
					else
					{
						alert("Problem while updating");
					}
				}
				if(from == "removeResellerProduct")
				{
					if(http.responseText == 1){
						swapOptions(show,id);
					}
					else{
						alert("Problem while...");
					}
				}
				
				if(from == "addResellerProduct")
				{
					if(http.responseText == 1){
						swapOptions(show,id);
					}
					else{
						alert("Problem while...");
					}
				}
				
				if(from == "updateBlockedProduct")
					{
					if(http.responseText == "success")
						{
						alert("Blocked products updated in DB");
						}
					else
						{
						alert("Blocked products not updated in DB, contact apt-team")
						}
					
					document.location.href="/license/jsp/madmin.jsp?view=bu";
					}

				if(from == "addResellerPartner")
				{
					if(http.responseText == 1)
					{	
						swapOptions(show,id);
					}
					else{
						alert("Problem while...");
					}
				}
				if(from == "removeResellerPartner")
				{
					if(http.responseText == 1)
					{	
						swapOptions(show,id);
					}
					else{
						alert("Problem while...");
					}
				}
				if(from == "addInvoiceNote")
				{
					if(http.responseText != "1")
					{
						alert("Problem while adding...");
					}
					else
					{
						hideDiv('editContainer','disableDiv');
					}
				}
				if(from == "getInvoiceNote")
				{
					document.getElementById(id).value=http.responseText;
				}
				if(from=="hideproduct")
				{
					if (document.getElementById(show).src.match("/license/images/del-icon.png")) 
					{ 
						document.getElementById(show).src = "/license/images/true.jpg";
					} 
					else 
					{
						document.getElementById(show).src = "/license/images/del-icon.png";
					} 
				}
				if(from=="deleteUser")
				{
					document.location.href="/license/jsp/madmin.jsp?view="+id;
				}
				if(from=="deleteUsers")
				{
					if (document.getElementById(show).src.match("/license/images/true.jpg")) 
					{
						document.getElementById(show).src = "/license/images/del-icon.png";
					} 	
					else  
					{
						document.getElementById(show).src = "/license/images/true.jpg";
					}
				}
				if(from=="deletePendingRequest")
				{
					document.location.href="/license/jsp/PendingForRenewal.jsp";
				}
				if(show == "yes" && from == "displaySubGroup")
				{
					var text = http.responseText;
					document.getElementById(id).style.display="block";
					document.getElementById(id).innerHTML=text;
					//if any subgroup property should have group_1 property's value
					var assingGroup1TextNames =document.getElementsByName("assingGroup_1Value");
					if(assingGroup1TextNames.length > 0)
					{
						assingGroup_1ValueInSubGroup(assingGroup1TextNames);
					}
					if(document.getElementById("enableCompValue")!=null)
					{
						var textboxname = document.getElementById("enableCompValue").value;
						var textboxvalue=textboxname.split("_");
						document.getElementById(textboxname).value=textboxvalue[0];
						
					}
					else
					{
						document.getElementById(textboxname).value="null";
					}
					
				}
				if(from == "addCompInTable"){
					var addVal = http.responseText;
					document.getElementById("progrees").style.display="none";
					document.location.href="/license/jsp/ImportXmlDate.jsp";
				}
				if(from == "defaultmadmin"){
					document.getElementById(id).innerHTML=http.responseText;
					document.getElementById("progrees").style.display="none";
				}
				if(from == "skudefaultmadmin"){
                                        document.getElementById(id).innerHTML=http.responseText;
                                        document.getElementById("progrees").style.display="none";
                                }
				if(from == "monthlydefaultmadmin"){
                                        document.getElementById(id).innerHTML=http.responseText;
                                        document.getElementById("progrees").style.display="none";
                                }

				if(from === "weeklyinvoiceid"){
					var str = "<B>Update Your Payment Details Here... <br><br>";
					document.getElementById("displayInvoiceDetails").innerHTML = str + http.responseText;
					if(document.getElementById("jspindiv") != null)
					{
						document.getElementById("jspindiv").value = "yes";
					}
					document.getElementById("progrees").style.display="none";
                                }

				if(from == "addOrRemoveUserRole1"){
					if(http.responseText==1){
						if(document.getElementById(id).checked){
							document.getElementById(id).checked=true;
						}
						else{
							document.getElementById(id).checked=false;
						}
					}
					else{
						if(document.getElementById(id).checked){
							document.getElementById(id).checked=false;
						}
						else{
							document.getElementById(id).checked=true;
						}
						alert("Problem while updating ....");
					}
				}
				if(from == "paymentdetails")
                                {
					if(document.getElementById("searchtype").value == "duedate")
					document.location.href="/license/jsp/PaymentDetails.jsp?&resellerid="+document.getElementById("resellerid1").value+"&searchtype="+document.getElementById("searchtype").value+"&duestatus="+document.getElementById("duestatus").value;
					else
					document.location.href="/license/jsp/PaymentDetails.jsp?&resellerid="+document.getElementById("resellerid1").value+"&searchtype="+document.getElementById("searchtype").value+"&from="+document.getElementById("from").value+"&to="+document.getElementById("to").value;
					

                                }
                                if(from == "paymentdetailsedit")
                                {
                                        if(http.responseText!="success")
                                        {
						alert("Payment amount which you have given is greater than actual invoice amount for the coreesponding order(s)"); 
					}          
					else      
						document.location.href="/license/jsp/ApprovePaymentDetails.jsp";    
				}      
				if(from == "bankdetailsedit" || from == "applycredits")
                                {
                                        document.location.href="/license/jsp/ApprovePaymentDetails.jsp";
                                }
				if(from == "bankdetailsget")
                                {
                                        document.location.href="/license/jsp/ApprovePaymentDetails.jsp";
                                }
				if(from == "updateadmincomment")
                                {

                                        document.location.href="/license/jsp/ApprovePaymentDetails.jsp";
                                }      
                                if(from == "updateusercomment")
                                {

                                        document.location.href="/license/jsp/PaymentDetails.jsp";
                                }  
				if(from == "paymentdetailsupdate")   
				{       
					if(http.responseText!="success")
                                        {
                                                alert(http.responseText) ;
                                        }
                                        else
                                        {
                                                alert(http.responseText) ;
                                        document.location.href="/license/jsp/ApprovePaymentDetails.jsp";
                                        }

				}
				if(from == "exportToCSV")
				{
					if(document.getElementById("progrees") != null && document.getElementById("progrees").style.display == "block")
                                        {
                                                document.getElementById("progrees").style.display="none";
                                        }

					var reppdf = http.responseText;
					if(reppdf=="AccessDenied")
						alert("You can't View this page");
					else
						winopen(reppdf,'wrapwin','700','400');
				}

                 if(from == "setrootpropery"){
                    var res =  http.responseText;
                    if(res=="0"){
                        alert("Problem while add or update");
                    }
                    window.location.reload();
                }
                if(from == "invsettings"){
                    var res =  http.responseText;
                    if(res=="0"){
                        alert("Problem while add or update");
                    }
                    window.location.reload();
                }
                if(from == "condionalupdate"){
                    var res =  http.responseText;
                    if(res=="0"){
                        alert("Problem while add or update");
                    }
                    window.location.reload();
                }
		if(from == "addDiscountAmt"){
			alert("Successfully updated");
			hideDiv('disfreeeditContainer','freedisableDiv');
		}
		if(from == "orderConfirmation"){
			licensebutton(false);
			if(getDL("progrees1") != null){
				getDL("progrees1").style.display="none";
			}
			if(document.getElementById(id) != null){
				document.getElementById(id).innerHTML=http.responseText;
			}
		}
		if(from == "getLicenseProp"){
			var res = http.responseText.split(":");
			getDL("selectedlicenseprops").innerHTML=res[0];
			getDL("selectedlicensetypes").innerHTML=res[1];
		}


			}
			}
		http.send(myFields.args);
	}
}
function deleteAttachment(id1,id2){
        $(id1).hide();
        $(id2).attr({value:''});
}
function fixForCachingInIe(qryStr)
{
    if(is_ie)
	{
		if(qryStr.indexOf("?")!=-1)
		{
	  		qryStr =qryStr+"&fixCacheForIe="+(new Date()).getTime();
		}
		else
		{
	  		qryStr =qryStr+"?fixCacheForIe="+(new Date()).getTime();
		}
	 	return qryStr;
	}
	else
	{
	  return qryStr;
    }   
}

function getURLArgs(qryStr)
{
	  var qmarkIndex = qryStr.indexOf("?");
	  var args; var url;
	  if(qmarkIndex=='-1')
	  {
		  url = qryStr;
		  args = null;
	  }
	  else
	  {
		  url = qryStr.substring(0,qryStr.indexOf("?"));
		  args = qryStr.substring(qryStr.indexOf("?")+1,qryStr.length);
	  }

	  var myFields = { url : url, args: args };
	  return myFields;
}

function doTheChange(url)
{
	var xmlhttp;
	var responseText;
	if(window.XMLHttpRequest)
	{
		xmlhttp = new XMLHttpRequest();
	}
	else if(typeof ActiveXObject != "undefined")
	{
		xmlHttp = new ActiveXObject("Microsoft.XMLHTTP");
	}
	xmlhttp.open("GET",  url, true);
	xmlhttp.onreadystatechange = function() {

		if (xmlhttp.readyState == 4) {
			responseText = xmlhttp.responseText;;
		}
	}
	xmlhttp.send(null);
}
function fillOtherFields()
{
	var mail = document.getElementById("useremail").value;
	var index = mail.lastIndexOf("@");
	var first = mail.substring(0,index);
	var second = mail.substring((index+1),mail.length);
	document.getElementById("tomailid").value=mail;
	document.getElementById("username").value=second;
}
function makeYesOrNo(str,str1)
{
	if(document.getElementById(str).checked)
	{
		document.getElementById(str1).value = str1
	}
	else
	{
		document.getElementById(str1).value = "null";
	}
}
function componentEnable(comp,cmp)
{
	if(document.getElementById(cmp).checked)
	{
		document.getElementById(comp).value=comp;
	}
	else
	{
		document.getElementById(comp).value="null";
	}
}
function handleBalanceAmtCheckForReseller(xmlhttp,arrArg){
        if(xmlhttp.readyState === 4){
                var rsp = xmlhttp.responseText;
                //var evalRsp = eval('('+rsp+')');
		 /*jslint evil: true */
                 var evalRsp = ( new Function( 'return ' +rsp))();
                if(rsp!=="" && rsp !=="-1" && rsp !==null){
                        if(evalRsp.result === "failure"){
                                if(parseFloat(evalRsp.finalbalanceamoumt) < 0) {//if balance amt goes negative don't approve the order"
                                        if(evalRsp.enableapproval_negativebal==="true"){
                                                if(confirm("Approval of all pending orders makes the balance amount negative.\n. OrderAmount : "+evalRsp.orderamount+" Balance Amount : "+evalRsp.balanceamount+" Threshold Limit : "+evalRsp.thresholdlimit+". \n Click OK to proceed further or else click cancel and sent comment / notication to reseller to make the payment.")){
                                                        sendAsyncAJAXRequest('GET','/license/discrepancy.do?rname='+arrArg[0],handleSendAllLicense,  new Array(arrArg[0],arrArg[1]));

                                                }
                                        }
                                        else{
                                                alert("You can't approve this order, Approval of this order makes the balance amount negative.\n. OrderAmount : "+evalRsp.orderamount+"Balance Amount : "+evalRsp.balanceamount+" Threshold Limit : "+evalRsp.thresholdlimit);
                                        }

                                }
				else //balace amt is in positive value, but less than threshole limit 
                                {
                                        if(evalRsp.enableapproval_lessbal=="true")
                                        {
                                                if(confirm("Aproval of all pending orders will make the balance amount less than threshold limit. \n Total Orders Amount : "+evalRsp.orderamount+" Balance Amount : "+evalRsp.balanceamount+" Threshold Limit : "+evalRsp.thresholdlimit+" Click Ok to proceed further,or else click cancel and sent comment / notication to reseller to make the payment."))
                                                {
                                                        sendAsyncAJAXRequest('GET','/license/discrepancy.do?rname='+arrArg[0],handleSendAllLicense,new Array(arrArg[0],arrArg[1]));
                                                }
                                        }
                                        else
                                        {
                                                alert("Aproval of all pending orders will make the balance amount less than threshold limit. \n Total Orders Amount : "+evalRsp.orderamount+" Balance Amount : "+evalRsp.balanceamount+" Threshold Limit : "+evalRsp.thresholdlimit+".");
                                        }
                                }
                        }
                        else
                        {
                                sendAsyncAJAXRequest('GET','/license/discrepancy.do?rname='+arrArg[0],handleSendAllLicense,new Array(arrArg[0],arrArg[1]));
                        }

                }
        }
}

function insertCurrencyCode(ordernumber)
{
        var code = document.getElementById("currencysymbol").value
	if(confirm("Currency code is "+code+" for the order id:"+ordernumber+".  Click OK to continue"))
	{
        var url = '/license/adminaction.do?method=insertCurrencyCodeForOrder&ordernumber='+ordernumber+'&currencysymbol='+code;
        sendAsyncAJAXRequest('GET',url,handleInsertCurrencyCode,new Array(ordernumber,code))
	}

}


function handleInsertCurrencyCode(xmlhttp,arrArg)
{
        if(xmlhttp.readyState == 4)
        {
                var rsp = xmlhttp.responseText;
                //var evalRsp = eval('('+rsp+')');
		var evalRsp = ( new Function( 'return ' +rsp))();
                if(evalRsp.result == "success")
                {
                        sendLicense(arrArg[0],'orderdiv'+arrArg[0]);
                }
                else
                {
			if(confirm("Currency Code not selected , by default it will be as USD click ok to continue"))
                        {
				sendLicense(arrArg[0],'orderdiv'+arrArg[0]);
			}
                }

        }

}

function sendLicense(orderId,divid)
{
	document.getElementById("progrees").style.display="block";
	sendAsyncAJAXRequest('GET','/license/adminaction.do?method=checkBalanceAmount&orderid='+orderId,handleBalanceAmtCheck,new Array(orderId,divid));
}
function handleBalanceAmtCheck(xmlhttp,arrArg)
{
        if(xmlhttp.readyState == 4)
        {
                var rsp = xmlhttp.responseText;
                //var evalRsp = eval('('+rsp+')');
		var evalRsp = ( new Function( 'return ' +rsp))();
                if(rsp!="" && rsp !="-1" && rsp !=null)
                {
                        if(evalRsp.result == "failure")
                        {
				if(parseFloat(evalRsp.finalbalanceamoumt) < 0) //if balance amt goes negative don't approve the order"
				{
					if(evalRsp.enableapproval_negativebal=="true")
					{
						if(confirm("Approval of this order makes the balance amount negative .\n. OrderAmount : "+evalRsp.orderamount+" Balance Amount : "+evalRsp.balanceamount+" Threshold Limit : "+evalRsp.thresholdlimit+". \n Click OK to proceed further,or else click cancel and sent comment / notication to reseller to make the payment."))
						{
							sendAsyncAJAXRequest('GET','/license/discrepancy.do?orderid='+arrArg[0],handleSendLicense,new Array(arrArg[0],arrArg[1]));
						}

					}
				
					else
					{
					alert("You can't approve this order, Approval of this order makes the balance amount negative.\n. OrderAmount : "+evalRsp.orderamount+"Balance Amount : "+evalRsp.balanceamount+" Threshold Limit : "+evalRsp.thresholdlimit);
					}

                                }
				else //balace amt is in positive value, but less than threshole limit 
                                {
                                        if(evalRsp.enableapproval_lessbal=="true")
                                        {
                                                if(confirm("Aproval of this order will make the balance amount less than threshold limit. \n Order Amount : "+evalRsp.orderamount+" Balance Amount : "+evalRsp.balanceamount+" Threshold Limit : "+evalRsp.thresholdlimit+".\n Click Ok to proceed further,or else click cancel and sent comment / notication to reseller to make the payment."))
                                                {
                                                      sendAsyncAJAXRequest('GET','/license/discrepancy.do?orderid='+arrArg[0],handleSendLicense,new Array(arrArg[0],arrArg[1]));
                                                }
                                        }
                                        else
                                        {
                                                alert("You can't approve , approval of all pending orders will make the balance amount less than threshold limit. \n Total Orders Amount : "+evalRsp.orderamount+" Balance Amount : "+evalRsp.balanceamount+" Threshold Limit : "+evalRsp.thresholdlimit+".");
                                        }

                                }
                        }
                        else
                        {
                                sendAsyncAJAXRequest('GET','/license/discrepancy.do?orderid='+arrArg[0],handleSendLicense,new Array(arrArg[0],arrArg[1]));
                        }

                }
        }
}

function handleSendLicense(xmlhttp,arrArg)
{
	if(xmlhttp.readyState == 4)
    	{
	      	var rsp = xmlhttp.responseText;
		if(rsp!="" && rsp !="-1" && rsp !=null)
		{
			if(confirm(xmlhttp.responseText+"Click OK to proceed further,or else click cancel and change the License Type and approve the order."))
			{
			        ajaxSendRequest("/license/sendlicense.do?orderid="+arrArg[0],"yes",arrArg[1],"sendLicense");
			}
		}
		else
		{
			document.getElementById("progrees").style.display="block";
		        ajaxSendRequest("/license/sendlicense.do?orderid="+arrArg[0],"yes",arrArg[1],"sendLicense");
		}
	}
}
function handleUnPaidAmountExceeds(xmlhttp,arrArg)
{
        if(xmlhttp.readyState == 4)
        {
                var rsp = xmlhttp.responseText;
		 //var evalRsp = eval('('+rsp+')');
		var evalRsp = ( new Function( 'return ' +rsp))();
                if(evalRsp.result == "exceeds")
                {

                        if(confirm("Invoice Due Amount exceeds CreditLimit,  Click OK to proceed further,or else click cancel to not approve."))
                        {
				document.getElementById("progrees").style.display="block";                                                                 ajaxSendRequest("/license/sendlicense.do?orderid="+arrArg[0],"yes",arrArg[1],"sendLicense");
                        }
                }
                else
                {
			document.getElementById("progrees").style.display="block";                                                                 ajaxSendRequest("/license/sendlicense.do?orderid="+arrArg[0],"yes",arrArg[1],"sendLicense");
                }
        }

}
function display(id)
{
	document.getElementById(id).style.display="block";
}
function hide(id)
{
	document.getElementById(id).style.display="none";
}
function fillUptheForm(autoJson)
{
	if(autoJson == ""||JSON.stringify(autoJson) == "{}")
	{
		alert("you can not autofill now");
	}
	else
	{	
		for(var key in autoJson){
			if(autoJson[key] != null){
				getDL(key).value = autoJson[key];	
			}
		}
		getResellerAmountLimit('requestform');
		getCountryForReseller();
		isLicenseRequestBlocked();
		setCustomFields();
	}
}

function checkCampaginSelection(){
	if( (getDL("Free") != null && getDL("Free").checked===true && getDL("campaign").value==="[ select ]") || (getDL("FreeLicense") != null && getDL("FreeLicense").checked===true && getDL("campaign").value==="[ select ]")){
		return false;
	}
	return true;
}
function isAmsRenewed(email){
	domain = email.substr(email.indexOf('@')+1);
	if((getDL("select").value == 14104  || getDL("select").value == 14123) && amsRenewed != null && amsRenewed != "" && amsRenewed.length > 0 && amsRenewed.indexOf(domain) < 0){
		return false;
	}
	return true;
}
function isUserTypeChecked(userTypeElement)
{
	var userType = document.getElementsByName(userTypeElement);
	var ischeck = false;
	
	if(userType.length > 0)
	{
	for(i = 0; i < userType.length; i++)
	{
		if(document.getElementsByName(userTypeElement)[i].checked == true)
		{
			ischeck = true;
		}
	}
	}
	else//for editproperties.jsp, name differs for radio button, so checking by Id
	{
		if((document.getElementById("reg") !=null && document.getElementById("reg").checked == true) || 
			(document.getElementById("renewal")!=null && document.getElementById("renewal").checked == true) || 
			(document.getElementById("ams") != null && document.getElementById("ams").checked == true)  || 
			(document.getElementById("ext") != null && document.getElementById("ext").checked == true))
		{
			ischeck = true;
		}
	}
	if(document.getElementById("status") !=null && document.getElementById("status").value =="upgrade")//for upgrade.jsp no need to check usertype
	{
		ischeck = true;
	}
	return ischeck;
	
}

function deleteCreditSaleOrder(table,column,cri,creditamount,referenceinvoicenumber,resellername)
{
	var con = confirm("Click OK to Continue");
	if(con){
		var url = "/license/creditinvoice.do?method=deleteCreditSaleOrder&table=" + table+"&column="+column+"&cri="+cri+"&resellername="+resellername+"&creditamount="+creditamount+"&referenceid="+referenceinvoicenumber;
	ajaxSendRequest(url,"no","no","deleteCreditSaleOrder");
	}
}

var secs;
var timerID = null;
var timerRunning = false;
var delay = 400;

function InitializeTimer(id)
{
	document.getElementById(id).style.display="block";
	secs = 5;
		StopTheClock();
		StartTheTimer();
}

function StopTheClock()
{
	if(timerRunning)
		clearTimeout(timerID)
			timerRunning = false
}

function StartTheTimer()
{
	if (secs==0)
	{
		StopTheClock()
		document.getElementById("suceesmsg").style.display="none";
	}
	else
	{
		self.status = secs
			secs = secs - 1
			timerRunning = true
			timerID = self.setTimeout("StartTheTimer()", delay)
	}
}
function tabChange(name)
{
	var ulobj = getDocObj("innerTab");
	var liobj = ulobj.getElementsByTagName('li');
	selctedInnerTab("innerTab", liobj[4], 5);
	document.getElementById("resellerid").value=name;	
}
function changeTab(no)
{
	var ulobj = getDocObj("innerTab");
	var liobj = ulobj.getElementsByTagName('li');
	selctedInnerTab("innerTab", liobj[no], no+1);
}

function addVerifier(ff)
{
	var mail = ff.verifiermailid.value;
	var pass = ff.verifierpassword.value;
	if(mail == "")
	{
		alert("Please enter the mail id");
		return false;
	}
	else if(pass == "")
	{
		alert("Please enter the password");
		return false;
	}
	else if(pass.length < 6)
	{
		alert("Password length cannot be < 6");
		return false;
	}
	else
	{
		return true;
	}
}
function addRowToTable(id)
{
	var tbl = document.getElementById('requestertable');
	var lastRow = tbl.rows;
	var lastLen = tbl.rows.length;
	css = lastRow[lastLen-1].getAttribute('class');
	var iteration = lastLen;
	var row = tbl.insertRow(lastLen);
	if(css == 's_row1')
		css = 's_row2';
	else if(css == 's_row2')
		css = 's_row1';
	else
		css = 's_row1';
	tbl.innerHTML += "<tr onMouseOver=\"tblRollOver(this);\" onMouseOut=\"tblRollOut(this);\" class="+css+" ><td>"+id+"&nbsp;&nbsp;&nbsp;&nbsp;<a href=\"#\"><img src=\"/license/images/delete.gif\"></a>&nbsp;&nbsp;&nbsp;&nbsp;<a href=\"#\"><img src=\"/license/images/editbut.gif\"></a></td></tr>";
}
function addOrRemoveRole(checkboxid,roleid){
	addOrRemoveResellerRole(checkboxid,roleid,getDL("resellerid").value);
}
function addOrRemoveResellerRole(checkboxid , roleid , reseller){
	var url="";
	if(document.getElementById(checkboxid).checked)
	{
		url="/license/addorremoverole.do?action=add&resellerid="+reseller+"&roleid="+roleid;
	}
	else
	{
		url = "/license/addorremoverole.do?action=remove&resellerid="+reseller+"&roleid="+roleid;
	}
	ajaxSendRequest(url,"no","no","no");
}
function makeLimitDiv(divid,checkboxid,roleid)
{
	var reseller = document.getElementById("resellerid").value;
	if(document.getElementById(checkboxid).checked)
	{
		document.getElementById(divid).style.display="block";	
	}
	else
	{
		document.getElementById(divid).style.display="none";
		var url = "/license/addorremoverole.do?action=remove&resellerid="+reseller+"&roleid="+roleid;
		ajaxSendRequest(url,"no","no","no");
		document.getElementById("autoapprove").value=0;
	}
}
function setAutoApprovalLimit()
{
	var reseller = document.getElementById("resellerid").value;
	var limit = document.getElementById("autoapprove").value;
	var url = "/license/addorremoverole.do?action=add&resellerid="+reseller+"&roleid=7&limit="+limit;
	ajaxSendRequest(url,"no","no","no");
	alert("Limit set successfully");
}

function setAllowedExtensionsDays()
{
	var reseller = document.getElementById("resellerid").value;
	var limit = document.getElementById("extensionsdays").value;
	var url = "/license/addorremoverole.do?action=add&resellerid="+reseller+"&roleid=49&limit="+limit;
	ajaxSendRequest(url,"no","no","no");
	alert("Allowed Extensions Days set successfully");
}

function showHideDiv(divid)
{
	if(document.getElementById(divid) != null){
		if(document.getElementById(divid).style.display == 'none'){
			document.getElementById(divid).style.display="inline-block";
		}
		else{	
			document.getElementById(divid).style.display="none";
		}
	}
}


function expandDIV(whichElement,pid)
{
	if(document.getElementById(whichElement).style.display=="none")
	{
		var url = "/license/productdetailshtml.do?productid=" + pid;	    	
		ajaxSendRequest(url,"no",whichElement,"expandDIV");
	}
	else
	{
		document.getElementById(whichElement).style.display = (document.getElementById(whichElement).style.display == "block" ) ? "none" : "block";
	}

}
function checkBoxUpdateColumn(table,cri,cricolumn,updatecolumn,checkboxid)
{
		var url="/license/updatecolumn.do?table="+table+"&criteriacolumn="+cricolumn+"&criteriavalue="+cri+"&updatecolumn="+updatecolumn+"&updatevalue=";
		show = 0;
		if(document.getElementById(checkboxid).checked)
		{
			url += "1";
			show = 1;
		}
		else
		{
			url += "0";
		}
		ajaxSendRequest(url,show,checkboxid,"checkBoxUpdateColumn");
}
function showHideDual(f,s)
{
	document.getElementById(f).style.display="none";
	document.getElementById(s).style.display="block";
}
function saveDisplayName(f,s,v,pid)
{
	var url = "/license/savedisplayname.do?productid=" + pid+"&displayname="+document.getElementById(v).value;	  
	ajaxSendRequest(url,s,f,"saveDisplayName");
}

function makePerpetual()
{
	if(document.getElementById("perpetual").checked==true){
		getDL("expirylabel").innerHTML = "AMS Expiry Date";
	}
	else
	{
		getDL("expirylabel").innerHTML = "Expiry Date";
	}
	showHideIpf();
	orderConfirmation();
}


function closeWindow()
{
	var ref = opener.location.href;
	if(ref == null || (ref.indexOf("ToBeRenewed.jsp") <= 0 && ref.indexOf("request.jsp") <= 0)){
		window.opener.location.reload();
	}
}
function changeTabs(no)
{
	var ulobj = getDocObj("innerTab");
	var liobj = ulobj.getElementsByTagName('li');
	selctedInnerTab1("innerTab", liobj[no], no+1);
}
function displayExpiryDate1(usertype,da)
{
		document.getElementById("expiry").value=da;
}

function processAddorRemove(type)
{
	if(type == "add")
	{
			var inp = document.getElementById("rpcontainer").getElementsByTagName("INPUT");
			for(i = 0 ; i < inp.length ; i++)
			{
				if(inp[i].type == 'checkbox')
					inp[i].checked=true;
			}
	}
	else
	{
			var inp = document.getElementById("rpcontainer").getElementsByTagName("INPUT");
			for(i = 0 ; i < inp.length ; i++)
			{
				if(inp[i].type == 'checkbox')
					inp[i].checked=false;
			}
	}

}
function addOrRemoveProduct(pid,all,resellerid)
{
	var url="";
	var tt = "";
	if(document.getElementById(pid).checked)
	{
		url = "/license/resellerVSproduct.do?request=add&resellerid="+resellerid+"&productid="+pid+"&all="+all;	
		type="add";
	}
	else
	{	
		url = "/license/resellerVSproduct.do?request=delete&resellerid="+resellerid+"&productid="+pid+"&all="+all;	  
		type="delete";
	}
	ajaxSendRequest(url,all,type,"addOrRemoveProduct");
}
function removeResellerProduct(resellerid)
{
	var tag ="";
	var tag1 ="";
	if(resellerid == "distributor")
	{
	resellerid = document.getElementById("resellerid").value; 
	tag= document.getElementById("selectedproduct");
	tag1 = document.getElementById("notselectedproduct");
	}
	else
		{
	 tag = document.getElementById("selectedproducts");
	 tag1 = document.getElementById("notselectedproducts");
		}
	var remove="";
	var url="";
	for(var i = 0 ; i < tag.length ; i++)
	{
		if(tag[i].selected)
		{
			remove += tag[i].value+",";
		}
	}
	if(resellerid == "distributor")
	{
	 resellerid = document.getElementById("resellerid").value;
	}
	url = "/license/resellerVSproduct.do?method=allocateProduct&request=delete&resellerid="+resellerid+"&productid="+remove; 
	ajaxSendRequest(url,tag,tag1,"removeResellerProduct");
}

function addResellerProduct(resellerid)
{
	var tag ="";
	var tag1 ="";
	if(resellerid == "distributor")
	{
	resellerid = document.getElementById("resellerid").value; 
	tag= document.getElementById("selectedproduct");
	tag1 = document.getElementById("notselectedproduct");
	}
	else
		{
	 tag = document.getElementById("selectedproducts");
	 tag1 = document.getElementById("notselectedproducts");
		}
	var add = "";
	var url = "";
	for(var i = 0 ; i < tag1.length ; i++)
	{
		if(tag1[i].selected)
		{
			
			add += tag1[i].value+",";
		}
	}
	
	url = "/license/resellerVSproduct.do?method=allocateProduct&request=add&resellerid="+resellerid+"&productid="+add;
	ajaxSendRequest(url,tag1,tag,"addResellerProduct");
}

function swapOptions(from,to)
{
	var remove = new Array();
	for(var i = 0 ; i < from.length ; i++)
	{
		if(from[i].selected)
		{
			var newOption = document.createElement('option');
			newOption.value = from[i].value;
			newOption.text = from[i].text;
			to.options.add(newOption);
			remove.push(i);
		}
	}
	if(remove.length > 0){
		removeFromSelectTag(from,remove);
	}

}
function removeFromSelectTag(tagObject,removeObject)
{
	for(var j = 0; j<removeObject.length;j++)
	{
		if(j == 0)
		{
			tagObject.options[removeObject[j]]=null;
		}
		else
		{
			tagObject.options[removeObject[j]-j]=null;
		}
	}
}
function removeResellerPartner(resellerid)
{
	var tag = document.getElementById("selectedpartners");
	var tag1 = document.getElementById("notselectedpartners");
	var remove="";
	var url="";
	for(var i = 0 ; i < tag.length ; i++)
	{
		if(tag[i].selected)
		{
			remove += tag[i].value+",";
		}
	}
	url = "/license/resellerVSpartner.do?request=delete&resellerid="+resellerid+"&userid="+remove; 
	ajaxSendRequest(url,tag,tag1,"removeResellerPartner");
}

function addResellerPartner(resellerid)
{
	var tag = document.getElementById("selectedpartners");
	var tag1 = document.getElementById("notselectedpartners");
	var add = "";
	var url = "";
	for(var i = 0 ; i < tag1.length ; i++)
	{
		if(tag1[i].selected)
		{
			add += tag1[i].value+",";
		}
	}
	url = "/license/resellerVSpartner.do?request=add&resellerid="+resellerid+"&userid="+add	
	ajaxSendRequest(url,tag1,tag,"addResellerPartner");
}

function checkcomment()
{
	var comment = document.getElementById("comments").value;
	if(comment == "")
        {
                alert("Please enter any comment");
                return false;
        }
	else
        {
                var con = confirm("Click OK to Continue");
                if(con)
                {
                        return true;
                }
                else
                {
                        return false;
                }
        }
        return false;
}
function confirm1(lid)
{
        if((document.getElementById("chk").checked==true) || (document.getElementById("chk").checked=="checked"))
        {
                document.getElementById("LICENSEID").value=lid;
                return true;
        }
        else
        {
                alert("Please select the checkbox if you have update");
                return false;
        }
}
function getInvoiceNote(orderid)
{
	var url = "/license/fetchData.do?orderid="+orderid; 
	ajaxSendRequest(url,null,"invoicenotecontent","getInvoiceNote");
		
}
function addInvoiceNote(fName)
{
	var url = "/license/invoicenote.do?orderid="+fName.invnoteorderid.value+"&comment="+escape(fName.invoicenotecontent.value); 
	ajaxSendRequest(url,null,null,"addInvoiceNote");
}
function checkfiles()
{
	var str1 =document.getElementById("inputfile").value;
	var str2 = document.getElementById("xmltemplatefile").value;
	var str3 = document.getElementById("mailtemplatefile").value;
	if(str1 != "")
	{
		var checkFile = str1.match("xml");
		if(checkFile != 'xml')
		{
			alert("Please attach xml file as input file.");
			return false;
		}

	}
	if(str2 !="")
	{
		var checkFile = str2.match("xml");
		if(checkFile != 'xml')
		{
			alert("Please attach xml file as Template file.");
			return false;
		}
	}
	if(str3 !="")
	{
		var checkFile = str3.match("html");
		if(checkFile != 'html')
		{
			alert("Please attach html file as MailTemplate file.");
			return false;
		}

	}
	if(str1 !="" || str2 !="" || str3 !="" )
	{
		var con = confirm("Click OK to Continue");
		if(con)
		{
			return true;
		}
		else
		{
			return false;
		}
	}
	return false;


}
function hideproduct(pid,value)
{
	var con = confirm("Click OK to Continue");
	if(con)
	{
		var url = "product&criteriacolumn=PRODUCTID&criteriavalue="+pid+"&updatecolumn=SHOWHIDE&updatevalue="+value;
                if(document.getElementById(pid).src.match("/license/images/del-icon.png"))
                {
                	value=1;
                }
		else
                {
                	value=0; 
		}
                var url = "/license/updatecolumn.do?table=product&criteriacolumn=PRODUCTID&criteriavalue="+pid+"&updatecolumn=SHOWHIDE&updatevalue="+value;
                ajaxSendRequest(url,pid,value,"hideproduct");
        }
        else
        {
		return false;
	}
}

function checkconfirm()
{
	if(document.getElementById("freelicense") != null && document.getElementById("freelicense").value ==="true")
        {
                if(checkComp() == false)
                {
                        return false;
                }
        }

	var con = confirm("Click OK to Continue");
	if(con)
	{
		return true;
	}
	else
	{
		return false;
	}


}
function deleteUser(userid,usertype,view)
{
	var con = confirm("Click OK to Continue");
	if(con)
	{
		var url = "/license/deleteuser.do?userid="+userid+"&usertype="+usertype;
		ajaxSendRequest(url,usertype,view,"deleteUser");
	}
	else
		return false;
}
function deleteUsers(userid,usertype,resstatus,view)
{
	var con = confirm("Click OK to Continue");
	if(con)
	{
		var url = "userid="+userid+"&usertype="+usertype+"&resstatus="+resstatus;
                if(document.getElementById(userid).src.match("/license/images/del-icon.png"))
                    {
                	resstatus="ACTIVE";
                    }
		else
                    {
                	resstatus="DEACTIVATED"; 
		    }
                var url = "/license/deleteuser.do?userid="+userid+"&usertype="+usertype+"&resstatus="+resstatus;
		ajaxSendRequest(url,userid,resstatus,"deleteUsers");
	}
	else
        {
		return false;
        }
}

function newComponentEnable(name,chbx,prop)
{
	if(document.getElementById(chbx).checked)
	{
		document.getElementById(prop).name=name;
	}
	else
	{
		document.getElementById(prop).name=null;
	}
}
function resselect()
{
	if(document.getElementById("resellername").value=="0")
	{
		alert("please select  Reseller Name ");
		return false;

	}
	else{
		return true;
	}
}
function addOrRemoveUserRole1(checkboxid,roleid,userid)
{
	var reseller = userid;
	var url="";
	var name = ""+userid+"";
	name += roleid;
	if(document.getElementById(checkboxid).checked)
	{

		document.getElementById("userrole"+name).value="add";
	}
	else
	{

		document.getElementById("userrole"+name).value="remove";
	}
	url = "/license/updateroles.do?userid="+userid+"&userrole"+userid+roleid+"="+document.getElementById("userrole"+userid+roleid).value+"&roleid="+roleid;
	ajaxSendRequest(url,"no",checkboxid,"addOrRemoveUserRole1");
}
function assignSearchElement(searchelement)
{
	document.getElementById("searchelement").value=searchelement;
}

function validateSearch()
{

	var searchelement = document.getElementById("searchelement").value;
	if(searchelement =="")
	{
		alert("Please enter the value to Search");
		return false;
	}
	else{
		return true;
	}
}
function assignUpgradeElements(product,searchlement)
{
	document.getElementById("selectedproduct").value=product;
	document.getElementById("usermail").value=searchlement;
}

function editinvoice()
{

	document.getElementById("invoicenumber").style.display="block";
}
function componentEnableGroup(comp,cmp,compname)
{
	if(document.getElementById(cmp).checked)
	{
		document.getElementById(compname).value=comp;
	}
	else
	{
		document.getElementById(compname).value="null";
	}
}
function makeYesOrNoGroup(str,str1,addonname)
{
	if(document.getElementById(str).checked)
	{
		document.getElementById(addonname).value = str1
	}
	else
	{
		document.getElementById(addonname).value = "null";
	}
}
function assingGroup_1ValueInSubGroup(assingGroup1TextNames)
{
	for(var i = 0 ; i < assingGroup1TextNames.length ; i++ )
	{
		var arrayValues = assingGroup1TextNames[0].value.split("::");
		changeSubGroupTextboxValue(arrayValues[0],arrayValues[1]);
	}
}
function previewInvoice(ordernum, buildIn)
{
	if(buildIn != "US"){
		winopen("/license/invoiceviewer?orderNumber="+ordernum,'wrapwin','700','400');
	}
	else{
		url="/license/getdata.do?t=zcp_zus_ordermap&cc=ZCPORDERNUMBER&c="+ordernum+"&ctt=ZUSORDERNUMBER&op=e";
                sendAsyncAJAXRequest('GET',url,preViewUSInvoice,new Array());
	}
}
function addCompInTable(prodId){	
	document.getElementById("progrees").style.display="block";
	url="/license/importxmlaction.do?prodid="+prodId;
	ajaxSendRequest(url,"no","no","addCompInTable");
}
function textboxenableGroup(cmp,textboxname)
{
	if(document.getElementById(cmp).checked)
	{
		document.getElementsByName(textboxname)[0].disabled=false;
	}
	else
	{
		document.getElementsByName(textboxname)[0].disabled=true;
		document.getElementsByName(textboxname)[0].value=0;
		if(document.getElementsByName(textboxname)[0].getAttribute("onchange") != null)
		{    document.getElementsByName(textboxname)[0].onchange();    }
	}
}
function changeSubGroupTextboxValue(textboxname,subGrouptextboxname)
{
	if(document.getElementsByName(subGrouptextboxname)[0] !=null)
	document.getElementsByName(subGrouptextboxname)[0].value=document.getElementsByName(textboxname)[0].value;
}
function importCsv(formid){
	document.getElementById("impcsvpath").value=document.getElementById("impcsv").value;
}
function viewSpecificRequest(jsp,divid,actionid,ulid,selectedLid,actionname,iframe){
	document.getElementById("progrees").style.display="block";
	if(selectedLid != null){
		selectTab(ulid,selectedLid);
	}
	if(iframe){
		document.getElementById(divid).innerHTML=  '<iframe src="'+jsp+'" height="2000px" width="100%"></iframe>';
		getDL("progrees").style.display="none";
	}
	else{
		var url = "/license/jsp/"+jsp;
		if(url.indexOf("?") >= 0 && document.getElementById(actionid)!= null){
			url += "&"+actionname+"="+document.getElementById(actionid).value;
		}
		else if(document.getElementById(actionid)!= null){
			url += "?"+actionname+"="+document.getElementById(actionid).value;
		}
		ajaxSendRequest(url,"no",divid,"defaultmadmin");

		                if(jsp == "adviewpo.jsp")
                {
                        //also display sku order details
                        var resid = document.getElementById("orderview").value ;
                        //displaySKUOrderDetails(resid);
                }

	}
}

function displaySKUOrderDetails(resid)
{

        var url ="/license/jsp/ApproveSKUOrder.jsp?notabs=true&orderview="+resid;
        ajaxSendRequest(url,"no","skuadmincontainer","skudefaultmadmin");

}
function displayMonthlyPayment()
{
        var url ="/license/jsp/topup.jsp?notabs=true";
        ajaxSendRequest(url,"no","monthlyadmincontainer","monthlydefaultmadmin");

}

function selectTab(ulid , selectedLid){
	var ulobj = getDocObj(ulid);
	var liobj =  ulobj.getElementsByTagName('li');
	for(i = 0 ; i < liobj.length  ; i++){
		if(liobj[i] == selectedLid){
			liobj[i].firstChild.id = "active";
		}
		else{
			liobj[i].firstChild.id = "";
		}
	}
}
function setReseller(){

	document.getElementById("resellerid").value=name;
}


function handleBalanceAmtCheckForResellerMadmin(xmlhttp,arrArg)
{
        if(xmlhttp.readyState == 4)
        {
                var rsp = xmlhttp.responseText;
                //var evalRsp = eval('('+rsp+')');
		var evalRsp = ( new Function( 'return ' +rsp))();
                if(rsp!="" && rsp !="-1" && rsp !=null)
                {
                        if(evalRsp.result == "failure")
                        {
                                if(parseFloat(evalRsp.finalbalanceamoumt) < 0) //if balance amt goes negative don't approve the order"
                                {
                                        if(evalRsp.enableapproval_negativebal=="true")
                                        {
                                                if(confirm("Approval of all pending orders makes the balance amount negative.\n. OrderAmount : "+evalRsp.orderamount+" Balance Amount : "+evalRsp.balanceamount+" Threshold Limit : "+evalRsp.thresholdlimit+". \n Click OK to proceed further or else click cancel and sent comment / notication to reseller to make the payment."))
                                                {

                                                sendAsyncAJAXRequest('GET','/license/discrepancy.do?rname='+arrArg[0],handleSendAllLicenseMadmin,new Array(arrArg[0],arrArg[1]));


                                                }
                                        }
                                        else
                                        {
                                                alert("You can't approve this order, Approval of this order makes the balance amount negative.\n. OrderAmount : "+evalRsp.orderamount+"Balance Amount : "+evalRsp.balanceamount+" Threshold Limit : "+evalRsp.thresholdlimit);
                                        }

                                }
				else //balace amt is in positive value, but less than threshole limit 
                                {
                                        if(evalRsp.enableapproval_lessbal=="true")
                                        {
                                                if(confirm("Aproval of all pending orders will make the balance amount less than threshold limit. \n Total Orders Amount : "+evalRsp.orderamount+" Balance Amount : "+evalRsp.balanceamount+" Threshold Limit : "+evalRsp.thresholdlimit+" Click Ok to proceed further,or else click cancel and sent comment / notication to reseller to make the payment."))
                                                {
                                                        sendAsyncAJAXRequest('GET','/license/discrepancy.do?rname='+arrArg[0],handleSendAllLicenseMadmin,new Array(arrArg[0],arrArg[1]));
                                                }
                                        }
                                        else
                                        {
                                                alert("Aproval of all pending orders will make the balance amount less than threshold limit. \n Total Orders Amount : "+evalRsp.orderamount+" Balance Amount : "+evalRsp.balanceamount+" Threshold Limit : "+evalRsp.thresholdlimit+".");
                                        }
                                }
                        }
                        else
                        {
                                sendAsyncAJAXRequest('GET','/license/discrepancy.do?rname='+arrArg[0],handleSendAllLicenseMadmin,new Array(arrArg[0],arrArg[1]));
                        }

                }
        }
}

function getInvoiceDetails()
{
	document.getElementById("progrees").style.display = "block";
	var searchtype = document.getElementById("searchtype").value;
	if(searchtype === "WeeklyInvoiceID")
        {
                var weeklyID = document.getElementById("weeklyinvoiceid").value
                if(weeklyID === "")
                {
                        alert("Enter Weekly Invoice ID");
                        return ;
                }

                var url ="/license/jsp/ResInvPayment.jsp?notabs=true&INVID="+weeklyID;
                ajaxSendRequest(url,"no","","weeklyinvoiceid");
        }
        else if(searchtype === "UnpaidWeeklyInvoices")
        {
                var resellerid = document.getElementById("resellerid1").value;
                var url="/license/fetchdetails.do?method=getUnPaidWeeklyInvoices&resellerid="+resellerid+"&unPaid";
                document.getElementById("progrees").style.display="block";
                sendAsyncAJAXRequest('GET',url,handleWeeklyInvoices,new Array());
        }
	else if(searchtype === "allWeeklyInvoices")
        {
                var resellerid = document.getElementById("resellerid1").value;
                var url="/license/fetchdetails.do?method=getUnPaidWeeklyInvoices&resellerid="+resellerid+"&getAll";
                document.getElementById("progrees").style.display="block";
                sendAsyncAJAXRequest('GET',url,handleWeeklyInvoices,new Array());
        }
        else
        {
	var url="/license/getcriteriaforreports.do?resellerid="+document.getElementById("resellerid1").value;
	if(searchtype =="date")
	{
		url += "&searchby=date&from="+document.getElementById("from").value+"&to="+document.getElementById("to").value;
	}
	else if(searchtype =="duedate")
	{
		url += "&searchby=duedate&duestatus="+document.getElementById("duestatus").value;
	}
        url += "&invoicedetails=invoiceetails";
	sendAsyncAJAXRequest('GET',url,handleInvoiceDetails,new Array());
	}
	//window.location.href=url;

}
function handleInvoiceDetails(xmlhttp,arrArg)
{
	document.getElementById("progrees").style.display = "none";
	if(xmlhttp.readyState == 4)
        {
                var rsp = xmlhttp.responseText;
	}
	//var evalRsp = eval('('+rsp+')');
	var evalRsp = ( new Function( 'return ' +rsp))();
	var displayStr = "";
	var sno=0;
	if(evalRsp.invoice_info.length > 0 || evalRsp.creditsale_info.length >0)
	{
		
		displayStr += "<table width='100%' id='dataTbli' cellspacing='0' cellpadding='0' style='margin-top:20px; border:1px solid #A9A9A9'><tr class='rowheader'><th><input type='checkbox' name='order' id='allorder' value='all' onclick='calculateCheckedAmountForall()'> &nbsp;&nbsp;Invoice</th><th>Invoice Date</th><th>Due Date</th><th>View PO</th><th>Amount</th><th>Paid Amount</th><th>Invoice Status</th><th>Payment Status</th><th>PaymentDetails</th><th>Due Status</th><th>Order Number</th></tr>";
		var kk = 0;
                var str = null;
                var oldnum = 0;
                var due=null;
		var css = "";
		var ln = evalRsp.invoice_info.length;
			
		for(var i = 0 ; i < ln ; i++ )
		{
			/*if(evalRsp.invoice_info[i].ORDERNUMBER !=null && evalRsp.invoice_info[i].ORDERNUMBER != oldnum )
				kk++;
			else if(evalRsp.invoice_info[i].ORDERNUMBER == null)
				kk++;*/
			if(evalRsp.invoice_info[i].INVOICENUMBER !=null && evalRsp.invoice_info[i].INVOICENUMBER != oldnum )
			{
                                kk++;
			}
                        else if(evalRsp.invoice_info[i].INVOICENUMBER == null)
			{
                                kk++;
			}

			if(kk%2!=0)
				css="s_row111";
			else
				css="s_row2";
			if(evalRsp.invoice_info[i].INVOICENUMBER !=null && evalRsp.invoice_info[i].INVOICENUMBER != oldnum )
			{

			var fontcolor="red";
			var paidamount = 0;
			var pendingamount = parseFloat(evalRsp.invoice_info[i].INVOICETOTAL);
			
			var paymentProp = false;
			paidamount = getPaidAmountFortheOrder(evalRsp.ordernumber_payment_info,evalRsp.invoice_info[i].ORDERNUMBER[0].ordernum);
			var paymentstatus = "Not Paid";
			if(parseFloat(paidamount)  > 0 )
			{
				if(evalRsp.invoice_info[i].STATUS == "Closed" )
				{
					paymentstatus="Paid";
					fontcolor="#026632";
				}
				else if(evalRsp.invoice_info[i].STATUS == "Partially Paid")
				{
					paymentstatus="Partially Paid";
					fontcolor="blue";
				}
				pendingamount = parseFloat(evalRsp.invoice_info[i].INVOICETOTAL) - parseFloat(paidamount);
			}
			 //:::::::::display only invoice details got from opt:::://
			var rowStr = "<tr onMouseOver=\"tblRollOver(this)//;\" onMouseOut=\"tblRollOut(this);\" class=\""+css+"\"><td align=\"left\">";
			if(parseInt(evalRsp.invoice_info[i].ORDERNUMBER) != oldnum  ) 
			{
				rowStr += "<input type=\"checkbox\" name=\"order\" id=\"order"+sno+"\"  value='"+evalRsp.invoice_info[i].ORDERNUMBER[0].ordernum+"' onclick=\"calculateCheckedAmount("+pendingamount+",'order"+sno+"')\"";  
				if(parseFloat(paidamount) > 0 && (pendingamount == 0 || evalRsp.invoice_info[i].INVOICESTATUS == "Paid"))
				{
					//rowStr +="disabled";
				}
			rowStr += "> &nbsp;&nbsp; <a href=\"javascript:winopen('/license/invoiceviewer?orderNumber="+evalRsp.invoice_info[i].ORDERNUMBER[0].ordernum+"','wrapwin','700','400')\">";
				rowStr += evalRsp.invoice_info[i].INVOICENUMBER+"</a>";
			}
			rowStr += "<input type=\"hidden\" name=\"invoicenum"+sno+"\" id=\"invoicenum"+sno+"\" value='"+evalRsp.invoice_info[i].INVOICENUMBER+"'><input type=\"hidden\" name=\"invoiceamt"+sno+"\" id=\"invoiceamt"+sno+"\" value='"+evalRsp.invoice_info[i].INVOICETOTAL+"'></td>";
			
			//InvoiceDAte
			rowStr += "<td>"+evalRsp.invoice_info[i].INVOICEDATE+"</td>";
			rowStr += "<td>"+evalRsp.invoice_info[i].DUEDATE+"</td>";

			//PO
			if((evalRsp.invoice_info[i].PDFNAME != null) &&
					parseInt(evalRsp.invoice_info[i].ORDERNUMBER) !=oldnum)
			{
				rowStr += "<td><a href=\"javascript:winopen('/license/pdffiles/"+evalRsp.invoice_info[i].PDFNAME+"','wrapwin','700','400')\">"+evalRsp.invoice_info[i].PONUMBER+"</a></td>";
			}
			else
			{
				rowStr += "<td></td>";
			}

			
			if((evalRsp.invoice_info[i].INVOICENUMBER != null 
				&& evalRsp.invoice_info[i].INVOICEFILENAME !="-") &&
				parseInt(evalRsp.invoice_info[i].INVOICENUMBER) != oldnum)
			{
				//rowStr += "<td><a href=\"javascript:previewInvoice('"+evalRsp.invoice_info[i].ORDERNUMBER+"')\">";
				//rowStr += evalRsp.invoice_info[i].INVOICENUMBER+"</a></td>";
				
				rowStr += "<td>"+evalRsp.invoice_info[i].INVOICETOTAL+"&nbsp;"+evalRsp.invoice_info[i].CURRENCY+"</td><td>"+paidamount+"</td>";
			}
			else
			{
				rowStr += "<td></td><td></td>";
			}
			
			if(evalRsp.invoice_info[i].INVOICENUMBER !=oldnum )
			{
				if( paidamount > 0 && evalRsp.invoice_info[i].INVOICESTATUS == "Paid" )
				{
					rowStr += "<td style=\"color:#026632\">Paid</td>";
				}
				else if( paidamount > 0 && evalRsp.invoice_info[i].INVOICESTATUS != "Paid" )
				{
					rowStr +="<td style=\"color:blue\">"+paymentstatus+"</td>";
				}
				else
				{
					rowStr += "<td style=\"color:red\">Not Paid</td>";
				}
			}
			else
			{
					rowStr += "<td></td>";
			}
			if(checkIfNotApproved(evalRsp.not_approve_order_info, evalRsp.invoice_info[i].ORDERNUMBER[0].ordernum))
			{
				rowStr += "<td><font color=\"blue\">Waiting for approval</font></td>";
			}
			else
			{
				rowStr += "<td></td>";
			}
			
			if(evalRsp.invoice_info[i].ORDERNUMBER != oldnum && paidamount > 0 )
			{
				rowStr += "<td><a href=\"#"+sno+"\" id=\"view"+sno+"\" onclick=\"getPaymentDetailsForOrder("+evalRsp.invoice_info[i].ORDERNUMBER[0].ordernum+",'View Payment Details ', 'viewpaymentdetails"+sno+"','view"+sno+"', 1200, event);\">View</a><div id=\"viewpaymentdetails"+sno+"\" style=\"display:none;\"></div></td>";
			}
			else
			{
				rowStr += "<td></td>";
			}				
		//	alert("Gen date:"+evalRsp.invoice_info[i].DATE);

			var due = null;
			var invoiceDate = evalRsp.invoice_info[i].INVOICEDATE;
			var dueDate = evalRsp.invoice_info[i].DUEDATE;
			//var gendateArr = invoiceDate.split("-");
			var gendateArr = dueDate.split("-");
			
			//var dt = new Date(gendateArr[0] , (gendateArr[1]-1) , gendateArr[2],gendateArr1[0],gendateArr1[1],gendateArr1[2]);
			var dt = new Date(gendateArr[0] , (gendateArr[1]-1) , gendateArr[2]);

			var curdt = new Date();
	//		alert("yeear:"+dt.getFullYear()+"::month:"+dt.getMonth()+"::::date:"+dt.getDate());
	//		alert("yeear:"+curdt.getFullYear()+"::month:"+curdt.getMonth()+"::::date:"+curdt.getDate());

		
			//same year://

			if(dt.getFullYear() == curdt.getFullYear())
			{
				//same month
				if(dt.getMonth() == curdt.getMonth())
					due = "Current Due";
				//less than current month, month diff is 1(last month) - current due
				//else if(dt.getMonth() < curdt.getMonth() && curdt.getMonth() - dt.getMonth()==1)
				//less than current month, month diff is <=1(<=last month) 
				else if(dt.getMonth() < curdt.getMonth() )
					due="Over Due";
				else
					due="No Due";

			}
			//less than curren year
			else if(dt.getFullYear() < curdt.getFullYear())
			{
				due="Over Due";
			}
			//>= current year
			else if(dt.getFullYear() > curdt.getFullYear())
			{
				due="No Due";
			}	
			
			rowStr += "<td>"+due+"</td>";

			//ORderNumber
			var orderstr = "";
                        var orderlen =  evalRsp.invoice_info[i].ORDERNUMBER.length;
                        for(var m = 0 ; m < orderlen ; m++ )
                        {
                                if(orderstr != "")
                                {
                                        orderstr += ",";
                                }
                                orderstr += evalRsp.invoice_info[i].ORDERNUMBER[m].ordernum;
                        }
                        rowStr += "<td>"+orderstr+"</td>";


			//More Info
			//rowStr += "<td><a href=\"#"+sno+"\" id=\"order"+sno+"\" onclick=\"getProperties("+evalRsp.invoice_info[i].LICENSEID+",'License Info ', 'moredetails"+sno+"','order"+sno+"', 400, event,'"+evalRsp.invoice_info[i].DATE+"');\">More </a><div id=\"moredetails"+sno+"\" style=\"display:none;\"> </div>";


			rowStr +="</tr>";
			rowStr += "<input type=\"hidden\" name='actualinvoiceamount_"+evalRsp.invoice_info[i].ORDERNUMBER+"' id ='actualinvoiceamount_"+evalRsp.invoice_info[i].ORDERNUMBER[0].ordernum+"' value='"+parseFloat(evalRsp.invoice_info[i].INVOICETOTAL)+"'>";
			rowStr += "<input type=\"hidden\" name='pendinginvoiceamount_"+evalRsp.invoice_info[i].ORDERNUMBER+"' id ='pendinginvoiceamount_"+evalRsp.invoice_info[i].ORDERNUMBER[0].ordernum+"' value='"+pendingamount+"'>";
			displayStr += rowStr;
			if(evalRsp.invoice_info[i].INVOICENUMBER !=null)
			{
			oldnum = parseInt(evalRsp.invoice_info[i].INVOICENUMBER);
			}
			
			sno++;
       			}//end of if 
			
		}
		//display Credit Sale orders, increasing t
		var ln_1 =  evalRsp.creditsale_info.length;
		for(var i = 0 ; i < ln_1 ; i++ )
		{
			if(evalRsp.creditsale_info[i].ORDERNUMBER !=null && 
				evalRsp.creditsale_info[i].ORDERNUMBER != oldnum )
                                kk++;
                        else if(evalRsp.creditsale_info[i].ORDERNUMBER == null)
                                kk++;
			
			if(kk%2!=0)
                                css="s_row111";
                        else
                                css="s_row2";


			var fontcolor="red";
                        var paidamount = 0;
                        var pendingamount = (-1) * parseFloat(evalRsp.creditsale_info[i].INVOICETOTAL);

			var paymentProp = false;
			//for credit sale , paid amount in in negative value in DB
                        paidamount = getPaidAmountFortheOrder(evalRsp.ordernumber_payment_info,evalRsp.creditsale_info[i].ORDERNUMBER);

			var paymentstatus = "Not Paid";
			if(paidamount  != 0 )
                        {
                                if(evalRsp.creditsale_info[i].INVOICESTATUS == "Paid" )
                                {
                                        paymentstatus="Paid";
                                        fontcolor="#026632";
                                }
                                else if(evalRsp.creditsale_info[i].INVOICESTATUS == "Partially Paid")
                                {
                                        paymentstatus="Partially Paid";
                                        fontcolor="blue";
                                }
                                pendingamount = parseFloat((-1) *evalRsp.creditsale_info[i].INVOICETOTAL) - paidamount;
                        }
			//:::::::::display only invoice details got from opt:::://
			var rowStr = "<tr onMouseOver=\"tblRollOver(this)//;\" onMouseOut=\"tblRollOut(this);\" class=\""+css+"\"><td align=\"left\">";
                                rowStr += "<input type=\"checkbox\" name=\"order\" id=\"order"+sno+"\"  value='"+evalRsp.creditsale_info[i].ORDERNUMBER+"' onclick=\"calculateCheckedAmount("+pendingamount+",'order"+sno+"')\"";
                                if(paidamount != 0 && (pendingamount == 0 || 
					evalRsp.creditsale_info[i].INVOICESTATUS == "Paid"))
                                {
                                        rowStr +="disabled";
                                }

				//rowStr += "> &nbsp;&nbsp;"+evalRsp.creditsale_info[i].INVOICENUMBER;
				rowStr += "> &nbsp;&nbsp; <a href=\"javascript:winopen('/license/invoiceviewer?orderNumber="+evalRsp.creditsale_info[i].ORDERNUMBER+"','wrapwin','700','400')\">";
				rowStr += evalRsp.creditsale_info[i].INVOICENUMBER+"</a>";

			rowStr += "<input type=\"hidden\" name=\"invoicenum"+sno+"\" id=\"invoicenum"+sno+"\" value='"+evalRsp.creditsale_info[i].INVOICENUMBER+"'><input type=\"hidden\" name=\"invoiceamt"+sno+"\" id=\"invoiceamt"+sno+"\" value='"+(-1) *evalRsp.creditsale_info[i].INVOICETOTAL+"'></td>";
			

			rowStr += "<td>"+evalRsp.creditsale_info[i].INVOICEDATE+"</td>";
			rowStr += "<td>"+evalRsp.creditsale_info[i].DUEDATE+"</td>";


			//PO
			if(evalRsp.creditsale_info[i].POFILEFORCREDITINVOICE != null) 
                        {
                                rowStr += "<td><a href=\"javascript:winopen('/license/pdffiles/"+evalRsp.creditsale_info[i].POFILEFORCREDITINVOICE+"','wrapwin','700','400')\">"+evalRsp.creditsale_info[i].PONUMBER+"</a></td>";
                        }
                        else
                        {
                                rowStr += "<td></td>";
                        }
			
			if((evalRsp.creditsale_info[i].INVOICENUMBER != null
                                && evalRsp.creditsale_info[i].INVOICEFILENAME !="-") )
                        {
                                //rowStr += "<td><a href=\"javascript:previewInvoice('"+evalRsp.creditsale_info[i].ORDERNUMBER+"')\">";
                                //rowStr += evalRsp.creditsale_info[i].INVOICENUMBER+"</a></td>";

                                rowStr += "<td>"+evalRsp.creditsale_info[i].INVOICETOTAL+"&nbsp;"+evalRsp.creditsale_info[i].CURRENCY+"</td><td>"+paidamount+"</td>";
                        }
                        else
                        {
                                rowStr += "<td></td><td></td><td></td>";
                        }

			if( paidamount != 0 && evalRsp.creditsale_info[i].INVOICESTATUS == "Paid" )
			{
				rowStr += "<td style=\"color:#026632\">Paid</td>";
			}
			else if( paidamount != 0 && evalRsp.creditsale_info[i].INVOICESTATUS != "Paid" )
			{
				rowStr +="<td style=\"color:blue\">"+paymentstatus+"</td>";
			}
			else
			{
				rowStr += "<td style=\"color:red\">Not Paid</td>";
			}
			if(checkIfNotApproved(evalRsp.not_approve_order_info, evalRsp.creditsale_info[i].ORDERNUMBER))
                        {
                                rowStr += "<td><font color=\"blue\">Waiting for approval</font></td>";
                        }
                        else
                        {
                                rowStr += "<td></td>";
                        }

			if(evalRsp.creditsale_info[i].ORDERNUMBER != oldnum && paidamount != 0 )
                        {
                                rowStr += "<td><a href=\"#"+sno+"\" id=\"view"+sno+"\" onclick=\"getPaymentDetailsForOrder("+evalRsp.creditsale_info[i].ORDERNUMBER+",'View Payment Details ', 'viewpaymentdetails"+sno+"','view"+sno+"', 1000, event);\">View</a><div id=\"viewpaymentdetails"+sno+"\" style=\"display:none;width:100%;\"></div></td>";
                        }
                        else
                        {
                                rowStr += "<td></td>";
                        }

			var due = null;
			
			var invoiceDate = evalRsp.creditsale_info[i].INVOICEDATE;
			var dueDate = evalRsp.creditsale_info[i].DUEDATE;
			//var gendateArr = invoiceDate.split("-");
			var gendateArr = dueDate.split("-");

			var dt = new Date(gendateArr[0] , (gendateArr[1]-1) , gendateArr[2]);
                        var curdt = new Date();

			//same year://

                        if(dt.getFullYear() == curdt.getFullYear())
                        {
                                //same month
                                if(dt.getMonth() == curdt.getMonth())
                                        due = "Current Due";
                                //less than current month, month diff is 1(last month) - current due
				//else if(dt.getMonth() < curdt.getMonth() && curdt.getMonth() - dt.getMonth()==1)
				//less than current month, month diff is <=1(<=last month) 
				else if(dt.getMonth() < curdt.getMonth())
                                        due="Over Due";
                                else
                                        due="No Due";

                        }
                        //less than curren year
                        else if(dt.getFullYear() < curdt.getFullYear())
                        {
                                due="Over Due";
		        }
			//>= current year
			else if(dt.getFullYear() > curdt.getFullYear())
			{
				due="No Due";
			}
			rowStr += "<td>"+due+"</td>";
			//ordernumber
			rowStr +="<td>"+evalRsp.creditsale_info[i].ORDERNUMBER+"</td>";
			//More
			//rowStr +="<td>"+evalRsp.creditsale_info[i].REFUNDNAME+"</td></tr>";
                        rowStr += "<input type=\"hidden\" name='actualinvoiceamount_"+evalRsp.creditsale_info[i].ORDERNUMBER+"' id ='actualinvoiceamount_"+evalRsp.creditsale_info[i].ORDERNUMBER+"' value='"+(-1) *parseFloat(evalRsp.creditsale_info[i].INVOICETOTAL)+"'>";
                        rowStr += "<input type=\"hidden\" name='pendinginvoiceamount_"+evalRsp.creditsale_info[i].ORDERNUMBER+"' id ='pendinginvoiceamount_"+evalRsp.creditsale_info[i].ORDERNUMBER+"' value='"+pendingamount+"'>";

                        displayStr += rowStr;
			if(evalRsp.creditsale_info[i].ORDERNUMBER !=null)
                        oldnum = parseInt(evalRsp.creditsale_info[i].ORDERNUMBER);
	
			sno++;

		}
		displayStr += "</table>";
		displayStr += "<table align=\"center\"><tr><td align=\"center\"><input type=\"submit\" name=\"insertpayment\" id=\"insertpayment\" value =\"Submit Payment Details\" onclick=\"javascript:if(checkboxChecked()){if(isTotalAmountPostive()){clearInvoiceDiv('invoicedetails');addproductsPopUp3('Payment Details ', 'paymentdetails','insertpayment', 1200, event);getTotalAmount();getSelectedInvoiceDetails();}}\" class=\"formbut\" style=\"width:130px;\"></td></tr></table>";
		
		var length = parseInt(ln) + parseInt(ln_1);
		//displayStr += "<input type=\"hidden\" name=\"length\" id=\"length\" value=\""+ln+"\">";
		displayStr += "<input type=\"hidden\" name=\"length\" id=\"length\" value=\""+sno+"\">";
		displayStr += "<input type=\"hidden\" name=\"totalamount\" id=\"totalamount\" value=\"\">";
		displayStr += "<input type=\"hidden\" id =\"full\" name=\"full\" value=\"no\">";
		displayStr += "<input type=\"hidden\" id = \"howmany\" name=\"howmany\" value=\"0\">";

	
	}
	else
	{
		displayStr = "<table width=\"100%\" border=\"0\" cellpadding=\"0\" cellspacing=\"0\" bgcolor=\"#EFEFEF\"><tr><td><p>&nbsp;</p><center><p><br><b>No matches found for the specified criteria. Please redefine your search</b></p> </center><br><br></td></tr></table>";
	
	}
	

document.getElementById("displayInvoiceDetails").innerHTML=displayStr;

}
function getProperties(licenseid,tit,cont,linkID,wid,ev,genDate)
{

	//var url="/license/getcriteriaforreports.do?licenseid="+licenseid;
	var url="/license/fetchdetails.do?method=getLicensePropertiesINJSON&licenseid="+licenseid;
	sendAsyncAJAXRequest('GET',url,handlegetProperties,new Array(tit,cont,linkID,wid,ev,genDate));
}
function getPaymentDetailsForOrder(ordernumber,tit,cont,linkID,wid,ev)
{

	//var url="/license/getcriteriaforreports.do?ordernumber="+ordernumber;
	var url="/license/fetchdetails.do?method=getPaymentInfoForOrderNumber&ordernumber="+ordernumber;
	sendAsyncAJAXRequest('GET',url,handlegetPaymentDetailsForOrder,new Array(tit,cont,linkID,wid,ev));
}
function handlegetProperties(xmlhttp,arrArg)
{
	var tit = arrArg[0];
	var cont = arrArg[1];
	var linkID = arrArg[2];
	var wid = arrArg[3];
	var ev = arrArg[4];
	var genDate = arrArg[5];

	var str = "";

        if(xmlhttp.readyState === 4)
        {
                var rsp = xmlhttp.responseText;
                if(rsp!="" && rsp !="-1" && rsp !=null)
                {
			//var evalRsp = eval('('+rsp+')');
			var evalRsp = ( new Function( 'return ' +rsp))();
			str = "<table width=\"100%\" cellspacing=\"0\" cellpadding=\"0\" class=\"tblborder\"><tr><td colspan=\"3\" align=\"left\">";
			str += "<strong>Product Info</td><td></td></tr></tr><tr><td></td><td align=\"left\">Product Name  </td><td>:</td><td align=\"left\">"+evalRsp.prop_json[0].ProductName+"</td></tr>";

			var ln = evalRsp.properties.length;

	                for(var i = 0 ; i < ln ; i++ )
			{
				if(evalRsp.properties[i].PROPERTYNAME !== "maillicensetype")
				{
				 str += "<tr><td></td><td align=\"left\">"+evalRsp.properties[i].PROPERTYNAME+"</td>";
				 str += "<td>:</td><td align=\"left\">"+evalRsp.properties[i].PROPERTYVALUE+"</td></tr> ";
				}
			} 
			str += "<tr><td></td><td align=\"left\">License Type</td><td>:</td><td align=\"left\">";
			str += evalRsp.prop_json[0].maillicensetype+"</td></tr>";
			str += "<tr><td colspan=\"3\" align=\"left\"><br><strong>User Info</strong></td><td></td></tr>";
			str += "<tr><td></td><td align=\"left\">User Mail</td><td>:</td><td align=\"left\">"+evalRsp.prop_json[0].UserMail+"</td></tr>";
			str += "<tr><td></td><td align=\"left\">To MailID</td><td>:</td><td align=\"left\">"+evalRsp.prop_json[0].ToMailID+"</td></tr>";
			str += "<tr><td></td><td align=\"left\">Secondary Mail</td><td>:</td><td align=\"left\">"+evalRsp.prop_json[0].SecondaryMail+"</td></tr>";
			str += "<tr><td></td><td align=\"left\">CC Mail</td><td>:</td><td align=\"left\">"+evalRsp.prop_json[0].CCMailID+"</td></tr>";
			str += "<tr><td></td><td align=\"left\">RecipientName</td><td>:</td><td align=\"left\">"+evalRsp.prop_json[0].RecipientName+"</td></tr></td></tr>";
			str += "<tr><td></td><td align=\"left\">Generation Date</td><td>:</td><td align=\"left\">"+genDate+"</td></tr>";
			str += "<tr><td></td><td align=\"left\">Expiry Date</td><td>:</td><td align=\"left\">"+evalRsp.prop_json[0].expiryDate+"</td></tr></table>";
		}
	}
	
	
	var content = getDocObj("CAcontent");
	var title = getDocObj("CAtitle");
	var mainContainer = getDocObj("editContainer");
	var header = getDocObj("CAheader");
	title.innerHTML = tit;
	content.innerHTML = str;

	header['onmousedown']= function(event){dragdrop(event,'editContainer')};
	mainContainer.style.width  = wid + "px";
	mainContainer.style.display = 'block';

	//mainContainer.style.left = parseInt ( findPosX ( getDocObj (linkID) ) - 500) + "px";
	//mainContainer.style.top = parseInt ( findPosY ( getDocObj ( linkID) ) + 15 ) + "px";

	mainContainer.style.top = (document.body.scrollTop+$(window).height()/2)+"px";
        mainContainer.style.left = (($(window).width()-$("#editContainer").width())/2)+"px";


	var disDiv = getDocObj("disableDiv");
	disDiv.style.display = 'block';
	
	
}

function handlegetPaymentDetailsForOrder(xmlhttp,arrArg)
{
        var tit = arrArg[0];
        var cont = arrArg[1];
        var linkID = arrArg[2];
        var wid = arrArg[3];
        var ev = arrArg[4];
       

        var str = "";
        /*if(xmlhttp.readyState == 4)
        {&*/
	var str="";
        if(xmlhttp.readyState == 4)
        {
                var rsp = xmlhttp.responseText;
                if(rsp!="" && rsp !="-1" && rsp !=null)
                {
                	//var evalRsp = eval('('+rsp+')');
			var evalRsp = ( new Function( 'return ' +rsp))();
			var ln = evalRsp.orderwise_payment_info.length;
			
			str = "<table style='width:100%'><tr><td><b>PaymentID</b></td><td><b>PaymentDate</b></td><td><b>PaymentMode</b></td><td><b>PaidAmount</b></td><td><b>CheckNumber</b></td><td><b>Payment File</b></td><td><b>Status</b></td></tr>";	
			for(var i=0 ; i<ln ; i++)
                	{
        		       str +="<tr><td>"+evalRsp.orderwise_payment_info[i].PAYMENTID+"</td><td>"+evalRsp.orderwise_payment_info[i].PAYMENTDATE+"</td><td>"+evalRsp.orderwise_payment_info[i].PAYMENTMODE+"</td><td>"+evalRsp.orderwise_payment_info[i].PAIDAMOUNT+"</td><td>"+evalRsp.orderwise_payment_info[i].CHECKNUMBER+"</td>";
			       if(evalRsp.orderwise_payment_info[i].PAYMENTFILE !=null && 
					     evalRsp.orderwise_payment_info[i].PAYMENTFILE!="null")
				       str +="<td><a href=\"javascript:winopen('/license/pdffiles/"+evalRsp.orderwise_payment_info[i].PAYMENTFILE+"','wrapwin','700','400')\">"+evalRsp.orderwise_payment_info[i].PAYMENTFILE+"</a></td>";
			       else
					str +="-";
			       str +="<td>"+evalRsp.orderwise_payment_info[i].STATUS+"</td></tr>";
              		}
			str += "</table>";

		}
	}
	var content = getDocObj("CAcontent");
	var title = getDocObj("CAtitle");
	var mainContainer = getDocObj("editContainer");
	var header = getDocObj("CAheader");
	title.innerHTML = tit;
	content.innerHTML = str;
	
//	header['onmousedown'] = function(event){dragdrop(event,'editContainer')};
	mainContainer.style.width = wid + "px";
	mainContainer.style.display = 'block';
	//mainContainer.style.left = parseInt ( findPosX ( getDocObj (linkID) ) - 600 ) + "px";
	//mainContainer.style.top = parseInt ( findPosY ( getDocObj (linkID) ) - 240) + "px";

	mainContainer.style.top = (document.body.scrollTop+$(window).height()/2)+"px";
        mainContainer.style.left = (($(window).width()-$("#editContainer").width())/2)+"px";


	header.onmousedown = function(event){dragdrop(event,'editContainer')};
	var disDiv = getDocObj("disableDiv");
	disDiv.style.display = 'block';
                
}

function checkIfNotApproved(notapprovedorders,orderNumber)
{
	var ln = notapprovedorders.length;
	var res =false;
	for(var i = 0 ; i < ln ; i++ )
        {
                if(notapprovedorders[i].ORDERNUMBER == orderNumber)
                res = true;
        }
        return res;
}
//date1 should be less than date 2
function monthsDiff(date1,date2)
{
    var i = 0;
    while(date1 < date2)
    {
        date1.setMonth(date1.getMonth() + 1);
        i++;
    }
    return i;
}

function isTotalAmountPostive()
{
	//if selected invoices total amount is in negative, payment shoule not be sumbitted
	if(document.getElementById("totalamount").value < 0)
	{
		alert("The total amount is "+document.getElementById("totalamount").value+" of the selected invoices. But the amount should be in postive");
		return false;
	}
	return true;
	
}

function getTotalAmount()
{
	
        document.getElementById("totalamount1").value=document.getElementById("totalamount").value;
        document.getElementById("paymentamount").value=document.getElementById("totalamount").value;
}
function checkpayment(action , arg)
{
	var jspurl = document.getElementById("jspurl").value;

        if(document.getElementById("paymentamount").value=="")
        {
                alert("Enter Payment Amount");
                document.getElementById('paymentamount').focus();
                return ;
        }
        else if(isNaN(document.getElementById("paymentamount").value))
        {
                alert("Kindly check the Payment Amount");
                document.getElementById('paymentamount').focus();
                return ;
        }
        else if(parseFloat(document.getElementById("paymentamount").value) > parseFloat(document.getElementById("totalamount").value))
        {
                alert("Kindly check the Payment Amount, Your actual total invoice amount is "+document.getElementById("totalamount").value);
                document.getElementById('paymentamount').focus();
                return ;

        }
        else if(document.getElementById("paymentmode").value=="Check" && document.getElementById("checknumber").value =="")
        {
                alert("Kindly enter check number");
                document.getElementById('checknumber').focus();
                return;
        }
	else if(document.getElementById("paymentmode").value=="Wire" && document.getElementById("checknumber").value =="" &&
                arg === "weeklyinvoice")
        {
                alert("Kindly enter reference number");
                document.getElementById('checknumber').focus();
                return;
        }
        else if(document.getElementById("paymentdate").value =="")
        {
                alert("Kindly enter payment date");
                document.getElementById('paymentdate').focus();
                return;
        }
	else if(document.getElementById("paymentfile").value == "")
        {
                alert("Attachment missing");
                document.getElementById("paymentfile").focus();
                return;
        }
	 else if(document.getElementById("taxpercent") != null && document.getElementById("taxpercent").value != "" &&
                        isNaN(document.getElementById("taxpercent").value))
        {
                alert("Kindly check the Tax Percentage");
                document.getElementById('taxpercent').focus();
                return ;
        }
	else
        {
		//uploadPaymentFile();
                var len = document.getElementById("length").value;
                var paidvalue="0";
		if(arg == null || arg !="weeklyinvoice")
		{
                for(j = 0; j < len ; j++)
                {
                        if(document.getElementById("order"+j).checked)
                        {
                                if(parseFloat(document.getElementById("pendinginvoiceamount_"+document.getElementById("order"+j).value).value) < parseFloat(document.getElementById("paidinvoiceamount_"+document.getElementById("order"+j).value).value))
                                {
                                        alert("The Amount "+document.getElementById("paidinvoiceamount_"+document.getElementById("order"+j).value).value+" youhave entetered is greater than actual pending invoice amount "+document.getElementById("pendinginvoiceamount_"+document.getElementById("order"+j).value).value+" . Reset the Value ");
                                        return;
                                }
                                paidvalue = parseFloat(paidvalue) + parseFloat(document.getElementById("paidinvoiceamount_"+document.getElementById("order"+j).value).value);
                        }
                }
                if(paidvalue!= document.getElementById("paymentamount").value)
                {
                        alert("Amount not tallied with total payment amount");
                        return;
                }
		}
		var con = confirm("Click OK to Continue");
                if(con)
                {
                        var len = document.getElementById("length").value;
                        var invoicedetails="";
                        var ordernumber ="";
                        var invoicenumber ="";
                        var paidamount = "";
			if(arg !=null && arg == "weeklyinvoice")
			{
                        for(j = 0; j < len ; j++)
                        {
                                  if(invoicedetails !="")
                                  {
                                          invoicedetails = invoicedetails + "/n";
                                  }
                             invoicedetails=invoicedetails+document.getElementById("order"+j).value+"_"+document.getElementById("invoicenum"+j).value+"_"+document.getElementById("pendinginvoiceamount_"+document.getElementById("order"+j).value).value+"_"+document.getElementById("paidinvoiceamount_"+document.getElementById("order"+j).value).value;


                        }
			}
			else
			{
				for(j = 0; j < len ; j++)
                        {
                          if((document.getElementById("order"+j) != null && document.getElementById("order"+j).checked) )
                          {
                                  if(invoicedetails !="")
                                  {
                                          invoicedetails = invoicedetails + "/n";
                                  }
                             invoicedetails=invoicedetails+document.getElementById("order"+j).value+"_"+document.getElementById("invoicenum"+j).value+"_"+document.getElementById("pendinginvoiceamount_"+document.getElementById("order"+j).value).value+"_"+document.getElementById("paidinvoiceamount_"+document.getElementById("order"+j).value).value;

                          }


                        }

			}
			
			url="/license/insertpaymentdetails.do?action="+action+"&ordernumber="+ordernumber+"&paymentmode="+document.getElementById("paymentmode").value+"&paymentamount="+document.getElementById("paymentamount").value+"&totalamount="+document.getElementById("totalamount").value+"&invoicenumber="+invoicenumber+"&invoicedetails="+invoicedetails+"&paymentdate="+document.getElementById("paymentdate").value;
                        if(document.getElementById("invoicecomment").value!="")
                        {
				url +="&invoicecomment="+document.getElementById("invoicecomment").value ;
                        }
			
			url +="&jspurl="+document.getElementById("jspurl").value;
			
			if(document.getElementById("checknumber").value !="")
			{
				url +="&checknumber="+document.getElementById("checknumber").value;
			}
			else
			{
				url +="&checknumber=-";
			}
			if(document.getElementById("taxpercent").value !=="")
                        {
				url +="&taxpercent="+document.getElementById("taxpercent").value;
                                url +="&taxamount="+document.getElementById("taxamount").value;
                        }
                        else
                        {
                                url +="&taxpercent=-&taxamount=-";
                        }
			 if(document.getElementById("invid") != null)
                        {
                                url += "&invid="+document.getElementById("invid").value;
                        }
                        if(arg !=null && arg == "weeklyinvoice")
                        {
                                url += "&weeklyinvoice";
                        }

			if(document.getElementById("jspindiv")!== null && document.getElementById("jspindiv").value === "yes")
                        {
                        url += "&jspindiv=yes";
                        }


		//alert("filename:"+document.getElementById("paymentfilename").value);
		/*if(document.getElementById("paymentfilename").value != "")
		{
			url +="&paymentfilename="+document.getElementById("paymentfilename").value;
		}*/
				document.getElementById("progrees").style.display="block";
			      // ajaxSendRequest(url,"yes","no","paymentdetails");
			       sendAsyncAJAXRequest('GET',url,handleInsertPayment, new Array(arg));
                }
                else
                {
                        document.getElementById('paymentamount').focus();
                        return;
                }
        }
}
function handleInsertPayment(xmlhttp,arrArg)
{
	if(xmlhttp.readyState == 4)
	{
		var rsp = xmlhttp.responseText;
//		var evalRsp = eval('('+rsp+')');
		 /*jslint evil: true */
                 var evalRsp = ( new Function( 'return ' +rsp))();
	}
	if(evalRsp.result == "inserted")
	{
		if(document.getElementById("paymentfile").value != "")
		{
			var urlStr = "";
			if(arrArg[0] == null || arrArg[0] != "weeklyinvoice")
			{
			urlStr = "resellerid="+document.getElementById("resellerid1").value+"&searchtype="+document.getElementById("searchtype").value;

                        if(document.getElementById("searchtype").value == "duedate")
                        {
                                urlStr +="&duestatus="+document.getElementById("duestatus").value;
                        }
                        else
                        {
                                urlStr += "&from="+document.getElementById("from").value+"&to="+document.getElementById("to").value;
                        }
			}
			else if(arrArg[0] == "weeklyinvoice" )
                        {
                                urlStr += "&weeklyinvoice";
				if(document.getElementById("jspindiv")!== null)
                                {
                                urlStr += "jspindiv";
                                }
                        }

			//fileOperation(document.uploadFile,evalRsp.orderNumber);
			uploadPaymentFile(document.uploadFile,evalRsp,urlStr);
			//document.getElementById("paymentdetails").style.display="none";
		}
		
		/*if(document.getElementById("searchtype").value == "duedate")
			document.location.href="/license/jsp/PaymentDetails.jsp?&resellerid="+document.getElementById("resellerid1").value+"&searchtype="+document.getElementById("searchtype").value+"&duestatus="+document.getElementById("duestatus").value;
		else
			document.location.href="/license/jsp/PaymentDetails.jsp?&resellerid="+document.getElementById("resellerid1").value+"&searchtype="+document.getElementById("searchtype").value+"&from="+document.getElementById("from").value+"&to="+document.getElementById("to").value;
*/
	}
	else
	{

	}
}

function approveAllPayments()
{

        var len = document.getElementById("length").value;
        var allpaymt = document.getElementsByName("order");
        if(document.getElementById("approveall").checked ==true)
        {
                for(j = 0; j < len ; j++)
                {
                        if(document.getElementById("order"+j)!=null && document.getElementById("order"+j).disabled ==false)//:::::::null check becoz for same order there will be no checkbox for second row & length is based on no of (rows) ie licenses
		document.getElementById("order"+j).checked =true;
                }

        }
        else
        {

                for(j = 0; j < len ; j++)
                {
                        if(document.getElementById("order"+j)!=null)
                        document.getElementById("order"+j).checked =false;
                }
        }
}
function exportToCSVPaymentdetails()
{
        url="/license/exportToCSV.do?resellerid1="+document.getElementById("resellerid1").value+"&paymenttype="+document.getElementById("paymenttype").value+"&paymenttypevalue="+document.getElementById("paymenttypevalue").value;
                ajaxSendRequest(url,"yes","no","exportToCSV");
}
function exportToCSVResellerDues()
{
	url="/license/fetchdetails.do?method=getResellerDues";
	
	ajaxSendRequest(url,"yes","no","exportToCSV");
}

function assignValueForPayments(textfieldname,valueoftext)
{
        document.getElementById(textfieldname).value=valueoftext;
}
function calculateCheckedAmount(amount,ordernumber)
{
        if(document.getElementById(ordernumber).checked == true)
        {
        var totalamount = document.getElementById("totalamount").value;
        if(totalamount =="")
        {
                document.getElementById("totalamount").value=amount;
        }
        else
        {
                var amt = parseFloat(totalamount)+parseFloat(amount);
                document.getElementById("totalamount").value = amt;
        }
        }
        else if(document.getElementById(ordernumber).checked == false)
        {
                document.getElementById("totalamount").value=parseFloat(document.getElementById("totalamount").value)-parseFloat(amount);
        }
}
function calculateCheckedAmountForall()
{
        var len = document.getElementById("length").value;
        var d = document.getElementById("allorder").checked;
        for(i=0;i<len;i++)
        {
                if(d == true)
                {
                        if(document.getElementById("order"+i).disabled ==false)
                        {
                                if(document.getElementById("order"+i).checked == false)
                                {
                                        document.getElementById("order"+i).checked = true;
                                        var totalamount = document.getElementById("totalamount").value;
                                        if(totalamount =="")
                                        {
                                                document.getElementById("totalamount").value=document.getElementById("pendinginvoiceamount_"+document.getElementById("order"+i).value).value
                                        }
                                        else
                                        {
                                                var amt = parseFloat(totalamount)+parseFloat(document.getElementById("pendinginvoiceamount_"+document.getElementById("order"+i).value).value);
                                                document.getElementById("totalamount").value = amt;
                                        }
                                }

                        }
                }
                else
                {
                        if(document.getElementById("order"+i).disabled ==false)
                        {
                                if(document.getElementById("order"+i).checked ==true)
                                {
                                        document.getElementById("order"+i).checked = false;
                                        //document.getElementById("totalamount").value=parseInt(document.getElementById("totalamount").value)-parseInt(document.getElementById("invoiceamt"+i).value);
                                        document.getElementById("totalamount").value=parseFloat(document.getElementById("totalamount").value)-parseFloat(document.getElementById("pendinginvoiceamount_"+document.getElementById("order"+i).value).value);
                                }
                        }
                }
        }

}
function checkSearchValue()
{
        if(document.getElementById("paymenttype").value ==="PAYMENTDATE"){
                document.getElementById("paymentexpiry").style.display="block";
		document.getElementById("pDate").style.display="block";
		document.getElementById("paymenttypevalue").style.display="none";
		document.getElementById("pId").style.display="none";
	}
        else if(document.getElementById("paymenttype").value ==="PAYMENTID"){
		document.getElementById("paymenttypevalue").style.display="block";
		document.getElementById("pId").style.display="block";
                document.getElementById("paymentexpiry").style.display="none";
		document.getElementById("pDate").style.display="none";
	}
	else{
		document.getElementById("paymenttypevalue").style.display="none";
                document.getElementById("pId").style.display="none";
                document.getElementById("paymentexpiry").style.display="none";
                document.getElementById("pDate").style.display="none";
	}
}
function setPaymentDate()
{
        Calendar.setup({
        inputField    : "paymentdate",
        ifFormat      : "%Y-%m-%d",
        button        : "cal-img-3",
        align         : "Tr"
                });
}
function validateSearchForPayment()
{
        if(document.getElementById("paymenttype").value !="0" && document.getElementById("paymenttypevalue").value =="")
        {
                alert("Enter Search Element");
                return false;
        }
        return true;
}
function addxmltodb(utype,prodid,prodkey,typeid,type,category,compName,propName){
        window.location="/license/importxmlaction.do?utype="+utype+"&prodid="+prodid+"&type="+type+"&category="+category+"&typeid="+typeid+"&compName="+compName+"&propName="+propName+"&productkey="+prodkey;
}

function addxmltodb_grp_comp(utype,prodid,prodkey,typeid,type,category,compName,propName,grpid){
        window.location="/license/importxmlaction.do?utype="+utype+"&prodid="+prodid+"&type="+type+"&category="+category+"&typeid="+typeid+"&compName="+compName+"&groupid="+grpid+"&productkey="+prodkey;
}

function sendAsyncAJAXRequest( type, urll , callbackFn , arrayArg)
{
    try
    {
        var xmlhttp = getXMLHTTPRequest();
        //xmlhttp.onreadystatechange = function(){ callbackFn(xmlhttp,arrayArg) };
        xmlhttp.onreadystatechange = function(){ checkSecurityError(xmlhttp,callbackFn,arrayArg) };
        //Handling POST request
        if(type == 'POST')
        {
            var indx = urll.indexOf("?");
            var urll1 = urll.substring(0,(indx+1)) + "ttimems="+((new Date()).getTime());
            xmlhttp.open(type,urll1,true);
            xmlhttp.setRequestHeader( 'Content-type' , 'application/x-www-form-urlencoded' );
            xmlhttp.send(urll.substring(indx+1));
        }
        //Handling GET request
        else
        {
            //To avoid IE caching
            urll = urll + "&ttimems="+((new Date()).getTime());
            xmlhttp.open(type,urll,true);
            xmlhttp.send(null);
        }
    }
    catch(e)
    {
        alert("Unable to process the request"+e);
    }
}

function checkSecurityError( xmlhttp , callbackfn , arrArg )
{
    if(xmlhttp.readyState == 4 )
    {
        if(xmlhttp.responseText.indexOf("SECURITY_ERROR:") != -1)
        {
            alert(trim(xmlhttp.responseText));
            showOrHideLoadingDiv('','hide');
        }
        else
        {
            callbackfn(xmlhttp,arrArg);
        }
    }
}

function getXMLHTTPRequest()
{
    var xmlObject = null;
    if(document.all)
    {
        if (window.XMLHttpRequest)
        { // check for IE7
            xmlObject = new XMLHttpRequest();
        }
        else
        {
            if(xmlObject == null)
            {
                try
                {
                    xmlObject = new ActiveXObject('Msxml2.XMLHTTP');
                }
                catch(e) {}
            }
            if(xmlObject == null)
            {
                try
                {
                    xmlObject = new ActiveXObject('Microsoft.XMLHTTP');
                }
                catch(e)
                {
                    throw new Exception('Browser does not support Ajax calls.  Please check your browser settings.');
                }
            }
        }
    }
    else
    {
        xmlObject = new XMLHttpRequest();
    }
        return xmlObject;
}
function approveCreditSale(ordernumber,refundname,referenceinvoicenumber,creditamount,resellername)
{
	if(refundname == "creditinvoice")
	{
        //sendAsyncAJAXRequest('GET','/license/creditinvoice.do?method=updateCreditSaleInOPT&ordernumber='+ordernumber+'&referenceinvoicenumber='+referenceinvoicenumber+'&ponumber='+ponumber+'&pofilename='+pofilename+'&resellername='+resellername+'&refundname='+refundname,handleApproveCreditSale,new Array(referenceinvoicenumber,ordernumber));
		document.getElementById("progrees").style.display = "block";
    	sendAsyncAJAXRequest('GET','/license/creditinvoice.do?method=sendCreditInvoiceMail&ordernumber='+ordernumber+'&referenceid='+referenceinvoicenumber+'&amount='+creditamount+'&resellername='+resellername,handleApproveCreditSale,new Array(ordernumber));	}
	else
	{
	//sendAsyncAJAXRequest('GET','/license/creditinvoice.do?method=updateCreditSaleInOPT&ordernumber='+ordernumber+'&&pofilename='+pofilename+'&resellername='+resellername+'&refundname='+refundname,handleApproveCreditSale,new Array(referenceinvoicenumber,ordernumber));
	document.getElementById("progrees").style.display = "block";
	sendAsyncAJAXRequest('GET','/license/creditinvoice.do?method=sendCreditInvoiceMail&ordernumber='+ordernumber+'&referenceid='+referenceinvoicenumber+'&amount='+creditamount+'&resellername='+resellername,handleApproveCreditSale,new Array(ordernumber));		}
}
function handleApproveCreditSale(xmlhttp,arrArg)
{
	document.getElementById("progrees").style.display = "none";
        if(xmlhttp.readyState == 4)
        {
                var rsp = xmlhttp.responseText;
                //var evalRsp = eval('('+rsp+')');
		var evalRsp = ( new Function( 'return ' +rsp))();
		if(evalRsp.result=="updated")
		{
			alert("Approved & updated in Zbooks");
			getDL(arrArg[0]).innerHTML = "";
		}
		else
		{
			alert("Not approved because,"+evalRsp.error_msg);
		}
	}
}
function uploadPaymentFile(uploadForm,evalRsp,urlStr)
{
	var uploadFile = document.getElementById('paymentfileUpload');
	var formEle = null;


	formEle = document.createElement('form');

	var fileName = document.getElementById('paymentfile').value;
	//** Temporary fix to avoid the file path handling in windows machine **
	if(fileName.indexOf("\\") != -1)
	{
		fileName = fileName.split("\\");
	}
	else
	{
		fileName = fileName.split("/");
	}
	var strLength = fileName.length;
	fileName = fileName[fileName.length - 1];

	if(uploadFile == null)
	{
		uploadFile = uploadForm;
	}
var d = new Date();

var curr_hour = d.getHours();
var curr_min = d.getMinutes();
var curr_date = d.getDate();
var curr_month = d.getMonth()+1;
var curr_year=d.getFullYear();
	var fileNameExt = fileName.split(".");
	fileName = "paymentfile_"+evalRsp.paymentID+"_"+curr_year+"_"+curr_month+"_"+curr_date+"_"+curr_hour+"_"+curr_min+"."+fileNameExt[1];
	//alert("::::Filename after split:"+fileName);
	//Fix for FireFox-3 ::: isFireFoxVersion3()... Since firefox-3 does not
	//        //    //give the complete path of the selected file

	if(fileName != null && fileName != "" )
	{
		if(urlStr != null)
		{
			var addStr = "";
                        if(document.getElementById("jspindiv")!== null && document.getElementById("jspindiv").value === "yes")
                                {
                                addStr = "yes";
                                }
                                        
                        if(document.getElementById("winopen") !== null)
                                {
                                addStr = "winopen";
                                
                                }
		uploadFile.action = "/license/insertpaymentdetails.do?action=uploadFile&fileName="+fileName+"&paymentID="+evalRsp.paymentID+"&orderstr="+evalRsp.orderstr+"&invoicestr="+evalRsp.invoicestr+"&paymentmode="+evalRsp.paymentmode+"&paymentamount="+evalRsp.paymentamount+"&checknumber="+evalRsp.checknumber+"&invoicecomment="+evalRsp.invoicecomment+"&totalamount="+evalRsp.totalamount+"&resellername="+evalRsp.resellername+"&"+urlStr+"&taxamount="+evalRsp.taxamount+"&invid="+evalRsp.resinvid+"&jspurl="+evalRsp.jspurl+"&jspindiv="+addStr;
		//document.getElementById("paymentfilename").value=fileName;
		uploadFile.submit();
		}
		else
		{
			uploadFile.action = "/license/insertpaymentdetails.do?action=uploadFile&fileName="+fileName+"&paymentID="+evalRsp.paymentid+"&creditbasedmonthlylicense";
			uploadFile.submit();
		}

	}
	else
	{
		uploadFile.reset();
	}
}
function isFireFoxVersion3()
{
	if(navigator.appCodeName == 'Mozilla')
	{
		var tmp = new Array();
		tmp = (navigator.userAgent).split("Firefox/");
		if(tmp[tmp.length-1].indexOf("3.") == 0)
		{
			return true;
		}
	}
	return false;
}
function freePopUp(ev,popid){
    document.getElementById("clicktype").innerHTML = "<input type=\"hidden\" name=\"lsubmit\" value=\"Add Free and Send Order\">";
    if(validate()){
        addFreeProductsPopUp("Add Free products","freeproducts",popid,"800",ev)
    }
    return false;
}
function sendFreeOrder(){
   if(isSelected()){
       document.forms[2].submit();
   }
   else{
        alert("Please select a product");
        return false;
   }
}
function isSelected(){
   var freeProducts = document.getElementsByName("FREEP");
   var submit  = 0;
   for(i = 0 ; i < freeProducts.length ; i++){
       if(freeProducts[i].checked){
            return true;
       }
   }
   return false;
}
function setFreeProduct(freeid){
    document.getElementById("freediv").innerHTML = "<input type=\"hidden\" name=\"freeproduct\" value=\""+freeid+"\">";
}
function setRootProperty(action,typeId,propId,table){
    var url="";
    if(action == "add"){
        url="/license/rootproperty.do?action=add&typeid="+typeId+"&propid="+propId+"&table="+table; 

    }
    else if(action == "update"){
	    url="/license/updatecolumn.do?table=rootproperty&criteriacolumn=TYPEID&criteriavalue="+typeId+"&updatecolumn=PROPERTYID&updatevalue="+propId+"&table="+table;
    }
    ajaxSendRequest(url,"","","setrootpropery");
    
}
function invsettings(crival  ,col){
    var url="";
    if(col=="qty"){
    	url="/license/updatecolumn.do?table=licenseproperties&criteriacolumn=PROPERTYID&criteriavalue="+crival+"&updatecolumn=MINIMUMAVAILABLEQUANTITY&updatevalue="+document.getElementById("minqty"+crival).value;
    }
    else if(col == "invu"){
        var invUpdate = document.getElementById("invupdate"+crival).value;
        if(invUpdate == "yes"){
            invUpdate = "1";
        }
        else{
            invUpdate = "0";
        }
    	url="/license/updatecolumn.do?table=licenseproperties&criteriacolumn=PROPERTYID&criteriavalue="+crival+"&updatecolumn=INVENTORYUPDATE&updatevalue="+invUpdate;
    }
    else if(col == "lku"){
        url = "/license/updatecolumn.do?table=licenseproperties&criteriacolumn=PROPERTYID&criteriavalue="+crival+"&updatecolumn=LOOKUP&updatevalue="+document.getElementById("lookup"+crival).value;
    }
    else if(col  == "dbu"){
        var val = document.getElementById("dby"+crival).value;
        if(val > 1){
            url = "/license/updatecolumn.do?table=licenseproperties&criteriacolumn=PROPERTYID&criteriavalue="+crival+"&updatecolumn=DIVIDEDBY&updatevalue="+document.getElementById("dby"+crival).value;
        }
    }
    else if(col == "zbu"){
        var val = document.getElementById("zbu"+crival).value;
	if(val == "1" || val == "0"){
            url = "/license/updatecolumn.do?table=licenseproperties&criteriacolumn=PROPERTYID&criteriavalue="+crival+"&updatecolumn=ZBOOKSUPDATE&updatevalue="+val;
	}
	else{
		alert("Invalid update");
	}
    }
    ajaxSendRequest(url,"","","invsettings");
}
function condionalupdate(crival){
    url = "/license/invsettings.do?prop="+crival+"&cid="+document.getElementById("cupdate"+crival).value+"&cval="+document.getElementById("cval"+crival).value;
    ajaxSendRequest(url,"","","condionalupdate");
}

function openMax(lid){
        document.location.href='../jsp/request.jsp?olid='+lid+"&notabs=true";
        window.resizeTo(screen.availWidth, screen.availHeight)
}
function getRenewalDetailsReport()
{
	if(document.getElementById("from").value != ""  && document.getElementById("to").value != "")
	{
        var url = "/license/fetchdetails.do?method=getRenewalDetails";
        url += "&from="+document.getElementById("from").value+"&to="+document.getElementById("to").value;
	
	 url +="&resellerid1="+$('#resellerid1').map(function(){ return $(this).val();}).get().join();
        url += "&productid1="+$('#productid1').map(function(){ return $(this).val();}).get().join();
        url += "&country="+$('#country').map(function(){ return $(this).val();}).get().join();	
	
	url += "&renewalreport";
        if(document.getElementById("renewaltype").value !=0)
        {
                url += "&renewaltype="+document.getElementById("renewaltype").value;
        }
	if(document.getElementById("salesperson") != null && document.getElementById("salesperson").value != 0)
        {
                url += "&salesperson="+$('#salesperson').map(function(){ return $(this).val();}).get().join();
        }

        //alert(":LLLL"+url);
         document.getElementById("progrees").style.display="block";
        sendAsyncAJAXRequest('GET',url,handleRenewalDetailsReport,new Array());
	}
	else
		{
			alert("select from date and to date");
		}
}
function exportRenewalReport(arg1,arg2)
{
	if(document.getElementById("from").value != ""  && document.getElementById("to").value != "")
	{
    
        var url = "/license/fetchdetails.do?method=getRenewalReportInCSV";
        url += "&from="+document.getElementById("from").value+"&to="+document.getElementById("to").value;
	
	url +="&resellerid1="+$('#resellerid1').map(function(){ return $(this).val();}).get().join();
        url += "&productid1="+$('#productid1').map(function(){ return $(this).val();}).get().join();
        url += "&country="+$('#country').map(function(){ return $(this).val();}).get().join();  
        
	url += "&report="+arg1+"&renewalreport";
	
	if(document.getElementById("renewaltype").value !=0)
        {
                url += "&renewaltype="+document.getElementById("renewaltype").value;
        }
        if(document.getElementById("salesperson") != null && document.getElementById("salesperson").value != 0)
        {
                url += "&salesperson="+$('#salesperson').map(function(){ return $(this).val();}).get().join();
        }

        if(arg2 == "XLS")
        {
                url += "&xls=true";
        }
         document.getElementById("progrees").style.display="block";
        //ajaxSendRequest(url,"yes","no","exportToCSV");
	document.location.href=url;
         document.getElementById("progrees").style.display="none";
	}
	else
	{
		alert("select from date and to date");
	}
}
function handleRenewalDetailsReport(xmlhttp,arrArg)
{
        if(xmlhttp.readyState == 4)
        {
                 document.getElementById("progrees").style.display="none";
                var rsp = xmlhttp.responseText;
       
	document.getElementById("displayNotRenewed").innerHTML="";
        document.getElementById("displayExpiry").innerHTML="";
        document.getElementById("displayRenewed").innerHTML="";

        document.getElementById("displayNotRenewalDetails").style.display="block";
        document.getElementById("displayRenewalDetails").style.display="none";
        document.getElementById("displayExpiryDetails").style.display="none"; 
 
        document.getElementById("notrenewed").style.background = "#A9F5F2";
	document.getElementById("renewed").style.background = "white";
        document.getElementById("expiry").style.background = "white";
        //var evalRsp = eval('('+rsp+')');
	var evalRsp = ( new Function( 'return ' +rsp))();
        var displayStr = "";
        if(evalRsp.NotRenewalList.length > 0 || evalRsp.NotRenewalList1.length >0 || evalRsp.UpgradeList.length > 0
                || evalRsp.ExpiryList.length > 0 || evalRsp.RenewedList.length > 0)
        {

                //first table
                if(evalRsp.NotRenewalList.length > 0 || evalRsp.NotRenewalList1.length >0 || evalRsp.UpgradeList.length > 0)
                {
                if(evalRsp.NotRenewalList.length > 0)
                {
                displayStr += "<div><strong>Total : "+evalRsp.NotRenewalList.length+"</strong></div>";
                displayStr += "<table width='100%' id='dataTbli' cellspacing='0' cellpadding='0' style='margin-top:20px; border:1px solid #A9A9A9'><tr class='rowheader'><th>OrderID - Inv ID</th><th>ProductName</th><th>ResellerName</th><th>UserName</th><th>UserMail</th><!--th>ToEmail</th--><th>GenDate</th><th>Expiry</th><th>AMS Expiry</th><th>LicenseDetails</th><th>InvoiceCountry</th></tr>";
                var kk = 0;
                var str = null;
                var oldnum = 0;
                var oldinvoicenum = null;
                var due=null;
                var css = "";
                var sno=0;
                var len1=0;
                var ln = evalRsp.NotRenewalList.length;
                for(var i = 0 ; i < ln ; i++ )
                {
                        if(evalRsp.NotRenewalList[i].ORDERNUMBER !=null && evalRsp.NotRenewalList[i].ORDERNUMBER != oldnum ){
                                kk++;
			}else if(evalRsp.NotRenewalList[i].ORDERNUMBER == null){
                                kk++;
			}
                        if(kk%2!=0){
                                css="s_row111";
                        }else{
                                css="s_row2";
			}
                        var rowStr = "<tr onMouseOver=\"tblRollOver(this)//;\" onMouseOut=\"tblRollOut(this);\" class=\""+css+"\">";
                        rowStr += "<td>"+evalRsp.NotRenewalList[i].ORDERNUMBER+" - "+evalRsp.NotRenewalList[i].INVOICENUMBER+"</td>";
                        
			//Productname
                        rowStr += "<td>"+evalRsp.NotRenewalList[i].PRODUCTNAME+"</td>";
                        //REsellerName
                        rowStr += "<td>"+evalRsp.NotRenewalList[i].RESELLERNAME+"</td>";
                        //Username
                        rowStr += "<td>"+evalRsp.NotRenewalList[i].USERNAME+"</td>";
                        //usermail
                        rowStr += "<td>"+evalRsp.NotRenewalList[i].USERMAIL+"</td>";
                        //tomail
			//rowStr += "<td>"+evalRsp.NotRenewalList[i].TOMAILID+"</td>";
                        //gendate
                        var gendate = evalRsp.NotRenewalList[i].GENERATIONDATE.split(" ");
                        rowStr += "<td>"+gendate[0]+"</td>";
                        //expirydate
                        rowStr += "<td>"+evalRsp.NotRenewalList[i].EXPIRYDATE+"</td>";
                        rowStr += "<td>"+evalRsp.NotRenewalList[i].AMSEXPIRYDATE+"</td>";
                        //link:
                        rowStr += "<td><a href=\"#group1"+i+"\" id=\"orderdetails"+i+"\" onclick=\"getProperties("+evalRsp.NotRenewalList[i].LICENSEID+",'License Info ', 'moredetails"+i+"','orderdetails"+i+"', 450, event,'"+evalRsp.NotRenewalList[i].DATE+"');\">More </a><div id=\"moredetails"+i+"\" style=\"display:none;\"> </div></td>";

			//country
			rowStr += "<td>"+evalRsp.NotRenewalList[i].Country+"</td>";
                        rowStr += "</tr>";
                        if(evalRsp.NotRenewalList[i].ORDERNUMBER !=null){
                        oldnum = parseInt(evalRsp.NotRenewalList[i].ORDERNUMBER);}

                        if(evalRsp.NotRenewalList[i].INVOICENUMBER !="-"){
                                oldinvoicenum = evalRsp.NotRenewalList[i].INVOICENUMBER;}


                displayStr += rowStr;
                }
                displayStr +="</table>";
                displayStr += "<input type=\"hidden\" name=\"length1\" id=\"length1\" value=\""+len1+"\">";
                //displayStr += "<div><strong>Total : "+len1+"</div></strong>";
                //document.getElementById("displayNotRenewed").innerHTML=displayStr;

                }//end of fi

		//second if
                if(evalRsp.NotRenewalList1.length > 0)
                {
                displayStr += "<div><strong>Total : "+evalRsp.NotRenewalList1.length+"</strong></div>";
                displayStr += "<table width='100%' id='dataTbli' cellspacing='0' cellpadding='0' style='margin-top:20px; border:1px solid #A9A9A9'><tr class='rowheader'></th><th>OrderID - Inv ID</th><th>ProductName</th><th>ResellerName</th><th>UserName</th><th>UserMail</th><!--th>ToEmail</th--><th>GenDate</th><th>Expiry</th><th>AMS Expiry</th><th>LicenseDetails</th><th>Renewed LicenseID</th><th>InvoiceCountry</th></tr>";
                var kk = 0;
                var str = null;
                var oldnum = 0;
                var oldinvoicenum = null;
                var due=null;
                var css = "";
                var sno=0;
                var len1=0;
                var ln = evalRsp.NotRenewalList1.length;
                for(var i = 0 ; i < ln ; i++ )
                {
                        if(evalRsp.NotRenewalList1[i].ORDERNUMBER !=null && evalRsp.NotRenewalList1[i].ORDERNUMBER != oldnum ){
                                kk++;
                        }else if(evalRsp.NotRenewalList1[i].ORDERNUMBER == null){
                                kk++;
			}
                        if(kk%2!=0){
                                css="s_row111";
                        }else{
                                css="s_row2";
			}
                        var rowStr = "<tr onMouseOver=\"tblRollOver(this)//;\" onMouseOut=\"tblRollOut(this);\" class=\""+css+"\">";

                        rowStr += "<td>"+evalRsp.NotRenewalList1[i].ORDERNUMBER+" - "+evalRsp.NotRenewalList1[i].INVOICENUMBER+"</td>";
                        
			//Productname
                        rowStr += "<td>"+evalRsp.NotRenewalList1[i].PRODUCTNAME+"</td>";
                        //REsellerName
                        rowStr += "<td>"+evalRsp.NotRenewalList1[i].RESELLERNAME+"</td>";
                        //Username
                        rowStr += "<td>"+evalRsp.NotRenewalList1[i].USERNAME+"</td>";
                        //usermail
                        rowStr += "<td>"+evalRsp.NotRenewalList1[i].USERMAIL+"</td>";
                        //tomail
                        //rowStr += "<td>"+evalRsp.NotRenewalList[i].TOMAILID+"</td>";
                        //gendate
                        var gendate = evalRsp.NotRenewalList1[i].GENERATIONDATE.split(" ");
                        rowStr += "<td>"+gendate[0]+"</td>";
                        //expirydate
                        rowStr += "<td>"+evalRsp.NotRenewalList1[i].EXPIRYDATE+"</td>";
                        rowStr += "<td>"+evalRsp.NotRenewalList1[i].AMSEXPIRYDATE+"</td>";

                        //link
                        rowStr += "<td><a href=\"#group2"+i+"\" id=\"renewedorderdetails"+i+"\" onclick=\"getProperties("+evalRsp.NotRenewalList1[i].LICENSEID+",'License Info ', 'reneweddetails"+i+"','renewedorderdetails"+i+"', 450, event,'"+evalRsp.NotRenewalList1[i].DATE+"');\">More </a><div id=\"reneweddetails"+i+"\" style=\"display:none;\"> </div></td>"

			rowStr +="<td><a href=\"#group2new"+i+"\" id=\"newrenewedorderdetails"+i+"\" onclick=\"getProperties("+evalRsp.NotRenewalList1[i].RENEWED_LICENSEID+",'License Info ', 'newrenewedetails"+i+"','newrenewedorderdetails"+i+"', 450, event,'"+evalRsp.NotRenewalList1[i].RENEWED_DATE+"');\">"+evalRsp.NotRenewalList1[i].RENEWED_LICENSEID+"</a><div id=\"newrenewedetails"+i+"\" style=\"display:none;\"> </div></td>";
			
			//country
			rowStr += "<td>"+evalRsp.NotRenewalList1[i].Country+"</td>";
                        rowStr += "</tr>";
                        if(evalRsp.NotRenewalList1[i].ORDERNUMBER !=null){
                        oldnum = parseInt(evalRsp.NotRenewalList1[i].ORDERNUMBER);}

                        if(evalRsp.NotRenewalList1[i].INVOICENUMBER !="-"){
                                oldinvoicenum = evalRsp.NotRenewalList1[i].INVOICENUMBER;}


                displayStr += rowStr;
                }
                displayStr +="</table>";
                displayStr += "<input type=\"hidden\" name=\"length1\" id=\"length1\" value=\""+len1+"\">";

                }//end of second if

		//third if
                if(evalRsp.UpgradeList.length > 0)
                {
                displayStr += "<div><strong>Total : "+evalRsp.UpgradeList.length+"</strong></div>";
                displayStr += "<table width='100%' id='dataTbli' cellspacing='0' cellpadding='0' style='margin-top:20px; border:1px solid #A9A9A9'><tr class='rowheader'><th>OrderID - Inv ID</th><th>ProductName</th><th>ResellerName</th><th>UserName</th><th>UserMail</th><!--th>ToEmail</th--><th>GenDate</th><th>Expiry</th><th>AMS Expiry</th><th>LicenseDetails</th><th>Upgrade LicenseID</th><th>InvoiceCountry</th></tr>";
                var kk = 0;
                var str = null;
                var oldnum = 0;
                var oldinvoicenum = null;
                var due=null;
                var css = "";
                var sno=0;
                var len1=0;
                var ln = evalRsp.UpgradeList.length;
                for(var i = 0 ; i < ln ; i++ )
                {
                        if(evalRsp.UpgradeList[i].ORDERNUMBER !=null && evalRsp.UpgradeList[i].ORDERNUMBER != oldnum ){
                                kk++;
                        }else if(evalRsp.UpgradeList[i].ORDERNUMBER == null){
                                kk++;
			}
                        if(kk%2!=0){
                                css="s_row111";
                        }else{
                                css="s_row2";
			}
                        var rowStr = "<tr onMouseOver=\"tblRollOver(this)//;\" onMouseOut=\"tblRollOut(this);\" class=\""+css+"\">";
                        rowStr += "<td>"+evalRsp.UpgradeList[i].ORDERNUMBER+" - "+evalRsp.UpgradeList[i].INVOICENUMBER+"</td>";
                        
			//Productname
                        rowStr += "<td>"+evalRsp.UpgradeList[i].PRODUCTNAME+"</td>";
                        //REsellerName
                        rowStr += "<td>"+evalRsp.UpgradeList[i].RESELLERNAME+"</td>";
                        //Username
                        rowStr += "<td>"+evalRsp.UpgradeList[i].USERNAME+"</td>";
                        //usermail
                        rowStr += "<td>"+evalRsp.UpgradeList[i].USERMAIL+"</td>";
                        //tomail
                        //rowStr += "<td>"+evalRsp.NotRenewalList[i].TOMAILID+"</td>";
                        //gendate
                        var gendate = evalRsp.UpgradeList[i].GENERATIONDATE.split(" ");
                        rowStr += "<td>"+gendate[0]+"</td>";
                        //expirydate
                        rowStr += "<td>"+evalRsp.UpgradeList[i].EXPIRYDATE+"</td>";
                        rowStr += "<td>"+evalRsp.UpgradeList[i].AMSEXPIRYDATE+"</td>";

                        //link
                        rowStr += "<td><a href=\"#group3"+i+"\" id=\"upgradeorderdetails"+i+"\" onclick=\"getProperties("+evalRsp.UpgradeList[i].LICENSEID+",'License Info ', 'upgradedetails"+i+"','upgradeorderdetails"+i+"', 450, event,'"+evalRsp.UpgradeList[i].DATE+"');\">More </a><div id=\"upgradedetails"+i+"\" style=\"display:none;\"> </div></td>"

			rowStr +="<td><a href=\"#group3new"+i+"\" id=\"newupgradeorderdetails"+i+"\" onclick=\"getProperties("+evalRsp.UpgradeList[i].UPGRADE_LICENSEID+",'License Info ', 'newupgradedetails"+i+"','newupgradeorderdetails"+i+"', 450, event,'"+evalRsp.UpgradeList[i].UPGRADE_DATE+"');\">"+evalRsp.UpgradeList[i].UPGRADE_LICENSEID+"</a><div id=\"newupgradedetails"+i+"\" style=\"display:none;\"> </div></td>";
                        rowStr += "<input type=\"hidden\" name=\"newupgradelicense"+sno+"\" id=\"newupgradelicense"+evalRsp.UpgradeList[i].UPGRADE_LICENSEID+"\" value=\'"+evalRsp.UpgradeList[i].UPGRADE_LICENSEID+"\'>";
                        rowStr += "<input type=\"hidden\" name=\"newupgradeorder"+sno+"\" id=\"newupgradeorder"+sno+"\" value=\'"+evalRsp.UpgradeList[i].UPGRADE_ORDERNUMBER+"\'>";

			//country
			rowStr += "<td>"+evalRsp.UpgradeList[i].Country+"</td>";
                        rowStr += "</tr>";
                        if(evalRsp.UpgradeList[i].ORDERNUMBER !=null){
                        oldnum = parseInt(evalRsp.UpgradeList[i].ORDERNUMBER);
			}
                        if(evalRsp.UpgradeList[i].INVOICENUMBER !="-"){
                                oldinvoicenum = evalRsp.UpgradeList[i].INVOICENUMBER;
			}

                displayStr += rowStr;
                }
                displayStr +="</table>";
                displayStr += "<input type=\"hidden\" name=\"length1\" id=\"length1\" value=\""+len1+"\">";
                //displayStr += "<div><strong>Total : "+len1+"</div></strong>";
                //document.getElementById("displayNotRenewed").innerHTML=displayStr;

                }//end of third if
		document.getElementById("displayNotRenewed").innerHTML=displayStr;
                }//end of first tab
                if(evalRsp.ExpiryList.length > 0)
                {
                displayStr = "<div><strong>Total : "+evalRsp.ExpiryList.length+"</strong></div>";
                displayStr += "<table width='100%' id='dataTbli' cellspacing='0' cellpadding='0' style='margin-top:20px; border:1px solid #A9A9A9'><tr class='rowheader'><th>OrderID - Inv ID</th><th>ProductName</th><th>ResellerName</th><th>UserName</th><th>UserMail</th><!--th>ToEmail</th--><th>GenDate</th><th>Expiry</th><th>AMS Expiry</th><th>LicenseDetails</th><th>InvoiceCountry</th></tr>";
                var kk = 0;
                var str = null;
                var oldnum = 0;
                var oldinvoicenum = null;
                var due=null;
                var css = "";
                var sno=0;
                var len1=0;
                var ln = evalRsp.ExpiryList.length;
                for(var i = 0 ; i < ln ; i++ )
                {
                        if(evalRsp.ExpiryList[i].ORDERNUMBER !=null && evalRsp.ExpiryList[i].ORDERNUMBER != oldnum ){
                                kk++;
                        }else if(evalRsp.ExpiryList[i].ORDERNUMBER == null){
                                kk++;
			}
                        if(kk%2!=0){
                                css="s_row111";
                        }else{
                                css="s_row2";
			}
                        var rowStr = "<tr onMouseOver=\"tblRollOver(this)//;\" onMouseOut=\"tblRollOut(this);\" class=\""+css+"\">";
                        rowStr += "<td>"+evalRsp.ExpiryList[i].ORDERNUMBER+" - "+evalRsp.ExpiryList[i].INVOICENUMBER+"</td>";
                        //rowStr += "&nbsp;&nbsp;"+sno+"&nbsp;&nbsp;license"+sno;

                        //licenseid
                        //rowStr += "<td>"+evalRsp.NotRenewalList[i].LICENSEID+"</td>";
                        //Productname
                        rowStr += "<td>"+evalRsp.ExpiryList[i].PRODUCTNAME+"</td>";
                        //REsellerName
                        rowStr += "<td>"+evalRsp.ExpiryList[i].RESELLERNAME+"</td>";
                        //Username
                        rowStr += "<td>"+evalRsp.ExpiryList[i].USERNAME+"</td>";
                        //usermail
                        rowStr += "<td>"+evalRsp.ExpiryList[i].USERMAIL+"</td>";
			//tomail
                        //rowStr += "<td>"+evalRsp.NotRenewalList[i].TOMAILID+"</td>";
                        //gendate
                        var gendate = evalRsp.ExpiryList[i].GENERATIONDATE.split(" ");
                        rowStr += "<td>"+gendate[0]+"</td>";
                        //expirydate
                        rowStr += "<td>"+evalRsp.ExpiryList[i].EXPIRYDATE+"</td>";
                        rowStr += "<td>"+evalRsp.ExpiryList[i].AMSEXPIRYDATE+"</td>";
                        //link:
                        //rowStr += "<td><a href=\"#<%=i%>\" id=\"order_search<%=i%>\" onclick=\"addproductsPopUp2('License Info', 'olddetails_search<%=i%>','order_search<%=i%>', 450, event);\">Details >> </a></td>";
                        rowStr += "<td><a href=\"#group4"+i+"\" id=\"expirydetails"+i+"\" onclick=\"getProperties("+evalRsp.ExpiryList[i].LICENSEID+",'License Info ', 'expirymoredetails"+i+"','expirydetails"+i+"', 450, event,'"+evalRsp.ExpiryList[i].DATE+"');\">More </a><div id=\"expirymoredetails"+i+"\" style=\"display:none;\"> </div></td>";
			//country
                        rowStr += "<td>"+evalRsp.ExpiryList[i].Country+"</td>";
                        rowStr += "</tr>";
                        if(evalRsp.ExpiryList[i].ORDERNUMBER !=null){
                        oldnum = parseInt(evalRsp.ExpiryList[i].ORDERNUMBER);
			}
                        if(evalRsp.ExpiryList[i].INVOICENUMBER !="-"){
                                oldinvoicenum = evalRsp.ExpiryList[i].INVOICENUMBER;
			}

                displayStr += rowStr;
                }
                displayStr +="</table>";
                displayStr += "<input type=\"hidden\" name=\"length1\" id=\"length1\" value=\""+len1+"\">";
                //displayStr += "<div><strong>Total : "+len1+"</div></strong>";
                document.getElementById("displayExpiry").innerHTML=displayStr;

                }//end of second tab

		if(evalRsp.RenewedList.length > 0)
                {
                displayStr = "<div><strong>Total : "+evalRsp.RenewedList.length+"</strong></div>";
                displayStr += "<table width='100%' id='dataTbli' cellspacing='0' cellpadding='0' style='margin-top:20px; border:1px solid #A9A9A9'><tr class='rowheader'><th>OrderID - Inv ID</th><th>ProductName</th><th>ResellerName</th><th>UserName</th><th>UserMail</th><!--th>ToEmail</th--><th>GenDate</th><th>Expiry</th><th>AMS Expiry</th><th>LicenseDetails</th><th>InvoiceCountry</th></tr>";
                var kk = 0;
                var str = null;
                var oldnum = 0;
                var oldinvoicenum = null;
                var due=null;
                var css = "";
                var sno=0;
                var len1=0;
                var ln = evalRsp.RenewedList.length;
                for(var i = 0 ; i < ln ; i++ )
                {
                        if(evalRsp.RenewedList[i].ORDERNUMBER !=null && evalRsp.RenewedList[i].ORDERNUMBER != oldnum ){
                                kk++;
                        }else if(evalRsp.RenewedList[i].ORDERNUMBER == null){
                                kk++;
			}
                        if(kk%2!=0){
                                css="s_row111";
                        }else{
                                css="s_row2";
			}

			var rowStr = "<tr onMouseOver=\"tblRollOver(this)//;\" onMouseOut=\"tblRollOut(this);\" class=\""+css+"\">";
                        rowStr += "<td>"+evalRsp.RenewedList[i].ORDERNUMBER+" - "+evalRsp.RenewedList[i].INVOICENUMBER+"</td>";

                        //Productname
                        rowStr += "<td>"+evalRsp.RenewedList[i].PRODUCTNAME+"</td>";
                        //REsellerName
                        rowStr += "<td>"+evalRsp.RenewedList[i].RESELLERNAME+"</td>";
                        //Username
                        rowStr += "<td>"+evalRsp.RenewedList[i].USERNAME+"</td>";
                        //usermail
                        rowStr += "<td>"+evalRsp.RenewedList[i].USERMAIL+"</td>";
                        //tomail
                        //rowStr += "<td>"+evalRsp.NotRenewalList[i].TOMAILID+"</td>";
                        //gendate
                        var gendate = evalRsp.RenewedList[i].GENERATIONDATE.split(" ");
                        rowStr += "<td>"+gendate[0]+"</td>";
                        //expirydate
                        rowStr += "<td>"+evalRsp.RenewedList[i].EXPIRYDATE+"</td>";
                        rowStr += "<td>"+evalRsp.RenewedList[i].AMSEXPIRYDATE+"</td>";

			//link:
                        //rowStr += "<td><a href=\"#<%=i%>\" id=\"order_search<%=i%>\" onclick=\"addproductsPopUp2('License Info', 'olddetails_search<%=i%>','order_search<%=i%>', 450, event);\">Details >> </a></td>";
                        rowStr += "<td><a href=\"#group5"+i+"\" id=\"renewedlist"+i+"\" onclick=\"getProperties("+evalRsp.RenewedList[i].LICENSEID+",'License Info ', 'renewedlistdetails"+i+"','renewedlist"+i+"', 450, event,'"+gendate[0]+"');\">More </a><div id=\"renewedlistdetails"+i+"\" style=\"display:none;\"> </div></td>";
			//country
                        rowStr += "<td>"+evalRsp.RenewedList[i].Country+"</td>";
                        rowStr += "</tr>";
                        if(evalRsp.RenewedList[i].ORDERNUMBER !=null){
                        oldnum = parseInt(evalRsp.RenewedList[i].ORDERNUMBER);
			}
                        if(evalRsp.RenewedList[i].INVOICENUMBER !="-"){
                                oldinvoicenum = evalRsp.RenewedList[i].INVOICENUMBER;
			}

                displayStr += rowStr;
                }
                displayStr +="</table>";
                displayStr += "<input type=\"hidden\" name=\"length1\" id=\"length1\" value=\""+len1+"\">";
               // displayStr += "<div><strong>Total : "+len1+"</div></strong>";
                document.getElementById("displayRenewed").innerHTML=displayStr;
		}
        }
        

        else
        {
                displayStr = "<table width=\"100%\" border=\"0\" cellpadding=\"0\" cellspacing=\"0\" bgcolor=\"#EFEFEF\"><tr><td><p>&nbsp;</p><center><p><br><b>No matches found for the specified criteria. Please redefine your search</b></p> </center><br><br></td></tr></table>";

        }
//        document.getElementById("displayNotRenewed").innerHTML=displayStr;
	}
}
function displayRenewalReport(arg)
{
        if(arg =="notrenewed")
        {
                document.getElementById("displayNotRenewalDetails").style.display="block";
                document.getElementById("displayRenewalDetails").style.display="none";
                document.getElementById("displayExpiryDetails").style.display="none";
                document.getElementById("notrenewed").style.background = "#A9F5F2";
                document.getElementById("renewed").style.background = "white";
                document.getElementById("expiry").style.background = "white";
        }
        else if(arg =="renewed")
        {
                document.getElementById("displayNotRenewalDetails").style.display="none";
                document.getElementById("displayRenewalDetails").style.display="block";
                document.getElementById("displayExpiryDetails").style.display="none";
                document.getElementById("notrenewed").style.background = "white";
                document.getElementById("renewed").style.background = "#A9F5F2";
                document.getElementById("expiry").style.background = "white";
        }
        else if(arg =="expiry")
        {
                document.getElementById("displayNotRenewalDetails").style.display="none";
                document.getElementById("displayRenewalDetails").style.display="none";
                document.getElementById("displayExpiryDetails").style.display="block";
                document.getElementById("notrenewed").style.background = "white";
                document.getElementById("renewed").style.background = "white";
                document.getElementById("expiry").style.background = "#A9F5F2";
        }


}
function getResellerAmountLimit(arg)
{
        //check whether this credit limit is already set for this reseller

        var url = '/license/adminaction.do?method=getAmountLimitDetailsForReseller&resellername='+document.getElementById("resellername").value;
        if(arg == "requestform")
        {
        url += '&jspurl=request.jsp';
        }
        else if(arg == "payments")
        {
        url += "&jspurl=UpdatePayment.jsp";
        }
	else if(arg === "skuform")
	{
		url += "&jspurl=GeneratePartNumberLicense.jsp";
	}
        //alert(":::;url:"+url);

        sendAsyncAJAXRequest('GET',url,handleResellerAmountLimit, new Array());
	orderConfirmation();
}
function handleResellerAmountLimit(xmlhttp,arrArg)
{
        //alert(":::::handleResellerAmountLimit:"+xmlhttp.responseText);
        if(xmlhttp.readyState == 4)
        {
                var rsp = xmlhttp.responseText;
                //var evalRsp = eval('('+rsp+')');
		var evalRsp = ( new Function( 'return ' +rsp))();
                if(evalRsp.enable_cash_carry == "true")
                {
                        //alert(":This invoice not exists in DB");
                        //return ;
			var str="";
                        document.getElementById("paidAmtDiv").style.display="block";
                        str += "<div class='divTabRow clearfix'><div class='divTabCol' nowrap><font color ='red'>Last Payment </font></div><div class='divTabColLS'>: "+evalRsp.paid_amount+"</div></div>";
                        str += "<div class='divTabRow clearfix'><div class='divTabCol' nowrap><font color ='red'>Balance Amount </font></div><div class='divTabColLS'>: "+evalRsp.balance_amount+"</div></div>";
                        str += "<div class='divTabRow clearfix'><div class='divTabCol' nowrap><font color ='red'>Threshold Limit </font></div><div class='divTabColLS'>: "+evalRsp.threshold_limit+"</div></div>";
                        str += "<input type=\"hidden\" name=\"balAmt\" id=\"balAmt\" value='"+evalRsp.balance_amount+"'>";
                        str +="  <input type=\"hidden\" name=\"thresholdLimit\" id=\"thresholdLimit\" value='"+evalRsp.threshold_limit+"'>";
                        str += "<input type=\"hidden\" name=\"enableapproval_negativebal\" id=\"enableapproval_negativebal\" value='"+evalRsp.enableapproval_negativebal+"'>";
                        str += "<input type=\"hidden\" name=\"enableapproval_lessbal\" id=\"enableapproval_lessbal\" value = '"+evalRsp.enableapproval_lessbal+"'>";

                        document.getElementById("paidAmtDiv").innerHTML = str;

                        if(document.getElementById("getAmtDiv")!=null)
                        {
                        document.getElementById("getAmtDiv").style.display="table-row";
                        }

                }
                else
                {
                        document.getElementById("paidAmtDiv").innerHTML = "";
                        document.getElementById("paidAmtDiv").style.display="none";
                        if(document.getElementById("getAmtDiv")!=null)
                        {
				document.getElementById("getAmtDiv").style.display="none";
                        }
                }
        }
}
function editPOAmt(orderNumber,poamtfield,div,podiv)
{
        //alert(":editPOAmt::"+orderNumber);
        var poamount = document.getElementById(poamtfield).value;
        //alert(":::::PO AMOUNT :"+poamount);
        sendAsyncAJAXRequest('GET','/license/adminaction.do?method=editPOAmount&ordernumber='+orderNumber+'&poamount='+poamount,handleEDitPOAmount, new Array(orderNumber,poamtfield,podiv));
        document.getElementById(podiv).innerHTML="<b><font color=\"red\">PO Amount :"+poamount+"</font></b>";
        document.getElementById("editContainer").style.display="none";
        document.getElementById("disableDiv").style.display="none";

}
function handleEDitPOAmount(xmlhttp,arrArg)
{
        //alert(":::::handleResellerAmountLimit:"+xmlhttp.responseText);
        if(xmlhttp.readyState == 4)
        {
                var rsp = xmlhttp.responseText;
                //var evalRsp = eval('('+rsp+')');
		var evalRsp = ( new Function( 'return ' +rsp))();
                /*if(evalRsp.enable_cash_carry == "true")
                {
                }*/
        }
}
function checkBal()
{
        if(document.getElementById("balAmt")!=null )//enable_cahs_carry
	{
		if(document.getElementById("balAmt").value == '-')
		{
			alert(" Balance is low, can't place orders");
			return false;
		}	
        var balAmt = parseFloat(document.getElementById("balAmt").value);
        var thresholdLimit = parseFloat(document.getElementById("thresholdLimit").value);
	var orderamt = 0;
	
	if(document.getElementById("getAmt").value == "" || isNaN(document.getElementById("getAmt").value) || 
		parseFloat(document.getElementById("getAmt").value) <=0)
	{
		alert("Enter correct Value in Enter Amount field");
		return false;
	}

       	orderamt = parseFloat(document.getElementById("getAmt").value);

	if(orderamt > 0.01)
	{
        var finalBalAmt = balAmt - orderamt;
        var enableapproval_negativebal = document.getElementById("enableapproval_negativebal").value;
        var enableapproval_lessbal = document.getElementById("enableapproval_lessbal").value;
        if(finalBalAmt < 0) //if balance amt goes negative don't approve the order"
        {
                if(enableapproval_negativebal=="true")
                {
                        if(balAmt < 0)
                        {
                                alert("Already your balance amount goes negative");
                        }
                        else
                        {
                                alert("Submission of this will make your balance amount negative ");
                        }
                        return true;
                }
                else
                {
                        if(balAmt < 0)
                        {
                                alert("You can't place order, already your balance amount goes negative.\nKindly make the payment to place orders. ");
                        }
                        else
                        {
                                alert("You can't place order, submission of this will make your balance amount negative. \nKindly make the payment to place orders. ");
                        }
			return false;
                }

        }
        else if(finalBalAmt < thresholdLimit) //balace amt is in positive value, but less than threshole limit 
        {
                if(enableapproval_lessbal=="true")
                {
                        alert("Submission of this order will make the balance amount less than your threshold limit, Kindly make the payment. ");
                        return true;
                }
                else
                {
                        alert("Submission of this order will make the balance amount less than your threshold limit, Kindly make the payment to place order.");
                        return false;
                }
        }
	}
	}
        return true;

}
function openURL(arg,ordernum )
{
	//alert(arg);
	//if(arg != "renew"){
	var openuri = true;
	if(getDL("previouslicense")!=null && !isNaN(getDL("previouslicense").value) && getDL("previousproduct") != null && getDL("select").value == getDL("previousproduct").value
			&& getDL("licensestatus")!=null &&  getDL("licensestatus").value == arg){
		openuri = confirm("Click (Ok) to search the old licenses (Cancel) to proceed to send license");	
	}
	if(openuri){
		var username = document.getElementById("username").value;
		var companyname = document.getElementById("companyname").value;
		var useremail = document.getElementById("useremail").value;
		var secondid = document.getElementById("secondid").value;
		var tomailid = document.getElementById("tomailid").value;
		var ccmailid = document.getElementById("ccmailid").value;
		var pocompanyname = "";
		if (document.getElementById("pocompanyname") != null) {
			pocompanyname = document.getElementById("pocompanyname").value
		}
		var currencysymbol = "";
		if(document.getElementById("currencysymbol") != null)
		{
			currencysymbol = document.getElementById("currencysymbol").value;
		}
		var ponumber = "";
		if(document.getElementById("ponumber") != null)
		{
			ponumber = document.getElementById("ponumber").value ; 
		}
		//billing details in US intallation
		var billingcountry = "";
		if(document.getElementById("billingcountry") != null)
		{
			billingcountry = document.getElementById("billingcountry").value
		}
		var billingstate = "";
		if(document.getElementById("billingstate") != null)
		{
			billingstate = document.getElementById("billingstate").value
		}
		var billingcity = "";
		if(document.getElementById("billingcity") != null)
		{
			billingcity = document.getElementById("billingcity").value
		}
		var billingcode = "";
		if(document.getElementById("billingcode") != null)
		{
			billingcode = document.getElementById("billingcode").value
		}
		var billingstreet = "";
		if(document.getElementById("billingstreet") != null)
		{
			billingstreet = document.getElementById("billingstreet").value
		}
		var transactionid = "";
		if(getDL("transaction_id")!=null){
			transactionid =	getDL("transaction_id").value;	
		}
		var country = "";	
			if(document.getElementById("country") != null)	
			{	
				country = document.getElementById("country").value;	
			}	
			var state = "";	
			if(document.getElementById("state") != null)	
			{	
				state = document.getElementById("state").value;	
			}
	        var searchkey = document.getElementById("useremail").value;
		if(searchkey == "" ){
			searchkey = document.getElementById("companyname").value;
		}
	        var productid = document.getElementById("select").value;
        	if(productid == "[select]"){
			var userType = document.getElementsByName("usertype");
			if(userType.length > 0){
				for(i = 0; i < userType.length; i++){
					document.getElementsByName("usertype")[i].checked = false;
				}
			}
                	alert("Select any product");
               		return;
        	}
	        if(searchkey == ""){
			var userType = document.getElementsByName("usertype");
                	if(userType.length > 0){
             	        	for(i = 0; i < userType.length; i++){
                                	document.getElementsByName("usertype")[i].checked = false;
                        	}
                	}
                	alert("Enter User Mail id / Company Name");
                	return;
        	}
	        
	       
	      //if(cartArrayDetails.length > 0)
	        var cartArr = JSON.stringify(cartArrayDetails) ;
	        
	        //document.getElementById("cartArr").value = cartArr ; 
	        
	        var resname = document.getElementById("resellername").value ; 

    		if(getDL("progrees") != null){
			getDL("progrees").style.display="block";
			if(isEmptyRenewlPopupAllowed == 0 && getDL("addprdbutton") != null){
			getDL("addprdbutton").style.display="none";
			getDL("sendbutton").style.display="none";
			}	
		}
    		var url = "/license/cartdetails.do?action=setCartValue";
	        if(cartArrayDetails.length > 0)
	        	{
	        		url += "&cartArr="+cartArr;
	        	}
		    	url += '&resellername='+resname+'&username='+username+'&companyname='+companyname+'&useremail='+useremail+'&secondid='+secondid+'&tomailid='+tomailid+'&ccmailid='+ccmailid+'&country='+country+'&state='+state;
		        url += "&currencysymbol="+currencysymbol+"&ponumber="+ponumber+"&billingcountry="+billingcountry+"&billingstate="+billingstate+"&billingcity="+billingcity+"&billingcode="+billingcode+"&billingstreet="+billingstreet+ '&pocompanyname=' + pocompanyname;
		        var urlstr = '/license/jsp/upgrade.jsp?searchkey='+searchkey+'&poname='+ajaxPOName+'&quotename='+ajaxQuoteName+'&resellername='+resname+'&productid='+productid+'&ordernum='+ordernum+'&username='+username+'&companyname='+companyname+'&useremail='+useremail+'&secondid='+secondid+'&tomailid='+tomailid+'&ccmailid='+ccmailid+'&transaction_id='+transactionid+'&licensestatus='+arg+"&limit=5&industry="+getIndustry().join()+'&country='+country+'&state='+state;
			if(getDL("monthly_subscription_yes") != null && getDL("monthly_subscription_yes").checked == true)
                        {
                                url += "&monthlylicense";
                                urlstr += "&monthlylicense";
                        }
		         sendAsyncAJAXRequest('POST',url,handleGetCartDetails, new Array(urlstr,ordernum,arg,searchkey,productid));
		        
	        	
	        /*else
	        	{
			 var url ="/license/jsp/upgrade.jsp?searchkey="+searchkey+"&poname="+ajaxPOName+"&quotename="+ajaxQuoteName+"&resellername="+resname+"&productid="+productid+"&ordernum="+ordernum+"&username="+username+"&companyname="+companyname+"&useremail="+useremail+"&secondid="+secondid+"&tomailid="+tomailid+"&ccmailid="+ccmailid+"&transaction_id="+transactionid+"&licensestatus="+arg+"&limit=5";     
			 sendAsyncAJAXRequest("GET",url,handlepopup,new Array(ordernum,"event"));
	                
	        	}*/
		}
	//}
}
function handlepopup(xmlhttp,arrArg){          
	if (xmlhttp.readyState == 4) {  
		if(getDL("addprdbutton") != null && isEmptyRenewlPopupAllowed == 0){        
		getDL("addprdbutton").style.display="none";
			getDL("sendbutton").style.display="none";
		}
    		if(getDL("progrees") != null){
			getDL("progrees").style.display="none";	
		}
    		if(getDL("progreesup") != null){
			getDL("progreesup").style.display="none";	
		}
	        popcontent = "<div class='ovr' id='spoup'><div style='padding-left: 700px;position: fixed;padding-top: 140;'><div id='progreesup'  style='display: none;'><img src='../images/discoverystatus_inprogress.gif'  align='absmiddle'>&nbsp;Please wait . . .</div></div>"+xmlhttp.responseText+"</div>";              
                attrs = {"innerDiv":"spoup","minmax":"minmax"};   
                popupwindow("License Info",popcontent,"popup"+arrArg[0],90,arrArg[1],attrs);
                if(getDL("dataTbl") != null && getDL("dataTbl").rows.length < 6){
        			document.getElementById("showmore").style.display = "none";
        		}
	}
}


function orderConfirmation(){
	/*if(isValid(getDL("select")) && (isFreeLicenseAvailable()) && isValid(getDL("resellername")) && getDL("resellername").value != 0 && isValid(getUserType())){
		var url = "/license/freeproducts.do?reseller="+document.getElementById("resellername").value+"&ordernumber="+JS_ORDERNUM;
		
		var userType = getUserType();
		var jsonForFreeLicenseCheck="";
		if( document.getElementById("licensetype") != null && userType != null){
			jsonForFreeLicenseCheck = '{"freelicense":[{"typeid":"'+document.getElementById("licensetype").value+'","expiry":"'+document.getElementById("expiry").value+'","usertype":"'+userType+'"';
			if(getDL("useremail")!=null && getDL("useremail").value.trim() != ""){
				jsonForFreeLicenseCheck += ',"mail":"'+getDL("useremail").value+'"';
			}
			jsonForFreeLicenseCheck += '}]}';
		}
		url += "&freelicensejsonstr="+jsonForFreeLicenseCheck;
	
		licensebutton(true);
		if(getDL("progrees1") != null){
			getDL("progrees1").style.display="inline-block";
		}
		ajaxSendRequest(url,"no","ordcfrm","orderConfirmation");
	}*/
	showPromo();

}
function isValid(val){
	if(val != null && val !="" && val != "[select]"){
		return true;
	}	
	return false;
}
function getDL(id){
	return document.getElementById(id);	
}
function getUserType(){
	var userType = document.getElementsByName("usertype");
	for(i = 0; i < userType.length; i++){
		if(document.getElementsByName("usertype")[i].checked == true){
			return document.getElementsByName("usertype")[i].value;
		}
	}
	return null;
}
function freeProductCheck(typeid,ev,editionid){
	var freeName = "freelicensecheck" ; 
	var checkboxName = "freelicensecheckbox" ; 
	if(editionid != null)
		{
	 
		freeName = "freelicensecheck_"+editionid ;
		checkboxName = "freelicensecheckbox_"+editionid ; 
		}
	
	
	//freeArr = document.licenserequest.freelicensecheckbox;
	freeArr = document.getElementsByName(checkboxName) ; 
	
	freeIDs="";
	if(freeArr.length != null){
		for( i = 0 ; i < freeArr.length ; i++){
			if(freeArr[i].checked == true){
				freeIDs += freeArr[i].value+",";
			}
		}
		if(freeIDs != "" && freeIDs.charAt(freeIDs.length-1) == ","){
			freeIDs = freeIDs.substr(0,freeIDs.length-1);
		}
		//document.licenserequest.freelicensecheck.value=freeIDs;
		document.getElementById(freeName).value=freeIDs ; 

	}
	else{
		if(document.getElementsByName(checkboxName)[0].checked){
			document.getElementById(freeName).value=document.getElementsByName(checkboxName)[0].value;
		}
		else{
			document.getElementById(freeName).value="";
		}
	}
	if(!document.getElementById("freelicensecheck"+typeid).checked)
	{
		if(editionid != null)
		{
		var strContent = (getDocObj("freeunchecknote").innerHTML).replace(new RegExp("#ARG#","g"),typeid);
		
		strContent = strContent.replace(new RegExp("#EDITIONID#","g"),editionid);
		
		getDocObj("freeunchecknote").innerHTML = strContent ; 

			document.getElementById("freeunchecknote").style.display = "block" ; 
		}
	else
		{
	floatingPopUp1('Comment', 'freeunchecknote', typeid,ev,editionid);
		}
		}
	else{
		getDL("freeunchecknote").style.display = "none" ; 
		checkAndUpdateComplimentContent(typeid,editionid);
	}
}

function checkDataExistance(ev)
{
	if(document.getElementById("monthlylicense") == null)
	{
	document.getElementById("company_cid").value="";
	document.getElementById("company_country").value = "";

	var val = document.getElementById("companyname").value;
        //var url="/license/adminaction.do?method=getCustomerNames&searchvalue="+val;
	if(val.length > 2)
	{
        var url = "/license/cidcreation.do?method=getCustomerNames&searchvalue="+encodeURIComponent(val);
        if(document.getElementById("resellername").value != 0)
        {
                url += "&resellername="+document.getElementById("resellername").value;
        }
        if(document.getElementById("session_user") != null)
        {

        url +="&session_user="+document.getElementById("session_user").value+"&session_user_id="+document.getElementById("session_user_id").value;
        }

        sendAsyncAJAXRequest('GET',url,handlegetCustomerNames,new Array());
	}
	}
}
function handlegetCustomerNames(xmlhttp,arrArg)
{
        if(xmlhttp.readyState == 4)
        {
                var rsp = xmlhttp.responseText;
                //var evalRsp = eval('('+rsp+')');
		var evalRsp = ( new Function( 'return ' +rsp))();
                if(evalRsp.result=="success")
                {
                        if(evalRsp.detail.length  > 0)
                        {
                                var ln = evalRsp.detail.length;
                                var suggest = "";
                                var ss = document.getElementById('search_suggest');

                                ss.innerHTML = "";
                                for(var i = 0 ; i < ln ; i++ )
                                {
                                        suggest = '<div id="search_suggest_'+ (i+1) +'" onmouseover="javascript:suggestOver(this,\'mouse\');" ';

                                        suggest += 'onmouseout="javascript:suggestOut(this);" ';
                                        //suggest += 'onclick="javascript:setFieldValue(this.innerHTML);" ';
                                        suggest += 'onclick="javascript:setFieldValue(\''+evalRsp.detail[i].CUST_COMPANY_NAME+'\',\''+evalRsp.detail[i].COUNTRY+'\',\''+evalRsp.detail[i].CID+'\');" ';
                                        suggest += 'class="suggest_link">' + evalRsp.detail[i].CUST_COMPANY_NAME + " , " + evalRsp.detail[i].COUNTRY + '</div>';
                                         //suggest += evalRsp.detail[1].CID;
                                        ss.innerHTML += suggest;
                                }
                                document.getElementById("search_suggest").style.display="block";
                        }
                }
        }
}

function checkCompanyExists(arg,arg1)
{
        if(document.getElementById("useremail").value  == "")
        {
                alert("Give usermail id");
        }
        else if(document.getElementById("companyname").value == "")
        {
                alert("Give Company Name");
        }

        else if(emailCheck(document.getElementById("useremail").value,"User Email-ID") == false)
        {
                alert("Enter valid user mail id");
        }
	else if(document.getElementById("resellername").value == "0")
        {
                alert("Select Reseller Name");
        }

        else //if(document.getElementById("useremail").value != "" && document.getElementById("companyname").value !="")
        {
                var val = document.getElementById("companyname").value;
                //var url="/license/adminaction.do?method=checkCompanyNameExists&searchvalue="+val;
                var url="/license/cidcreation.do?method=checkCompanyNameExists&searchvalue="+encodeURIComponent(val)+"&json=true";
		sendAsyncAJAXRequest('GET',url,handleCheckCompanyNameExists,new Array(arg,arg1));
        }

}
function handleCheckCompanyNameExists(xmlhttp,arrArg)
{
	if(xmlhttp.readyState == 4)
	{
		var rsp = xmlhttp.responseText;
		//var evalRsp = eval('('+rsp+')');
		var evalRsp = ( new Function( 'return ' +rsp))();
		if(evalRsp.result=="success")
		{
			if(!evalRsp.exists) //if company name not exists, check for company names mapped with user mail domain
			{
				var val = document.getElementById("useremail").value;
				//var url="/license/adminaction.do?method=getCompanyNamesForDomain&searchvalue="+val;
				var url="/license/cidcreation.do?method=getCompanyNamesForDomain&searchvalue="+encodeURIComponent(val);
				sendAsyncAJAXRequest('GET',url,handleGetCompanyNamesForDomain,new Array(arrArg[0],arrArg[1]));
			}
			else//if it is true , 
			{
				if(arrArg[0] == "submitform")
				{
					document.getElementById("company_cid").value = evalRsp.CID;
					var buttonname = arrArg[1];
					document.getElementById(buttonname).click();
				}

			}
		}
	}
}
function handleGetCompanyNamesForDomain(xmlhttp,arrArg)
{
	if(xmlhttp.readyState == 4)
	{
		var rsp = xmlhttp.responseText;
		//var evalRsp = eval('('+rsp+')');
		var evalRsp = ( new Function( 'return ' +rsp))();
		if(evalRsp.result=="success")
		{
			if(evalRsp.exists == "true" || evalRsp.exists) //if company name not selected from pop up, check for company names mapped with user mail domain
			{
				var con = confirm("The given Usermail / domain  mapped with other company name(s) n our database. Click \"Ok\" to fetch end user company name from our db or click \"Cancel\" if the customer/company name  is new ");
				if(con)
				{
					var str = "<table>";
					str += "<tr><td class=\"formtext2\"><input type=\"radio\" name=\"cid\" id=\"0\" onclick=\"setCompanyName('0','0','0')\"></td><td class=\"formtext2\">New <font color=\"red\">(Select if really the customer is new)</font> </td></tr>";
					if(evalRsp.details.length  > 0)
					{
						var ln = evalRsp.details.length;
						for(var i = 0 ; i < ln ; i++ )
						{
							str += "<tr><td class=\"formtext2\"><input type=\"radio\" name=\"cid\" id=\""+evalRsp.details[i].CID+"\" onclick=\"setCompanyName('"+evalRsp.details[i].CID+"','"+evalRsp.details[i].CUST_COMPANY_NAME+"','"+evalRsp.details[i].COUNTRY+"')\"></td><td class=\"formtext2\">"+evalRsp.details[i].CUST_COMPANY_NAME+","+evalRsp.details[i].COUNTRY+"</td></tr>";
						}
					}
					str +="</table>";
					document.getElementById("CompanyNamesDiv").innerHTML = "";
					document.getElementById("CompanyNamesDiv").innerHTML = str;

					if(document.getElementById("enduserinfo") != null){	
							document.getElementById("enduserinfo").style.display="none";	
					}
					document.getElementById("company_cid").value="";
					document.getElementById("company_country").value = "";

					//display company name div
					var content = getDocObj("CAcontent");
					var title = getDocObj("CAtitle");
					var mainContainer = getDocObj("editContainer");
					var header = getDocObj("CAheader");
					title.innerHTML = 'Company Names';
					content.innerHTML = getDocObj("CompanyNamesDiv").innerHTML;
					header.onmousedown = function(event){dragdrop(event,'editContainer')};
					mainContainer.style.width = 600 + "px";
					mainContainer.style.display = 'block';
					mainContainer.style.top = (document.body.scrollTop+(($(window).height()-$("#editContainer").height())/2))+"px";
					mainContainer.style.left = (($(window).width()-$("#editContainer").width())/2)+"px";
					var disDiv = getDocObj("disableDiv");
					disDiv.style.display = 'block';
				}
				else
				{
					if(document.getElementById("enduserinfo") != null){	
						document.getElementById("enduserinfo").style.display="block";	
						}
					document.getElementById("CompanyNamesDiv").innerHTML = "";
					document.getElementById("company_cid").value="new";
					if(arrArg[0] == "submitform")
                                        {
						if(document.getElementById("country").options.length > 1)
						{
                                                alert("You clicked cancel, company name consider as new company.  Please select/check \"End User Country\" field ");
						}
						else
                                                {
                                                        var buttonname = arrArg[1];
                                                        document.getElementById(buttonname).click();
                                                }

                                        }


				}

			}
			else if(evalRsp.exists == "false" || !evalRsp.exists)
			{
				//generate new CID display country DIV
				if(document.getElementById("enduserinfo") != null){	
					document.getElementById("enduserinfo").style.display="table-row";	
					}
				document.getElementById("CompanyNamesDiv").innerHTML = "";
				//document.getElementById("companyLinkDiv").style.display="none";

				document.getElementById("company_cid").value="new";
				if(arrArg[0] == "submitform")
                                {
					if(document.getElementById("country").options.length > 1)
					{
                                        alert("please select/check \"End User Country\" field ");
					}
					else
					{
						var buttonname = arrArg[1];
						document.getElementById(buttonname).click();
					}

			
                                }

			}

		}
	}
}
function setCompanyName(cid,companyname,country)
{
	if(cid == "0")
	{
		document.getElementById("company_cid").value = "new";
		if(document.getElementById("enduserinfo") != null){	
				document.getElementById("enduserinfo").style.display="table-row";	
		}
		document.getElementById("CompanyNamesDiv").innerHTML = "";

	}
	else
	{
		document.getElementById("companyname").value = companyname;
		document.getElementById("company_cid").value = cid;
		document.getElementById("company_country").value = country;
	}

	//      document.getElementById("CompanyNamesDiv").style.display="none";
	document.getElementById("editContainer").style.display="none";
	document.getElementById("disableDiv").style.display="none";
}
//Mouse over function
function suggestOver(div_value,fromMouse)
{
	div_value.className = 'suggest_link_over';
	if(currentSelected != null && currentSelected != "")
	{
		suggestOut("search_suggest_" + currentSelected);
	}

	/*if(fromMouse == null)
	  {
	  setSearch(div_value.innerHTML);
	  }*/
	var idName = div_value.id;
	currentSelected = parseInt(idName.substr("search_suggest_".length,idName.length));
}
//Mouse out function
function suggestOut(div_value)
{
	div_value.className = 'suggest_link';

}


//Click function
function setSearch(value)
{
	//document.getElementById("search_suggest").value = html_entity_decode(value);

	document.getElementById("companyname").value = html_entity_decode(value);
}
function setFieldValue(companyname,country,cid)
{
	//alert("::Value:"+companyname+":::::::"+country);
	//document.getElementById("companyname").value = html_entity_decode(value);
	document.getElementById("companyname").value = companyname;
	document.getElementById("company_cid").value = cid;
	document.getElementById("company_country").value = country;
	if(document.getElementById("enduserinfo") != null){	
			document.getElementById("enduserinfo").style.display="table-row";	
	}
	document.getElementById("search_suggest").innerHTML = "";
	document.getElementById("search_suggest").style.display="none";
}
function html_entity_decode(str) {
	var ta=document.createElement("textarea");
	ta.innerHTML=str.replace(/</g,"&lt;").replace(/>/g,"&gt;");
	return ta.value;
}
document.onclick = docclickhandler;
function docclickhandler() {
	if(document.getElementById("search_suggest")!=null)
	{
		document.getElementById("search_suggest").innerHTML = "";
		document.getElementById("search_suggest").style.display="none";
	}
}

function getCountryForReseller()
{
	//check whether this credit limit is already set for this reseller
	/*if(document.getElementById("resellername").value != "0")
	{
	var url = '/license/adminaction.do?method=getCountryForReseller&resellername='+document.getElementById("resellername").value;
	//var url=cidCreationURL+"license/cidcreation?method=getCountryForReseller&resellername="+document.getElementById("resellername").value;
	sendAsyncAJAXRequest('GET',url,handleCountryForReseller, new Array());
	}*/
}
function handleCountryForReseller(xmlhttp,arrArg)
{
	if(xmlhttp.readyState == 4)
	{
		//alert("::::::::::"+xmlhttp.responseText);
		var rsp = xmlhttp.responseText;
		//var evalRsp = eval('('+rsp+')');
		var evalRsp = ( new Function( 'return ' +rsp))();
		if(document.getElementById("enduserinfo") != null){	
				document.getElementById("enduserinfo").style.display="block";	
			var str = ""
		if(evalRsp.details.length  > 0)
		{
			if(evalRsp.details.length > 1)
			{
				str = "<option value=\"0\">[select]</option>";

			}
			var ln = evalRsp.details.length;

			for(var i = 0 ; i < ln ; i++ )
			{
				str += "<option value='"+evalRsp.details[i].COUNTRY_CODE_3+"'>"+evalRsp.details[i].COUNTRY_NAME+"</option>";

			}
		}
		document.getElementById("country").innerHTML = str;
	}

	}
}
function getReport(type) {
	getDL("progrees").style.display = "inline-block";
	getDL("csv").disabled = true;
	var allprd = "false";
	var url = "/license/fetchreport.do?";
	if (getDL("allprd").checked) {
		url += "allprd=true";
	} else {
		url += "prd=" + getDL("prd").value;
	}
	url += "&from=" + getDL("from").value + " 00:00:00&to=" + getDL("to").value + " 23:59:59&ut="
			+ getMSValuesSC("selectedusertypes") + "&lt="
			+ getMSValuesSC("selectedlicensetypes") + "&rs="
			+ getMSValuesSC("selectedresellers") + "&lp="
			+ getMSValuesSC("selectedlicenseprops") + "&et="
			+ getMSValuesSC("selectedexpirytypes") + "&type=" + type+"&includeresentlicense="+getDL("resentlicense").checked+"&getsubtractedcountforupgrade="+getDL("subtractupgrade").checked+"&inui=true";
	document.location.href=url;
	getDL("progrees").style.display = "none";
}

function getMSValuesSC(id){
	var tag = getDL(id);
	var ret="";
	for(var i = 0 ; i < tag.length ; i++){
		ret = ret+tag[i].value+",";
	}
	return encodeURIComponent(ret.substring(0,ret.length-1));
}
function getLicenseProp(){
	var url="/license/getlicenseprop.do?prd="+getDL("prd").value;
	ajaxSendRequest(url,"no","mm","getLicenseProp");
}
function moveBetWeenLeftAndRight(fromid,toid)
{
	var fromtag = document.getElementById(fromid);
	var totag = document.getElementById(toid);
	swapOptions(fromtag,totag);
}
function licensebutton(val){
	if(getDL("sendbutton")!=null){
		getDL("sendbutton").disabled=val;
	}
	if(getDL("addprdbutton")!=null){
		getDL("addprdbutton").disabled=val;
	}
	if(getDL("updatebutton")!=null){
		getDL("updatebutton").disabled=val;
	}	
	if(getDL("aclaso")!=null){
		getDL("aclaso").disabled=val;
	}
}
function displayInvoiceDiv()
{
	 if(document.getElementById("checkInvoiced").checked === true){
                document.getElementById("checkTr").style.display = "none";
                document.getElementById("invoiceTr").style.display = "table-row";
                document.getElementById("checkInvoiced").checked=false;
                document.getElementById("checkInvoiced1").checked=true;
        }
        else{
                document.getElementById("checkTr").style.display = "table-row";
                document.getElementById("invoiceTr").style.display = "none";
		document.getElementById("invoiceNumber").value = "";
        }

}
function disableUncommonMetrics() {
	if (getDL("allprd").checked) {
		getDL("slt").style.display = "none";
		getDL("slp").style.display = "none";
		getDL("prd").disabled = true;
	} else {
		getDL("slt").style.display = "block";
		getDL("slp").style.display = "block";
		getDL("prd").disabled = false;
	}
}

function generateFromOldLicense(productid,typeid,expiry,jsonStr,licenseStatus,oldlicenseid, cartArr,usertype,supporttype,supportexpiry){
	//alert(typeid);
	getDL("select").value=productid;
        if(getDL("select")!=null && getDL("select").value!=""){
		showHideIpf();
                var evalRsponse = null;
                if(JSON.parse != null){
                        evalRsponse = JSON.parse(jsonStr);
                }
                else{   
                        evalRsponse = JSON.stringify(jsonStr);
                }
 		if(licenseStatus == "edit" || licenseStatus == "resend")
                {
                	document.querySelector('input[value="'+usertype+'"]').checked = true;
                	displayExpiryDate(usertype,expiry);
			if(supporttype != null && supporttype != "null" && supporttype != "" && supporttype != "Classic"){
                		document.querySelector('input[value="'+supporttype+'"]').checked = true;
                		getDL("SupporttypeExpirydiv").style.display = "block";
                		getDL("supporttypeexpiry").value = supportexpiry;
                	}
                }
		if(licenseStatus == "upgrade" || licenseStatus == "RenewalUpgrade"){
                        getDL(licenseStatus).checked=true;
			if(evalRsponse.expiryDate == null || evalRsponse.expiryDate == "" || (licenseStatus == "upgrade" && evalRsponse.userType=="AMS")){
				getDL("perpetual").checked=true;
				makePerpetual();
				if(evalRsponse["AMS+Expiry"] != null){
					makePerpetual();
					getDL("expiry").value=evalRsponse["AMS+Expiry"];
				}
			}
			else{
				getDL("expiry").value=evalRsponse.expiryDate;	
			}
			if(supporttype != null && supporttype != "null" && supporttype != "" && supporttype != "Classic"){
				document.querySelector('input[value="'+supporttype+'"]').checked = true;
        		getDL("SupporttypeExpirydiv").style.display = "block";
        		if(supportexpiry != null && supportexpiry != ""){
        		getDL("supporttypeexpiry").value = supportexpiry;
        		}else{
        			getDL("supporttypeexpiry").value = getDL("expiry").value;
        		}
	    	}
		}
		else if(licenseStatus == "renew" || licenseStatus == "amsrenew"){
	                if(evalRsponse.expiryDate == null || evalRsponse.expiryDate == "" || evalRsponse.userType=="AMS"){
        	                getDL("ams").checked=true;
                	        displayExpiryDate("AMS",expiry);
                	}
         	       	else{   
                	        getDL("renewal").checked=true;
                        	displayExpiryDate("Renewal",expiry);
                	}
			if(supporttype != null && supporttype != "" && supporttype != "null" && supporttype != "Classic"){
	                	document.querySelector('input[value="'+supporttype+'"]').checked = true;
	            		getDL("SupporttypeExpirydiv").style.display = "block";
	            		if(supportexpiry != null && supportexpiry != ""){
	            		getDL("supporttypeexpiry").value = supportexpiry;
	            		}else{
	            			getDL("supporttypeexpiry").value = getDL("expiry").value;
	            		}
	            	}
		}
                var url = "/license/editlicenseprops.do?lid=" + oldlicenseid+"&from=request&type="+evalRsponse.LicenseType+"&category="+evalRsponse.LicenseCategory;
                //sendAsyncAJAXRequest('GET', url, renewalHandler, new Array(jsonStr));
                var arr = [] ;
                arr[0] = "licprop" ;
                arr[1] =  licenseStatus ;
                arr[2] = jsonStr ;
                
                sendAsyncAJAXRequest('GET',url,handleChangeProduct,arr);
                
        }
        else{
                alert("Invalid product");
                return false;
        }
}	
function renewal(productid,typeid,expiry,jsonStr){
	getDL("select").value=productid;
	if(getDL("select")!=null && getDL("select").value!=""){
		var evalRsponse = null;
		if(JSON.parse != null){
			evalRsponse = JSON.parse(jsonStr);
		}
		else{
			evalRsponse = JSON.stringify(jsonStr);
		}
		if(evalRsponse.expiryDate == null || evalRsponse.expiryDate == "" || evalRsponse.userType=="AMS"){
                	getDL("ams").checked=true;
                	displayExpiryDate("AMS",expiry);
                }
                else{
                	getDL("renewal").checked=true;
                        displayExpiryDate("Renewal",expiry);
                }
		var url = "/license/licenseprops.do?productid="+productid+"&from=normal&licenseType="+typeid;
		sendAsyncAJAXRequest('GET', url, renewalHandler, new Array(jsonStr));
	}
	else{
		alert("Invalid product");
		return false;
	}
}
function renewalHandler(xmlhttp,arrArg){
	if (xmlhttp.readyState == 4) {
		var rsp = xmlhttp.responseText;
		getDL("headingj").style.display="table-row";
		getDL("licprop").innerHTML=rsp;
		var evalRsp = JSON.parse(arrArg[0]);
		if(getDL("resellername") != null){
			getDL("resellername").value=evalRsp.RESELLERNAME;
		}	
		orderConfirmation();
		updateLicenseDetails(arrArg);
	}
}
function updateLicenseDetails(arrArg){
	var evalRsp = JSON.parse(arrArg[0]);
	if(evalRsp.PRODUCTID == 13501){	
		var searchChar = "+";
		for ( key in evalRsp){
			if (key.indexOf(searchChar) > 0 ){
				if(getDL(key) != null){
					getDL(key).value=evalRsp[key];
				}
			}
		}
		if(evalRsp["IT360+C5_1"] != "0" || evalRsp["IT360+C6_3"] != "0"  || evalRsp["IT360+C6_5"] != "0" || evalRsp["IT360+C6_6"] != "0")
		{
			getDL("HD").checked="true"
				it360showprops();	
		}
	}		
}
function getProducts(){
	var url = "/license/marketoaction.do?r=t";
	sendAsyncAJAXRequest('GET', url, productHandler, new Array("ert"));
}
function productHandler(xmlhttp,arrArg){
	if (xmlhttp.readyState == 4) {
		var rsp = xmlhttp.responseText;
        	
		var evalRsp = ( new Function( 'return ' +rsp))();

		var prd = ( new Function( 'return ' +evalRsp.product))();

		var usertypesjson = ( new Function( 'return ' +evalRsp.usertypes))();

		var listname = ( new Function( 'return ' +evalRsp.listname))();
		
		var listid = ( new Function( 'return ' +evalRsp.listid))();

		var mktoprd = ( new Function( 'return ' +evalRsp.marketoproductname))();
		
		var resellers = (new Function('return '+evalRsp.resellers))();

		var resellerrole =  (new Function('return '+evalRsp.resellerrole))();
		var resellermailrole =  (new Function('return '+evalRsp.resellermailrole))();

		var content = "<div class='headingmkt'>Products</div>";
		i = 0;
		for(key in prd){
			i = i+1;	
			css="";
			if(i%2==0){
				css="s_row1";
			}
			else{
				css="s_row2";
			}
			content += "<div style='width:100%;'></div><div class='left "+css+"' style='width:30%;clear:both;' id='chkprd"+prd[key]+"'>" ;
			if(usertypesjson != null && usertypesjson[prd[key]] != null){
				content += "<span id='edimg"+prd[key]+"'><img src='../images/editbut.gif' onclick='editMarketoDet(\"chkprd"+prd[key]+"\" , event,"+prd[key]+");'/></span>&nbsp;<input type='checkbox' checked id='prd"+prd[key]+"' onclick='marketoaction(\"chkprd"+prd[key]+"\" , event,"+prd[key]+");'>"+key+"</div>" +
			   	   	   "<div class='left "+css+"' style='width:12.5%;' id='listname"+prd[key]+"'>"+listname[prd[key]]+"</div>" +
			   	   	   "<div class='left "+css+"' style='width:12.5%;' id='listid"+prd[key]+"'>"+listid[prd[key]]+"</div>" +
			   	           "<div class='left "+css+"' style='width:20%;' id='avusertypes"+prd[key]+"'>"+usertypesjson[prd[key]]+"</div>" +
			   	           "<div class='left "+css+"' style='width:25%;' id='mktoprd"+prd[key]+"'>"+mktoprd[prd[key]]+"</div>" ;
			}
			else{
				content += "&nbsp;&nbsp;&nbsp;&nbsp;<input type='checkbox' id='prd"+prd[key]+"' onclick='marketoaction(\"chkprd"+prd[key]+"\" , event,"+prd[key]+");'>"+key+"</div>" +
					   "<div class='left "+css+"' style='width:12.5%;' id='listname"+prd[key]+"'> - </div>" +
					   "<div class='left "+css+"' style='width:12.5%;' id='listid"+prd[key]+"'> - </div>" +
					   "<div class='left "+css+"' style='width:20%;' id='avusertypes"+prd[key]+"'> - </div>" +
					   "<div class='left "+css+"' style='width:25%;' id='mktoprd"+prd[key]+"'> - </div>" ;
			}
		}
		getDL("prds").innerHTML=content+"</div>";
		setResellerDetails(resellers,resellerrole ,resellermailrole);
	}
}
function setResellerDetails(resellers , roles ,mailRoles){
	var content = "<div class='headingmkt'>Enabled for resellers</div>";
	var i = 0;
	for(key in resellers){
		i = i +1;
		css="";
		if(i%2==0){
			css="s_row1";	
		}
		else{
			css="s_row2";
		}
		content += "<div class='"+css+" left' style='clear:both;width:100%'><div class='"+css+" left' style='width:50%'><input type='checkbox' id='userrole"+key+"' onclick='addOrRemoveResellerRole(\"userrole"+key+"\",21,"+key+")'";
		if(roles[key] != null){
			content += " checked";		
		}
		content += ">&nbsp;"+ resellers[key]+"</div><div class='"+css+" left' style='width:50%'><input type='checkbox' id='usermailrole"+key+"' onclick='addOrRemoveResellerRole(\"usermailrole"+key+"\",34,"+key+")'";
		if(mailRoles != null && mailRoles[key] != null){
			content += " checked";
		}
		content+= ">&nbsp;Enable mail sending</div></div>";
	}
	getDL("resellers").innerHTML=content;
}
function editMarketoDet(popupid , event , productid){
	var content = formPopUpContent(productid);
	addproductsPopUpEdit("Edit Details", content,popupid ,500, event);
}
function marketoaction(popupid , event , productid){
	if(getDL("prd"+productid).checked==true){
		getDL("productidtoupdate").value = productid;
		addproductsForMarketoSetting("Add Details", "usertypes",popupid ,500, event);
	}
	else{
		if(confirm("Click ok to remove from marketo update")){
			var url = "/license/insorupd.do?table=marketoupdate&criteriacolumn=PRODUCTID&criteriavalue="+productid+"&delete=true";
			sendAsyncAJAXRequest('GET', url, marketoUpdateHandler, new Array(productid,"-", "-","-","-"));
		}
		else{
			getDL("prd"+productid).checked = true;
		}
	}
}
function saveDetails(form) {
	productid = form.productidtoupdate.value;
	types = form.usertypevalue;
	utv = "";
	for (i = 0; i < types.length; i++) {
		if (types[i].checked == true) {
			utv += types[i].value + ",";
		}
	}
	utv = utv.substr(0, utv.length - 1);
	row = "USERTYPES=" + utv + "@LISTNAME=" + form.listnamevalue.value + "@PRODUCTID=" + productid+"@PRODUCTNAME="+form.mktoprdname.value+"@LISTID="+form.listidvalue.value;
	var url = "/license/insorupd.do?table=marketoupdate&criteriacolumn=PRODUCTID&criteriavalue="+ productid + "&row=" + row + "&separator=@";
	sendAsyncAJAXRequest('GET', url, marketoUpdateHandler, new Array(productid,form.listnamevalue.value, utv,form.mktoprdname.value , form.listidvalue.value));

}
function marketoUpdateHandler(xmlhttp,arrArg){
	if (xmlhttp.readyState == 4) {
		var rsp = xmlhttp.responseText;
		if(rsp > 0 && rsp < 4){
			getDL("listname"+arrArg[0]).innerHTML=arrArg[1];
			getDL("listid"+arrArg[0]).innerHTML= arrArg[4];
			getDL("avusertypes"+arrArg[0]).innerHTML=arrArg[2];
			getDL("mktoprd"+arrArg[0]).innerHTML= arrArg[3];
			getDL("editContainer").style.display = 'none';
		}
		if(rsp == 1 || rsp > 3){
			getDL("chkprd"+arrArg[0]).innerHTML = "<span id='edimg"+arrArg[0]+"'><img src='../images/editbut.gif' onclick='editMarketoDet(\"chkprd"+arrArg[0]+"\" , event,"+arrArg[0]+");'/></span>"+getDL("chkprd"+arrArg[0]).innerHTML.replace("&nbsp;","").replace("&nbsp;","").replace("&nbsp;","");
		}
		if(rsp == 3){
			getDL("edimg"+arrArg[0]).innerHTML="&nbsp;&nbsp;&nbsp;";
		}
		if(rsp <= 0){
			alert("problem while add/update/delete!");
		}
		else if(rsp != 3){
			getDL("prd"+arrArg[0]).checked=true;
		}
	}	
}
function formPopUpContent(productid){
	arr = new Array('Registered','Renewal','Upgrade','RenewalUpgrade','AMS','NFS');
	regChk = false;
	det = getDL("avusertypes"+productid).innerHTML;
	var re = new RegExp(",","g");
	det = "{'"+det.replace(re,"':'true','")+"':'true'}";
	//det = eval('('+det+')');
	det = ( new Function( 'return ' +det))();

	
	content = '<form name="usertypesform">'+
		  '<input type="hidden" name="productidtoupdate" id="productidtoupdate" value="'+productid+'">'+
	          '<div>Select user types</div>';
    	for(i = 0 ; i < arr.length ; i++){
    		if(det[arr[i]] != null && det[arr[i]] == 'true'){
    			content += '<div><input type="checkbox" checked name="usertypevalue" value="'+arr[i]+'">'+arr[i]+'</div>';
    		}
    		else{
    			content += '<div><input type="checkbox" name="usertypevalue" value="'+arr[i]+'">'+arr[i]+'</div>';
    		}
	}
    	content += '<div class="left">Enter list name</div><div class="left"><input type="text" name="listnamevalue" id="listnamevalue" value="'+getDL("listname"+productid).innerHTML+'"></div><div style="clear:both;" class="left">Enter list id</div><div class="left"><input type="text" name="listidvalue" id="listidvalue" value="'+getDL("listid"+productid).innerHTML+'"></div>'+
		   '<div style="clear:both;" class="left">Enter product name</div><div class="left"><input type="text" name="mktoprdname" id="mktoprdname" value="'+getDL("mktoprd"+productid).innerHTML+'"></div>'+
    		   '<div style="clear:both;"  class="left"><input type="button" name="save" value="save" onclick="saveDetails(this.form)"></div>'+
    		   '</form>';
	return content;
}
function campaignResponseHandler(xmlhttp,arrArg){
	if (xmlhttp.readyState == 4) {
        	var rsp = xmlhttp.responseText;
		ut=getDL("usertype").value;
		productid=getDL("productid").value;
		if(rsp == 1 || rsp > 3){
			existingItem = camSet[productid][0];
			existingItem[ut]=[{ID:rsp,listkey:getDL("listkey").value,authtoken:getDL("authtoken").value}];
			camSet[productid][0]=existingItem;
			alert("added ... ");
		}
		else if(rsp == 2){
			camSet[productid][0][ut][0].listkey=getDL("listkey").value;
                	camSet[productid][0][ut][0].authtoken=getDL("authtoken").value;
			alert("updated ... ");
		}
		else if(rsp == 3){
			delete camSet[productid][0][ut];
			getDL("listkey").value="";
			getDL("authtoken").value="";
			alert("deleted ... ");
		}
	}
}
function updateCampaignDetails(){
	ut=getDL("usertype").value;
        productid=getDL("productid").value;
	if(camSet != "" && camSet != null && camSet[productid] != null && camSet[productid][0][ut] != null){
		getDL("listkey").value=camSet[productid][0][ut][0].listkey;
		getDL("authtoken").value = camSet[productid][0][ut][0].authtoken;
	}
	else{
		getDL("listkey").value="";
		getDL("authtoken").value="";	
	}
}
function saveCampaignDetails(){
	ut=getDL("usertype").value;
        productid=getDL("productid").value;
	row = "PRODUCTID="+productid+",USERTYPE="+ut+",authtoken="+getDL("authtoken").value+",listkey="+getDL("listkey").value;
	var url = "/license/insorupd.do?table=zcampaignsettings&separator=,&row="+row+"&criteriacolumn=";
	if(camSet != "" && camSet != null && camSet[productid] != null && camSet[productid][0][ut] != null){
		url+= "ID&criteriavalue="+camSet[productid][0][ut][0].ID;
	}
	else{
		url += "PRODUCTID&criteriavalue="+getDL("productid").value+"&forceinsert=true";
	}
	sendAsyncAJAXRequest('GET', url, campaignResponseHandler, new Array());
}
function stopCampaign(){
	if(getDL("listkey").value=="" || getDL("authtoken").value==""){
		alert("Already not there ... ");
	}
	else{
		var url = "/license/insorupd.do?table=zcampaignsettings&criteriacolumn=ID&criteriavalue="+camSet[getDL("productid").value][0][getDL("usertype").value][0].ID+"&delete=true";
		sendAsyncAJAXRequest('GET', url, campaignResponseHandler, new Array());
	}
}
function checkinvstatus(ordernumber , invoicenumber){
	$.blockUI();
	$.blockUI({ css: {border:'',backgroundColor:''}});
	var url = "/license/invoicestatuscheck.do?ordernumber="+ordernumber+"&invoicenumber="+invoicenumber;
	arr = new Array(1);
	arr[0]=ordernumber
	arr[1]=invoicenumber
	sendAsyncAJAXRequest('GET', url, invstatushandler, arr);
}
function invstatushandler(xmlhttp,arrArg){
        if (xmlhttp.readyState == 4) {
                var rsp = xmlhttp.responseText;
        	getDL("disableDiv").style.display = 'none';
		$.unblockUI();
		if(rsp != null && rsp != "null" && rsp != ""){
			//rsp = eval('('+rsp+')');
			rsp = ( new Function( 'return ' +rsp))();
			getDL("status"+arrArg[0]).innerHTML=rsp.Status;
			getDL("amount"+arrArg[0]).innerHTML=rsp.Total;
			if(rsp.File != null && rsp.File != "-"){
				getDL("invnum"+arrArg[0]).innerHTML = "<a href='javascript:winopen(\"../invoicePdf/"+rsp.File+"\",\"wrapwin\",\"700\",\"400\")'>"+arrArg[1]+"</a>";
			}
			if(rsp.Status == "Closed"){
				getDL("refresh"+arrArg[0]).innerHTML="";
			}
		}
	}
}
function disableAddProdut(installation){
	if(installation == "US" && getDL("addprdbutton")!=null){
		getDL("addprdbutton").disabled=true;
	}
}
function addsubgroup(prodid,productkey,mainTypeID , mainType, mainCat,subType , subCat , groupId){
        window.location="/license/importxmlaction.do?utype=syncgroup&prodid="+prodid+"&typeid="+mainTypeID+"&type="+mainType+"&category="+mainCat+"&stype="+subType+"&scat="+subCat+"&groupid="+groupId+"&productkey="+productkey;
}
function setExpiryWhileEditProperties(userType,expiryDate,amsExpiry){
	getDL(userType).checked=true;
	if(expiryDate == null || expiryDate == ""){
		getDL("perpetual").checked=true;
		makePerpetual();
		if(amsExpiry != null && amsExpiry!=""){
			getDL("expiry").value=amsExpiry;
		}
	}
	else if(userType == "Upgrade"){
		getDL("perpetualDiv").style.display="block";
		getDL("expiryDiv").style.display="block";
		getDL("expiry").value=expiryDate;
	}
	else if(userType == "RenewalUpgrade"){
		getDL("perpetualDiv").style.display="none";
		getDL("expiryDiv").style.display="block";
		getDL("expiry").value=expiryDate;
	} 
	else{
       		displayExpiryDate(userType,expiryDate);
		getDL("expiry").value=expiryDate;
	}
}
function editUserTypeCheck(userType,newUserType,expiryDate){
	if(userType == "Upgrade" || userType == "RenewalUpgrade"){
		alert("This option not yet supported");
		return false;
	}
	displayExpiryDate(newUserType,expiryDate);
	if(newUserType == "NFS" ){
		if(getDL("perpetual").checked==true){
			getDL("expiryDiv").style.display="none";
			getDL("expiry").value="";
		}
		else{
			getDL("expiry").value=expiryDate;
		}
	}
	return true;
}
function validateh(){
	var one_day=1000*60*60*24;
	if((Math.ceil((new Date(getDL("to").value).getTime()-new Date(getDL("from").value).getTime())/(one_day)) > 31)){
		alert("Duration can not be more than 31 days");
		return false;
	}

}
function approveFreeLicense(licenseid , freeLicenseMapID,scheduleid,rowid){
	var url = "/license/complementaction.do?action=approve&licenseid="+licenseid+"&freelicensemap="+freeLicenseMapID+"&scheduleid="+scheduleid;
	arr = new Array(1);
	arr[0] = rowid;
	if(confirm("Click ok to approve license")){
		$.blockUI();
		$.blockUI({ css: {border:'',backgroundColor:''}});
		sendAsyncAJAXRequest('GET', url, complementLicenseHandler, arr);
	}
}


function deleteFreeLicense(licenseid , freeLicenseMapID,scheduleid,rowid,ev ){

	var url = "/license/complementaction.do?action=delete&licenseid="+licenseid+"&freelicensemap="+freeLicenseMapID+"&scheduleid="+scheduleid;
	complementcommentform.actionurl.value=url;
	complementcommentform.rowid.value=rowid;		
	getDL("draggable").style.display="block";
    	$("#draggable" ).draggable();
	$("#draggable").css( {position:"absolute", top:ev.pageY-13, left: ev.pageX-13});
}
function complementLicenseHandler(xmlhttp,arrArg){
        if (xmlhttp.readyState == 4) {
                var rsp = xmlhttp.responseText;
		if(rsp == 1){
			var su=jQuery("#list").jqGrid('delRowData',arrArg[0]);
		}
		else{
			alert("Problem while .... ");
		}
		$.unblockUI();
	}
}
var uncheckfreeIDs="";
function addFreeLicenseUnchecNote(arg, ev, editionid) {
	if (getDL("freeuncheckcontent") == null || getDL("freeuncheckcontent").value == "") {
		alert("Please enter the reason for removing complimentary license ");
		return false;
	}
	var freeName = "freelicensecheck";
	var checkboxName = "freelicensecheckbox";
	if (editionid != null) {
		freeName = "freelicensecheck_" + editionid;
		checkboxName = "freelicensecheckbox_" + editionid;
	}
	freeArr = document.getElementsByName(checkboxName);

	if (freeArr.length != null) {
		for (i = 0; i < freeArr.length; i++) {
			if (freeArr[i].checked == false && !uncheckfreeIDs.includes(freeArr[i].value)) {
				uncheckfreeIDs += freeArr[i].value + ":" + getDL("freeuncheckcontent").value + "$END$";
			}
		}
		if (uncheckfreeIDs != "" && uncheckfreeIDs.charAt(uncheckfreeIDs.length - 1) == ",") {
			uncheckfreeIDs = uncheckfreeIDs.substr(0, uncheckfreeIDs.length - 1);
		}
	}
	getDL("freeuncheckcomment").value = uncheckfreeIDs;
	if (editionid != null && editionid != "") {
		getDL("freeuncheckcomment_" + editionid).value = uncheckfreeIDs;
		var strContent = (getDocObj("freeunchecknote").innerHTML).replace(new RegExp(arg, "g"), "#ARG#");
		strContent = strContent.replace(new RegExp(editionid, "g"),"#EDITIONID#");
		getDocObj("freeunchecknote").innerHTML = strContent;
		document.getElementById("freeunchecknote").style.display = "none";
	} else {
		hideDiv('editContainer', 'disableDiv');
	}
	return true;
}
function checkAndEnableCompliment(arg,ev,editionid){
	getDL("freelicensecheck"+arg).checked=true;
	freeProductCheck(arg,ev,editionid	)
	hideDiv('editContainer','disableDiv');
}
function checkAndUpdateComplimentContent(typeid,editionid){
	if(getDL("freeuncheckcomment_"+editionid) != null && getDL("freeuncheckcomment_"+editionid).value.trim() != "" && 
			getDL("freeuncheckcomment_"+editionid).value.indexOf(typeid+":") >= 0){
		content = getDL("freeuncheckcomment_"+editionid).value;
		complementContent = content.substr(content.indexOf(typeid+":"));
		endContent = complementContent.substr(complementContent.indexOf("$END$")+5);
		startContent = content.substr(0,content.indexOf(typeid+":"));
		getDL("freeuncheckcomment_"+editionid).value=startContent+endContent;	 	
	}
}
function complementComment(){
	if(complementcommentform.complementcomment.value == ""){
		alert("Please enter the reason for deleting complement license");
		return false;	
	}
	else{
		hideDiv('draggable','disableDiv');
		$.blockUI();
		$.blockUI({ css: {border:'',backgroundColor:''}});
		url  = complementcommentform.actionurl.value+"&comment="+encodeURIComponent(complementcommentform.complementcomment.value );
		arr = new Array(1);
		arr[0] = complementcommentform.rowid.value;
		sendAsyncAJAXRequest('GET', url, complementLicenseHandler, arr);
	}
}
function getDays(expiryDate){
	var datesplit = expiryDate.split("-");
	var currentTime = new Date();
	var one_day=1000*60*60*24; 
	var expdate = new Date(datesplit[0],(datesplit[1]-1),datesplit[2]);
	var Diff=Math.ceil((expdate.getTime()-currentTime.getTime())/(one_day));
	return Diff;
}
function deleteBlockedUser(cri)
{
	var con = confirm("Click ok to delete");
	if(con){
		var url = "/license/blockuser.do?method=delete&user="+cri;		
		sendAsyncAJAXRequest('GET', url, delBlockHandler, new Array());
	}
}
function delBlockHandler(xmlhttp,arrArg){
        if (xmlhttp.readyState == 4) {
		document.location.href="/license/jsp/madmin.jsp?view=bu";	
	}
}
function addBlockedUser(blockeduser){
	var btype=0;
	if(blockeduser.blocktype[0].checked){
		btype = 1;
	}
	else if(blockeduser.blocktype[1].checked){
		btype = 2;
	}
	
	var url = "/license/blockuser.do?method=add&email="+blockeduser.email.value+"&blocktype="+btype+"&renewalblock="+blockeduser.renewalblock.checked+"&licenseblock="+blockeduser.licenseblock.checked;
	if(blockeduser.selectedproducts_new != null && blockeduser.selectedproducts_new.length > 0)
		{
			var tag = blockeduser.selectedproducts_new ; 
			var add = ""; 
			
			for(var i = 0 ; i < tag.length ; i++)
			{
			if(add != "")
				{
				add += ",";
				}
			add += tag[i].value;	
		
			}
			url += "&productid="+add;

		}

	sendAsyncAJAXRequest('GET', url, delBlockHandler, new Array());
}
function updateBlockedDomains(type , id , value){
	var url = "/license/blockuser.do?method=update&update=true&user="+id+"&type="+type;
	if(type == "type"){
		url += "&blocktype="+value;				
	}
	else if(type == "for"){
		url += "&renewalblock="+getDL("renewalblock"+value).checked+"&licenseblock="+getDL("licenseblock"+value).checked;				
	}
	sendAsyncAJAXRequest('GET', url, delBlockHandler, new Array());
}
function getRenewalCount(){
        var url = "/license/getrenewcount.do?from="+getDL("from").value+"&to="+getDL("to").value+"&reseller="+getDL("resellerid1").value+"&product="+getDL("productid1").value;
        sendAsyncAJAXRequest('GET', url, renewcount, new Array());
}
function renewcount(xmlhttp,arrArg){
        if (xmlhttp.readyState == 4) {
                getDL("totalcount").innerHTML=xmlhttp.responseText;
        }
}

function generatedAPIKey()
{

        var con = confirm("Click OK to Continue");
        if(con)
        {
                var url = "/license/adminaction.do?method=generateAPIKey&resellerid="+document.getElementById("resellerid1").value;
                sendAsyncAJAXRequest('GET',url,handleGenerateKey,new Array());
        }

}
function handleGenerateKey(xmlhttp,arrArg)
{
        if(xmlhttp.readyState == 4)
        {
                var rsp = xmlhttp.responseText;
                rsp = rsp.replace(/(\r\n|\n|\r)/gm," ");
                //var evalRsp = eval('('+rsp+')');
		var evalRsp = ( new Function( 'return ' +rsp))();

                if(evalRsp.result=="success")
                {
                        var encryptStr = evalRsp.encryptStr;
                        encryptStr.replace(/(\r\n|\n|\r)/gm," ");

                        document.getElementById("displayApiKey").innerHTML = encryptStr;
                        document.getElementById("displayApiKey").style.display = "block";

                }
        }
}
function validateAPIKey()
{
        var encryptedStr = document.getElementById("getApiKey").value
        var url = "/license/adminaction.do?method=validateAPIKey&encryptedStr="+encodeURIComponent(encryptedStr);
                sendAsyncAJAXRequest('GET',url,handleValidateKey,new Array());
}
function handleValidateKey(xmlhttp,arrArg)
{
        if(xmlhttp.readyState == 4)
        {
                var rsp = xmlhttp.responseText;
                rsp = rsp.replace(/(\r\n|\n|\r)/gm," ");
                //var evalRsp = eval('('+rsp+')');
		var evalRsp = ( new Function( 'return ' +rsp))();

                if(evalRsp.result=="success")
                {
                        var decryptStr = evalRsp.decryptStr;
                        var splitStr = decryptStr.split(":::field:::");
                        var resStr = "Reseller ID : "+splitStr[0]+" ResellerName : "+splitStr[1];
			if(evalRsp.activekey === "false" || !evalRsp.activekey)
                        {
                                resStr += ".  This Key deactivated . Key not mapped / may be new key generated for the reseller. "
                        }

                        document.getElementById("displayResult").innerHTML = resStr

                        document.getElementById("displayResult").style.display = "block";
                }
        }
}
function isFreeLicenseAvailable(){
        for(fi = 0 ; fi < freeLicenseJson.length; fi++){
                if(freeLicenseJson[fi] == getDL("select").value){
                        return true;
                }
        }
        return false;
}

function preViewUSInvoice(xmlhttp,arrArg){
        if (xmlhttp.readyState === 4) {
		winopen("http://uslicensing.manageengine.com/license/invoiceviewer?orderNumber="+xmlhttp.responseText,'wrapwin','700','400');
	}
}
function update(table , cricolumn , cri , updatecolumn , updatevalid){
	var url="/license/updatecolumn.do?table="+table+"&criteriacolumn="+cricolumn+"&criteriavalue="+cri+"&updatecolumn="+updatecolumn+"&updatevalue="+getDL(updatevalid).value;
        sendAsyncAJAXRequest('GET',url,genericResponseHandler,new Array({"1":"Updated Successfully","0":"Error while updating"}));
}
function genericResponseHandler(xmlhttp , message){
	if(xmlhttp.readyState === 4){
		alert(message[0][xmlhttp.responseText]);
	}
}
function handleWeeklyInvoices(xmlhttp,arrArg)
{
	document.getElementById("displayInvoiceDetails").innerHTML="";
        document.getElementById("progrees").style.display="none";

        if(xmlhttp.readyState === 4)
        {
                var rsp = xmlhttp.responseText;

		var evalRsp = ( new Function( 'return ' +rsp))();

        var displayStr ="";
        if(evalRsp.detail.length > 0)
        {
                var ln = evalRsp.detail.length ;
                displayStr += "List of Weekly Invoices";
                displayStr += "<table width='100%' id='dataTbli' cellspacing='0' cellpadding='0' style='margin-top:20px; border:1px solid #A9A9A9'>";
		displayStr += "<tr class='rowheader'><th>S.No</th><th>Weekly Invoice ID</th><th>Invoice PDF</th><th>Generated Date</th><th>Due Date</th>";
		//displayStr += "<th>RESELLERID</th>";
		displayStr += "<th>Update Payment</th><th>Payment Status</th><th>View/Enter Comment</th></tr>";
                var css = "";
                var sno = 0 ;
                for(var i = 0 ; i < ln ; i++ )
                {

                        if(sno %2 !==0)
                        {
                                css = "s_row111" ;
                        }
                        else
                        {
                                css ="s_row2" ;
                        }
			var cmdcolor ="";
			var appStr = "";
                        if(evalRsp.detail[i].cmdcolor !== null && evalRsp.detail[i].cmdcolor !== "")
                                {
                                cmdcolor = evalRsp.detail[i].cmdcolor ;
                                }
                        if(evalRsp.detail[i].paymentid !== "" && evalRsp.detail[i].approvedby !== null && evalRsp.detail[i].approvedby !== "null" &&
                                                evalRsp.detail[i].approvedby !== "")
                                {
					
					appStr += evalRsp.detail[i].paymentid + "," ; 
                                }
                        else
                                {
                                sno = parseInt(sno) + 1 ;
                         var rowStr = "<tr onMouseOver=\"tblRollOver(this)//;\" onMouseOut=\"tblRollOut(this);\" class=\""+css+"\" bgcolor=\""+cmdcolor+"\">";
                        rowStr +="<td>"+sno+"</td><td>"+evalRsp.detail[i].weeklyinvoiceid+"</td>";
			rowStr += "<td><a href=\"javascript:winopen('/license/invoiceviewer?weeklyinvoiceid="+evalRsp.detail[i].weeklyinvoiceid+"','wrapwin','700','400')\" title=\"Click to view your invoice details\">INVOICE PDF</a></td>";

			rowStr += "<td>"+evalRsp.detail[i].weeklyinvoicedate+"</td>";
			rowStr += "<td>"+evalRsp.detail[i].weeklyinvoiceduedate+"</td>";
                        //rowStr +="<td>"+evalRsp.detail[i].RESELLERNAME+"</td>" ;
			if(evalRsp.detail[i].paymentid === "null" || evalRsp.detail[i].paymentid === null || evalRsp.detail[i].paymentid === "")
                        {
			rowStr += "<td><a href=\"javascript:checkIfNotPaymentSubmit('"+evalRsp.detail[i].weeklyinvoiceid+"')\">";

                        rowStr += "Click to update payment</a></td><td>-</td><td>-</td>";
                        }
                        else
                        {
                                rowStr += "<td>Payment made , Ref ID :"+evalRsp.detail[i].paymentid+"</td>" ;


                        rowStr += "<td>Waiting for Approval</td>";
                rowStr += "<td>";
		var commentStr = "" ;
                var paymentID = evalRsp.detail[i].paymentid ;
                var paymentcomment = "";
		if(evalRsp.detail[i].paymentcomment != null)
		{
			paymentcomment = evalRsp.detail[i].paymentcomment ; 
		}
                if(paymentcomment !== null && paymentcomment !== "" && paymentcomment !=="-")
                        {

                        var str = paymentcomment.split("-and-");
                        for(s=0;s<str.length;s++)
                                {
                                commentStr +=str[s]+"<br>";
                                }
                        }
		rowStr += "<a href=\"#"+paymentID+"\" id=\"comment"+paymentID+"\" onclick=\"addproductsPopUp2('View Comment ', 'viewcomment"+paymentID+"','comment"+paymentID+"', 400, event);\">Click to View/Enter Comment</a></td>";
                rowStr +="<div id=\"viewcomment"+paymentID+"\" style=\"display:none;\" >";
                rowStr += commentStr;
                rowStr += "<br><br>Enter comment : <input type=\"text\" name= \"usercomment\" id=\"usercomment\" ><input name=\"submitusercomment\" type=\"submit\" value=\"Update Comment\" class=\"formbut\" onclick=\'updateUserComment("+paymentID+")\' >";

                        rowStr += "</div>";

                        rowStr += "</td>";


                        }

                        rowStr +="</tr>";
                        displayStr +=  rowStr ;
			}
                }


        }
        document.getElementById("displayInvoiceDetails").innerHTML=displayStr ;
	}
}
function isLicenseRequestBlocked()
{
        var url = '/license/adminaction.do?method=isLicenseRequestBlocked&resellername='+document.getElementById("resellername").value;
        sendAsyncAJAXRequest('GET',url,handleLicenseRequestBlocked, new Array());
}
function handleLicenseRequestBlocked(xmlhttp,arrArg)
{
        if(xmlhttp.readyState === 4)
        {
                var rsp = xmlhttp.responseText;
                //var evalRsp = eval('('+rsp+')');
		
		/*jslint evil: true */
		var evalRsp = ( new Function( 'return ' +rsp))(); 
		
		/* var rsp1 = new Function( 'return ' +rsp) ;
                var evalRsp =  rsp1();*/

                if(evalRsp.result === "true")
                {
                        document.getElementById("blockrequest").value = "true" ;
                }
                else
                {
                        document.getElementById("blockrequest").value = "false" ;
                }
	}
}
function fillTaxAmount()
{
	if(document.getElementById("taxpercent") != null && document.getElementById("taxpercent").value != "" )
	{
          if(isNaN(document.getElementById("taxpercent").value))
		{
			alert("Enter correct tax percentage");
		}
	else
        {
        var taxpercent = document.getElementById("taxpercent").value ;
        var payamount = document.getElementById("paymentamount").value ;
        var taxamount = parseFloat(payamount) * parseFloat(taxpercent) / 100 ;
        document.getElementById("taxamount").value = taxamount.toFixed(2) ;
	}
	}
}
function highLightTab(url){
        if(url === in_url+"license/jsp/request.jsp"){
                $("#optionsDiv5").css("opacity","10");
        }
        else if(url === in_url+"license/jsp/ToBeRenewedReport.jsp"){
                $("#optionsDiv4").css("opacity","10");
        }
        else if(url === in_url+"license/jsp/upgrade.jsp"){
                $("#optionsDiv6").css("opacity","10");
        }
        else if(url === in_url+"/license/jsp/ResellerReport.jsp"){
                $("#optionsDiv2").css("opacity","10");
        }
        else if(url === in_url+"/license/jsp/PaymentDetails.jsp"){
                $("#optionsDiv8").css("opacity","10");
        }
        else if(url === in_url+"license/jsp/admin.jsp"){
                $("#optionsDiv1").css("opacity","10");
        }
        else if(url === in_url+"license/jsp/madmin.jsp"){
                $("#optionsDiv7").css("opacity","10");
        }

}
$(document).ready(function(){
        $("#optionsDiv8").mouseover(function(){
                $("#arrow3").css({"visibility":"visible"});
                $("#subMenu3").css({"visibility":"visible"});
        });
});
$(document).ready(function(){
        $("#optionsDiv8").mouseout(function(){
                $("#arrow3").css({"visibility":"hidden"});
                $("#subMenu3").css({"visibility":"hidden"});
        });
});

$(document).ready(function(){
        $("#optionsDiv5").mouseover(function(){
                $("#arrow").css({"visibility":"visible"});
                $("#subMenu").css({"visibility":"visible"});
        });
});
$(document).ready(function(){
        $("#optionsDiv5").mouseout(function(){
                $("#arrow").css({"visibility":"hidden"});
                $("#subMenu").css({"visibility":"hidden"});
        });
});

$(document).ready(function(){
        $("#optionsDiv4").mouseover(function(){
                $("#arrow1").css({"visibility":"visible"});
                $("#subMenu1").css({"visibility":"visible"});
        });
});
$(document).ready(function(){
        $("#optionsDiv4").mouseout(function(){
                $("#arrow1").css({"visibility":"hidden"});
                $("#subMenu1").css({"visibility":"hidden"});
        });
});

$(document).ready(function(){
        $("#optionsDiv2").mouseover(function(){
                $("#arrow2").css({"visibility":"visible"});
                $("#subMenu2").css({"visibility":"visible"});
		$("#li1").show();
                $("#li2").show();
                $("#li3").show();
                $("#li4").show();

        });
});

$(document).ready(function(){
        $("#optionsDiv2").mouseout(function(){
                $("#arrow2").css({"visibility":"hidden"});
                $("#subMenu2").css({"visibility":"hidden"});
        });
});
$(document).ready(function(){
        $("#optionsDiv2").mouseout(function(){
                $("#arrow2").css({"visibility":"hidden"});
                $("#subMenu2").css({"visibility":"hidden"});
        });
});
function changeBorder1(){
        $("#fn1").css({"border-bottom":"2px solid black"});
        $("#fn2").css({"border":"none"});
        $("#fn3").css({"border":"none"});
}
function changeBorder2(){
        $("#fn2").css({"border-bottom":"2px solid black"});
        $("#fn1").css({"border":"none"});
        $("#fn3").css({"border":"none"});
}
function changeBorder3(){
        $("#fn3").css({"border-bottom":"2px solid black"});
        $("#fn1").css({"border":"none"});
        $("#fn2").css({"border":"none"});
}
function submitMonthlyLicense(arg)
{
        document.getElementById("editContainer").style.display="none";
        document.getElementById("disableDiv").style.display="none";


        document.getElementById("finalpopup").value = "finalpopup";


        document.getElementById("sendbutton").click();

}
function cancelMonthlyLicense(arg)
{
        document.getElementById("editContainer").style.display="none";
        document.getElementById("disableDiv").style.display="none";

        if(document.getElementById("finalpopup") != null)
        {
                document.getElementById("finalpopup").value = "";
        }
        if(document.getElementById("salepoint") != null)
        {
                document.getElementById("salepoint").value = "";
        }

}
function handleSupportPurchaseEnabled(xmlhttp,arrArg)
{
        if(xmlhttp.readyState === 4)
        {
                var rsp = xmlhttp.responseText;
                //var evalRsp = eval('('+rsp+')');

                /*jslint evil: true */
                var evalRsp = ( new Function( 'return ' +rsp))();
                if(evalRsp.result === "true")
                {
                        document.getElementById("supportid").style.display = "block" ;
                        document.getElementById("supportpurchase").checked = false ;
                }
                else
                {
                        document.getElementById("supportpurchase").checked = false ;
                        document.getElementById("supportid").style.display = "none" ;
                }
        }
}


function copyValue(from ,to){
	getDL(to).value=getDL(from).value;
}
function addfinanceperson(ff)
{
alert("addfinanceperson:");
        var mail = ff.financemailid.value;
        var pass = ff.financepassword.value;
        if(mail == "")
        {
                alert("Please enter the mail id");
                return false;
        }
        else if(pass == "")
        {
                alert("Please enter the password");
                return false;
        }
        else if(pass.length < 6)
        {
                alert("Password length cannot be < 6");
                return false;
        }
        else
        {
                return true;
        }
}
function approvePayment(paymentid)
{
        var txt=document.getElementsByName("order"+paymentid);
        var ischeck = false ;
        for(j = 0; j < txt.length ; j++)
        {
                //document.getElementById(txt[j].id).checked
                if(document.getElementById(txt[j].id) !== null && document.getElementById(txt[j].id).checked)
                {
                        ischeck = true ;
                }
        }
        if( ischeck === false)
        {
                alert("select check box payment id:"+paymentid);
                return ;
        }
        else if(document.getElementById("taxpercent"+paymentid) !== null && document.getElementById("taxpercent"+paymentid).value !== "" &&
                        parseFloat(document.getElementById("taxpercent"+paymentid).value) > 0 &&  document.getElementById("taxname"+paymentid).value === "-" && parseFloat(document.getElementById("taxpercent"+paymentid).value) > 0 &&  document.getElementById("taxname"+paymentid).value === "-" && getDL("approvepayment_"+paymentid).value == "Approve")
        {
                alert("Select Tax account (Zbooks) ");
                                return ;

        }
        else
        {
                getBankDetails(paymentid ) ;
        }
}
function addCamp(){
	if(getDL("camp").value != "" && !isNaN(getDL("expdays").value)){
		var url= "/license/campsetting.do?method=add&name="+getDL("camp").value+"&expdays="+getDL("expdays").value;
        	sendAsyncAJAXRequest('GET',url,genericResponseHandler,new Array({"1":"Added Successfully","0":"Error while adding"}));
	}
}
function addRemoveCampaign(resellerid , action , cam1  , cam2)
{
	var tag = document.getElementById(cam1);
	var tag1 = document.getElementById(cam2);
	var addrem = "";
	var url = "";
	for(var i = 0 ; i < tag1.length ; i++)
	{
		if(tag1[i].selected)
		{
			addrem += tag1[i].value+",";
		}
	}
	url = "/license/campsetting.do?method="+action+"&resellerid="+resellerid+"&camps="+addrem	
	sendAsyncAJAXRequest('GET',url,campaignHandler,new Array(cam1,cam2));
}
function campaignHandler(xmlhttp , arr){	
	if(xmlhttp.readyState === 4){
		swapOptions(getDL(arr[1]),getDL(arr[0]));
	}
}
function validateComplementFree(){
	if(getDL("Free")!=null && getDL("Free").checked){
		var datesplit = document.getElementById("expiry").value.split("-");
	        var currentTime = new Date();
        	var one_day=1000*60*60*24;
	        var expdate = new Date(datesplit[0],(datesplit[1]-1),datesplit[2]);
        	var Diff=Math.ceil((expdate.getTime()-currentTime.getTime())/(one_day));
		if(Diff > parseInt(campExpiry[document.getElementById("campaign").value])){
			return false;
		}
	}
	return true;
}
function excudeMail(checkboxname, divname, ordernumber , licenseid)
{
        var emailidlist = "";
        var rememailidlist = "";
        for(j = 0 ;j<document.getElementsByName(checkboxname).length; j++)
        {
                if(document.getElementsByName(checkboxname)[0].checked === true)
                {
                if(emailidlist != "")
                {
                        emailidlist += ",";
                }

                emailidlist += document.getElementsByName(checkboxname)[j].value ;
                }
                else
                {

                        if(rememailidlist != "")
                        {
                                rememailidlist += ",";
                        }
                        rememailidlist += document.getElementsByName(checkboxname)[j].value ;
                }
        }
                var url = "/license/blockuser.do?method=excludeMailList&emaillist="+emailidlist+"&ordernumber="+ordernumber+"&licenseid="+licenseid+"&rememail="+rememailidlist;
                sendAsyncAJAXRequest('GET', url, excludeMailBlockHandler, new Array(j,document.getElementsByName(checkboxname).length,divname));
}
function excludeMailBlockHandler(xmlhttp,arrArg){
        if (xmlhttp.readyState == 4) {
                        var rsp = xmlhttp.responseText;
                        if(rsp === "success")
                        {
                        //document.getElementById("disableDiv").style.display="none";
                        hideDiv('editContainer','disableDiv');

                        }
        }
}
function checkForBlock(checkboxname,ordernumber,licenseid)
{
        var url = "/license/blockuser.do?method=getBlockedMailList&ordernumber="+ordernumber+"&licenseid="+licenseid;
        sendAsyncAJAXRequest('GET', url, getBlockedMailHandler, new Array(checkboxname));

}
function getBlockedMailHandler(xmlhttp,arrArg)
{
        if (xmlhttp.readyState == 4) {
                var rsp = xmlhttp.responseText;
                var evalRsp = ( new Function( 'return ' +rsp))();

                if(evalRsp.result === "success" && evalRsp.blockedmails !== "")
                {
                        var splitStr = evalRsp.blockedmails.split(",") ;
                        for(i =0 ; i<splitStr.length;i++)
                        {
                                for(j = 0 ;j<document.getElementsByName(arrArg[0]).length; j++)
                                {
                                        if(document.getElementsByName(arrArg)[j].value === splitStr[i]) 
                                        {
                                                document.getElementsByName(arrArg)[j].checked = true ;
                                        }
                                }

                        }

                        //document.getElementById("disableDiv").style.display="none";

                }
        }

}

function updateAdminComment(paymentid)
{
        if(document.getElementById("admincomment").value === "")
        {
                alert("enter comment");
                return;
        }
        else
        {
        var con = confirm("Click Ok to Continue");
        if(con)
        {
                var url = "/license/insertpaymentdetails.do?action=updateadmincomment&paymentid="+paymentid+"&admincomment="+document.getElementById("admincomment").value ;
                ajaxSendRequest(url,"yes","no","updateadmincomment");

        }
        }

}
function updateUserComment(paymentid)
{
        if(document.getElementById("usercomment").value === "")
        {
                alert("enter comment");
                return;
        }
        else
        {
        var con = confirm("Click Ok to Continue");
        if(con)
        {
                var url = "/license/insertpaymentdetails.do?action=updateusercomment&paymentid="+paymentid+"&usercomment="+document.getElementById("usercomment").value ;
                sendAsyncAJAXRequest('GET', url, updateUserCommentHandler, new Array());
        }
        }

}
function updateUserCommentHandler(xmlhttp,arrArg)
{
        if (xmlhttp.readyState == 4) {
                var rsp = xmlhttp.responseText;
                var evalRsp = ( new Function( 'return ' +rsp))();

                if(evalRsp.result === "success" )
                {
                        alert("comment updated");
                        hideDiv('editContainer','disableDiv');
                        getInvoiceDetails();
                }
        }

}

function checkIfNotPaymentSubmit(weeklyinvoiceid)
{
        var url = "/license/insertpaymentdetails.do?action=checkIfWeeklyInvoicePaid&weeklyinvoiceid="+weeklyinvoiceid ;
    
        sendAsyncAJAXRequest('GET', url,  handleForPaymtCheck, new Array(weeklyinvoiceid));
}
function handleForPaymtCheck(xmlhttp,arrArg)
{
        if (xmlhttp.readyState == 4)
        {
        var rsp = xmlhttp.responseText;
        var evalRsp = ( new Function( 'return ' +rsp))();

        if(evalRsp.result === "Paid" )
        {
                alert("Payment already Udated ");

                getInvoiceDetails();
        }
        else
                {
                //open pymt window
                //alert("open window");
                winopen('/license/jsp/ResInvPayment.jsp?notabs=true&INVID='+arrArg[0]+'&winopen','wrapwin',screen.availWidth,screen.availHeight) ;


                }
     }
}
function applycredits(creditid)
{
alert("applycredits");
        if(document.getElementById("applyinvoice").value =="" || document.getElementById("applyinvoice").value == "-" )
        {
                alert("Enter Invoice Numbers(s)");
                return;
        }
        else if(document.getElementById("creditamount").value == "" || document.getElementById("creditamount").value == "-")
        {
                alert("Enter Credit Amount");
                return;
        }
        var con = confirm("Click OK to Continue");
        if(con)
        {
                var url = "/license/insertpaymentdetails.do?action=applycredits&creditordernumber="+creditid+"&invoicestr="+document.getElementById("applyinvoice").value+"&creditstr="+document.getElementById("creditamount").value ;
                alert("url::::::::"+url) ;
                ajaxSendRequest(url,"yes","no","applycredits");

        }

}

function isValidExpiry(){
	if(isFieldEmpty("expiry") ){
		alert("Please enter a valid license expiry date");
		return false;
	}
	var days = 0;
	if(getDL("expiry") != null && getDL("expiry").value != ""){
		days = getDays(getDL("expiry").value);
	}
	if(expiryJson != null && expiryJson != ""  && expiryJson[getDL("licensetype").value] != null){
		var editionExp = expiryJson[getDL("licensetype").value].editionexpiry;
		if((days >= expiryJson[getDL("licensetype").value].maxallowedays)  || (editionExp != null && editionExp != "null" && days > getDays(editionExp))){
			alert(expiryJson[getDL("licensetype").value].errormessage);
			return false;
		}
	}
	return true;	
}
function updateBlockedProduct(id,arg)
{
	if(id === "new")
		{
			var tag =  document.getElementById("selectedproducts_new");
			var tag1 = document.getElementById("notselectedproducts_new");
	
		}
	else
		{
			var tag =  document.getElementById("selectedproducts");
			var tag1 = document.getElementById("notselectedproducts");
	
		}
//swapping
	if(arg === "add")
	{
	swapOptions(tag1,tag);
	}
	else if(arg === "remove")
	{
	swapOptions(tag,tag1);
	}
		
	if(id != "new" && id > 0)
		{
		var add = ""; 
		var url = "";
		for(var i = 0 ; i < tag.length ; i++)
		{
			if(add != "")
				{
				add += ",";
				}
			add += tag[i].value;
		
		}
		url = "/license/blockuser.do?method=updateBlockedProduct&rowid="+id+"&productid="+add;
		//alert("url::::"+url) ; 
		ajaxSendRequest(url,tag1,tag,"updateBlockedProduct");
	
		}
}
function showSlide(){
	getDL("rightTd").style="display:none;";
	getDL("leftTd").style="display:none;";
	getDL("slidecontent").innerHTML="&gt;";
	getDL("slidecontent").setAttribute("onclick","hideSlide()");
	getDL("carttable").style = "display:block;width: 100%;"
	getDL("carttd").style = "width:90%;"
}
function hideSlide(){
	getDL("rightTd").style="display:block;";
	getDL("leftTd").style="display:block;";
	getDL("slidecontent").innerHTML="&lt;";
	getDL("slidecontent").setAttribute("onclick","showSlide()");
	getDL("carttable").style = "display:none;width: 100%;"

}

function showBilling(roleid,name){
	if(getDL("licensestatus") != null && getDL("licensestatus").value == "resend"){
		return false;
	}	
	if(name == null && (installationToJS == "US" || (customFields != null&& customFields[getDL("resellername").value] != null && customFields[getDL("resellername").value].length > 0))){
		return true;
	}if(name != null && name[getDL("resellername").value] != null && name[getDL("resellername").value] == roleid){
		return true;
	}
	return false;

}

function displayBilling(){
	if(installationToJS == "US" ){
		getDL("billinginfo").style.display="block";
	}
}


function validatevalue(key,minvalue,name,maxvalue,defaultval){
        if(getDL(key) != null && getDL(key).value != null && getDL(key).value != "" && parseInt(getDL(key).value) < parseInt(minvalue)){
                alert(name+" value should be greater than "+ minvalue);
                getDL(key).value = minvalue;
                return false;
        }
	if(getDL(key) != null && getDL(key).value != null && getDL(key).value != "" && maxvalue != null && maxvalue != "" && parseInt(getDL(key).value) > parseInt(maxvalue)){
                alert(name+" value should be less than "+ maxvalue);
                getDL(key).value = maxvalue;
            return false;
        }
		if(getDL(key).value == "")
		{
			alert(name+" value should not be empty");
			if(defaultval != null && defaultval != "")
			{
				getDL(key).value = defaultval;
				return false;
			}
			getDL(key).value = 0;
			return false;
		}
}

function InitializeWithTimer(id,time)
{
	document.getElementById(id).style.display="block";
	secs = time;
		StopTheClock();
		StartTheTimer();
}

function makeFulltermPerpetual()
{
        if(document.getElementById("fullTermperpetual").checked==true){
                getDL("fullTermexpirylabel").innerHTML = "Full Term AMS Expiry Date";
        }
        else
        {
                getDL("fullTermexpirylabel").innerHTML = "Full Term Expiry Date";
        }
        showHideIpf();
        orderConfirmation();
}

